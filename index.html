<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>嬰幼兒照顧輔助工具</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #8ecae6;
            --secondary-color: #219ebc;
            --accent-color: #ffb703;
            --danger-color: #e76f51;
            --success-color: #52b788;
            --neutral-color: #f8f9fa;
            --text-color: #444444;
            --light-text: #6c757d;
            --border-radius: 10px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f0f5f9;
            color: var(--text-color);
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* 頂部標題區域 */
        header {
            background-color: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-title {
            display: flex;
            align-items: center;
        }

        .header-title img {
            height: 40px;
            margin-right: 10px;
        }

        .header-title h1 {
            font-size: 1.5rem;
            margin: 0;
            color: var(--secondary-color);
        }

        .child-selector {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .child-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-right: 10px;
            min-width: 150px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #429e76;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c85a3f;
        }

        .btn-accent {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-accent:hover {
            background-color: #e29000;
        }

        .btn i {
            margin-right: 5px;
        }

        /* 導航欄 */
        .nav-tabs {
            display: flex;
            background-color: white;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .nav-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light-text);
            border-bottom: 3px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.9rem;
        }

        .nav-tab i {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .nav-tab.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
            background-color: #f0f8ff;
        }

        .nav-tab:hover {
            background-color: #f8f9fa;
        }

        /* 內容區塊 */
        .tab-content {
            display: none;
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 60px; /* 為底部導航留出空間 */
        }

        .tab-content.active {
            display: block;
        }

        /* 表單樣式 */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1;
            padding: 0 10px;
            min-width: 250px;
        }

        /* 記錄類型選擇 */
        .record-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .record-type-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            text-align: center;
            background-color: var(--neutral-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .record-type-btn i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .record-type-btn.active, .record-type-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* 卡片樣式 */
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* 里程碑樣式 */
        .milestone-category {
            margin-bottom: 1.5rem;
        }

        .milestone-list {
            list-style: none;
        }

        .milestone-item {
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
        }

        .milestone-info {
            flex: 1;
        }

        .milestone-name {
            font-weight: 500;
        }

        .milestone-age {
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .milestone-status {
            display: flex;
            align-items: center;
        }

        .milestone-checkbox {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .milestone-date {
            font-size: 0.9rem;
            min-width: 100px;
        }

        /* 歷史記錄樣式 */
        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .history-date-selector {
            display: flex;
            align-items: center;
        }

        .history-filter {
            display: flex;
            gap: 10px;
        }

        .history-day {
            margin-bottom: 1.5rem;
        }

        .history-day-header {
            background-color: var(--neutral-color);
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .history-records {
            margin-left: 10px;
        }

        .history-record {
            display: flex;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .history-record:last-child {
            border-bottom: none;
        }

        .history-record-time {
            min-width: 60px;
            color: var(--light-text);
        }

        .history-record-type {
            min-width: 100px;
            font-weight: 500;
        }

        .history-record-info {
            flex: 1;
        }

        /* 統計圖表樣式 */
        .stats-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stats-period-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stats-period-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            background-color: white;
            cursor: pointer;
        }

        .stats-period-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .stats-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .chart-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow);
            min-height: 300px;
        }

        /* 匯出樣式 */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .export-option {
            background-color: var(--neutral-color);
            padding: 1rem;
            border-radius: var(--border-radius);
        }

        .export-date-range {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 1rem;
        }

        /* 底部導航欄 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            height: 60px; /* 固定高度 */
        }

        .bottom-nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-size: 0.8rem;
            color: var(--light-text);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .bottom-nav-item i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 2px;
        }

        .bottom-nav-item.active {
            color: var(--secondary-color);
            background-color: #f0f8ff;
        }

        /* 新增：底部中間快捷按鈕 */
        .bottom-nav-center {
            position: relative;
            width: 70px;
            display: flex;
            justify-content: center;
        }

        .quick-action-btn {
            position: absolute;
            bottom: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1001;
        }

        /* 底部快捷動作選單 */
        .quick-action-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .quick-action-menu.active {
            transform: translateY(0);
        }

        .quick-action-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .quick-action-menu-header h3 {
            margin: 0;
        }

        .quick-action-menu-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--light-text);
            cursor: pointer;
        }

        .quick-action-menu-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .quick-action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .quick-action-item i {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .quick-action-feeding i { color: #8ecae6; }
        .quick-action-sleep i { color: #9381ff; }
        .quick-action-diaper i { color: #ffb703; }
        .quick-action-other i { color: #6c757d; }

        /* 模態框樣式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--light-text);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1rem;
        }

        .modal-footer {
            padding: 1rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 工具提示和標記 */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--accent-color);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }

            .form-col {
                width: 100%;
                padding: 0;
                margin-bottom: 1rem;
            }

            .nav-tabs {
                display: none;
            }

            .bottom-nav {
                display: flex;
            }

            .header-title h1 {
                font-size: 1.2rem;
            }

            .stats-charts {
                grid-template-columns: 1fr;
            }

            .export-options {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 769px) {
            .bottom-nav {
                display: none;
            }
        }

        /* 進度條 */
        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 50px;
            height: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* 評分系統 */
        .rating {
            display: flex;
            gap: 5px;
        }

        .rating-star {
            cursor: pointer;
            font-size: 1.5rem;
            color: #ddd;
        }

        .rating-star.active {
            color: var(--accent-color);
        }

        /* 搜尋框 */
        .search-container {
            display: flex;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 1rem;
        }

        .search-btn {
            padding: 8px 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
        }

        /* 記錄類型特定樣式 */
        .record-color-feeding {
            border-left: 4px solid #8ecae6;
        }

        .record-color-sleep {
            border-left: 4px solid #9381ff;
        }

        .record-color-diaper {
            border-left: 4px solid #ffb703;
        }

        .record-color-emotion {
            border-left: 4px solid #e76f51;
        }

        .record-color-activity {
            border-left: 4px solid #52b788;
        }

        .record-color-other {
            border-left: 4px solid #6c757d;
        }

        /* 記錄圖標 */
        .record-icon {
            display: inline-flex;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
        }

        .record-icon-feeding {
            background-color: #8ecae6;
        }

        .record-icon-sleep {
            background-color: #9381ff;
        }

        .record-icon-diaper {
            background-color: #ffb703;
        }

        .record-icon-emotion {
            background-color: #e76f51;
        }

        .record-icon-activity {
            background-color: #52b788;
        }

        .record-icon-other {
            background-color: #6c757d;
        }

        /* 折線圖設定 */
        .emotion-scale, .sleep-quality-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }

        .emotion-scale-item, .sleep-quality-scale-item {
            text-align: center;
            font-size: 0.8rem;
            color: var(--light-text);
        }

        /* 動畫效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        /* 成長日誌 */
        .growth-log-item {
            margin-bottom: 1rem;
        }

        .growth-log-date {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 0.25rem;
        }

        .growth-log-content {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: var(--border-radius);
        }

        /* 新增樣式 */
        hr {
            margin: 20px 0;
            border: 0;
            border-top: 1px solid #eee;
        }
        
        .text-danger {
            color: var(--danger-color);
        }

        /* 照顧提示樣式 - 新增 */
        .caretips-controls {
            margin-bottom: 1.5rem;
        }

        .caretips-age-group {
            margin-bottom: 2rem;
        }

        .caretips-age-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .caretips-category {
            margin-bottom: 1.5rem;
        }

        .caretips-category-header {
            display: flex;
            align-items: center;
            background-color: var(--neutral-color);
            padding: 10px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            font-weight: 500;
            cursor: pointer;
        }

        .caretips-category-header i {
            margin-right: 10px;
            color: var(--secondary-color);
            font-size: 1.2rem;
        }

        .caretips-category-items {
            padding-left: 15px;
        }

        .caretip-item {
            background-color: white;
            border-left: 4px solid var(--secondary-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
        }

        .caretip-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary-color);
        }

        .caretip-description {
            color: var(--text-color);
            line-height: 1.6;
        }

        .caretip-item.important {
            border-left-color: var(--danger-color);
        }

        .caretip-item.important .caretip-title {
            color: var(--danger-color);
        }

        .caretip-tag {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--neutral-color);
            border-radius: 50px;
            font-size: 0.8rem;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .caretip-tag-feeding {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        .caretip-tag-sleep {
            background-color: #e0e7ff;
            color: #4338ca;
        }

        .caretip-tag-activity {
            background-color: #dcfce7;
            color: #15803d;
        }

        .caretip-tag-safety {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .caretip-tag-health {
            background-color: #ffedd5;
            color: #c2410c;
        }

        .caretip-tag-development {
            background-color: #ddd6fe;
            color: #7e22ce;
        }

        /* 類別圖標樣式 */
        .category-icon-feeding {
            color: #0369a1;
        }

        .category-icon-sleep {
            color: #4338ca;
        }

        .category-icon-activity {
            color: #15803d;
        }

        .category-icon-safety {
            color: #b91c1c;
        }

        .category-icon-health {
            color: #c2410c;
        }

        .category-icon-development {
            color: #7e22ce;
        }

        /* 睡眠計時狀態指示器 */
        .sleep-timer-badge {
            position: fixed;
            left: 20px;
            bottom: 80px;
            background-color: #9381ff;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 1500;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .sleep-timer-badge i {
            font-size: 1.2rem;
        }

        .sleep-timer-badge.active {
            display: flex;
        }

        /* 成功提示框 */
        .toast-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast-notification.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-notification i {
            font-size: 1.2rem;
        }

        /* 快速尿布選項樣式 */
        .diaper-quick-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .diaper-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 10px;
            cursor: pointer;
            flex: 1;
            min-width: 120px;
            transition: all 0.2s ease;
        }

        .diaper-option:hover, .diaper-option.active {
            background-color: var(--accent-color);
            color: white;
        }

        .diaper-option i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* 遮罩層效果 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* 提醒樣式 - 新增 */
        .reminder-list {
            list-style: none;
            padding: 0;
        }

        .reminder-item {
            background-color: white;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
            margin-bottom: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reminder-item.active {
            border-left-color: var(--success-color);
        }

        .reminder-item.expired {
            border-left-color: var(--light-text);
            opacity: 0.7;
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-title {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .reminder-time {
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .reminder-message {
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .reminder-actions {
            display: flex;
            gap: 5px;
        }

        .reminder-type-icon {
            display: inline-flex;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
        }

        .reminder-type-feeding {
            background-color: #8ecae6;
        }

        .reminder-type-sleep {
            background-color: #9381ff;
        }

        .reminder-type-medicine {
            background-color: #e76f51;
        }

        .reminder-type-vaccine {
            background-color: #52b788;
        }

        .reminder-type-other {
            background-color: #6c757d;
        }

        .reminder-repeat-options {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .reminder-repeat-toggle {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .reminder-repeat-toggle input {
            margin-right: 8px;
        }

        .reminder-repeat-details {
            display: none;
            margin-top: 10px;
        }

        .reminder-repeat-details.active {
            display: block;
        }

        .reminder-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(25%, -25%);
        }

        .reminder-quick-add {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .reminder-quick-add-item {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reminder-quick-add-item:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .reminder-quick-add-item i {
            font-size: 24px;
            margin-bottom: 8px;
        }

        /* 提醒通知徽章 */
        .reminder-count-badge {
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 頂部標題區域 -->
        <header>
            <div class="header-title">
                <i class="fas fa-baby" style="font-size: 24px; margin-right: 10px; color: var(--accent-color);"></i>
                <h1>嬰幼兒照顧輔助工具</h1>
            </div>
            <div class="child-selector">
                <select id="childSelect">
                    <option value="">選擇兒童</option>
                </select>
                <button id="addChildBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> 新增兒童
                </button>
                <button id="deleteChildBtn" class="btn btn-danger" style="margin-left: 10px;">
                    <i class="fas fa-trash"></i> 刪除
                </button>
            </div>
        </header>

        <!-- 頂部導航欄 - 添加照顧提示標籤 -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="record">
                <i class="fas fa-pen"></i>
                <span>記錄</span>
            </div>
            <div class="nav-tab" data-tab="history">
                <i class="fas fa-history"></i>
                <span>歷史</span>
            </div>
            <div class="nav-tab" data-tab="reminder">
                <i class="fas fa-bell reminder-count-badge"></i>
                <span>提醒</span>
            </div>
            <div class="nav-tab" data-tab="milestone">
                <i class="fas fa-flag"></i>
                <span>里程碑</span>
            </div>
            <div class="nav-tab" data-tab="stats">
                <i class="fas fa-chart-bar"></i>
                <span>統計</span>
            </div>
            <div class="nav-tab" data-tab="caretips">
                <i class="fas fa-lightbulb"></i>
                <span>照顧提示</span>
            </div>
            <div class="nav-tab" data-tab="export">
                <i class="fas fa-file-export"></i>
                <span>匯出</span>
            </div>
        </div>

        <!-- 內容區域 -->
        <div id="recordTab" class="tab-content active">
            <h2>新增記錄</h2>
            <p id="currentChildInfo">請先選擇或新增一位兒童</p>

            <div class="record-type-selector">
                <div class="record-type-btn active" data-record-type="feeding">
                    <i class="fas fa-utensils"></i>
                    <span>餵食</span>
                </div>
                <div class="record-type-btn" data-record-type="sleep">
                    <i class="fas fa-bed"></i>
                    <span>睡眠</span>
                </div>
                <div class="record-type-btn" data-record-type="diaper">
                    <i class="fas fa-baby"></i>
                    <span>尿布</span>
                </div>
                <div class="record-type-btn" data-record-type="emotion">
                    <i class="fas fa-smile"></i>
                    <span>情緒</span>
                </div>
                <div class="record-type-btn" data-record-type="activity">
                    <i class="fas fa-walking"></i>
                    <span>活動</span>
                </div>
                <div class="record-type-btn" data-record-type="other">
                    <i class="fas fa-plus-circle"></i>
                    <span>其他</span>
                </div>
            </div>

            <!-- 餵食記錄表單 -->
            <div id="feedingForm" class="record-form active">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="feedingType">餵食類型</label>
                            <select id="feedingType" class="form-control">
                                <option value="母乳">母乳</option>
                                <option value="配方奶">配方奶</option>
                                <option value="副食品">副食品</option>
                                <option value="水果">水果</option>
                                <option value="水/飲料">水/飲料</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="feedingAmount">數量/時間</label>
                            <div style="display: flex; align-items: center;">
                                <input type="number" id="feedingAmount" class="form-control" style="flex: 1; margin-right: 10px;">
                                <select id="feedingUnit" class="form-control" style="width: 80px;">
                                    <option value="ml">毫升</option>
                                    <option value="min">分鐘</option>
                                    <option value="份">份</option>
                                    <option value="湯匙">湯匙</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="feedingTime">時間</label>
                            <input type="datetime-local" id="feedingTime" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="feedingNote">備註</label>
                            <textarea id="feedingNote" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="feedingSetReminder" style="margin-right: 5px;"> 設定下次餵食提醒
                    </label>
                    <div id="feedingReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="feedingReminderTime">提醒時間</label>
                                    <select id="feedingReminderInterval" class="form-control">
                                        <option value="2">2小時後</option>
                                        <option value="3" selected>3小時後</option>
                                        <option value="4">4小時後</option>
                                        <option value="custom">自訂時間</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col" id="feedingCustomTimeCol" style="display: none;">
                                <div class="form-group">
                                    <label for="feedingCustomTime">自訂時間</label>
                                    <input type="datetime-local" id="feedingCustomTime" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="saveFeedingBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>

            <!-- 睡眠記錄表單 -->
            <div id="sleepForm" class="record-form" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="sleepStart">開始時間</label>
                            <input type="datetime-local" id="sleepStart" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="sleepEnd">結束時間</label>
                            <input type="datetime-local" id="sleepEnd" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="sleepQuality">睡眠品質 (1-5分)</label>
                            <div class="rating" id="sleepQualityRating">
                                <span class="rating-star" data-value="1"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="2"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="3"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="4"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="5"><i class="fas fa-star"></i></span>
                            </div>
                            <input type="hidden" id="sleepQuality" value="3">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="sleepNote">備註</label>
                            <textarea id="sleepNote" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sleepSetReminder" style="margin-right: 5px;"> 設定下次睡眠提醒
                    </label>
                    <div id="sleepReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="sleepReminderType">提醒類型</label>
                                    <select id="sleepReminderType" class="form-control">
                                        <option value="nextSleep">下次睡眠時間</option>
                                        <option value="wakeup">預計醒來時間</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="sleepReminderInterval">提醒時間</label>
                                    <select id="sleepReminderInterval" class="form-control">
                                        <option value="3">3小時後</option>
                                        <option value="12" selected>12小時後</option>
                                        <option value="custom">自訂時間</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col" id="sleepCustomTimeCol" style="display: none;">
                                <div class="form-group">
                                    <label for="sleepCustomTime">自訂時間</label>
                                    <input type="datetime-local" id="sleepCustomTime" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="saveSleepBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>

            <!-- 尿布記錄表單 -->
            <div id="diaperForm" class="record-form" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>排泄類型</label>
                            <div style="display: flex; gap: 10px;">
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="diaperUrine" checked style="margin-right: 5px;"> 小便
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="diaperStool" style="margin-right: 5px;"> 大便
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="diaperCondition">狀況</label>
                            <select id="diaperCondition" class="form-control">
                                <option value="正常">正常</option>
                                <option value="異常">異常</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="diaperTime">時間</label>
                            <input type="datetime-local" id="diaperTime" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="diaperNote">備註</label>
                            <textarea id="diaperNote" class="form-control" rows="3" placeholder="若狀況異常，請說明異常情況"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="diaperSetReminder" style="margin-right: 5px;"> 設定下次更換提醒
                    </label>
                    <div id="diaperReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="diaperReminderInterval">提醒時間</label>
                                    <select id="diaperReminderInterval" class="form-control">
                                        <option value="1">1小時後</option>
                                        <option value="2" selected>2小時後</option>
                                        <option value="3">3小時後</option>
                                        <option value="custom">自訂時間</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col" id="diaperCustomTimeCol" style="display: none;">
                                <div class="form-group">
                                    <label for="diaperCustomTime">自訂時間</label>
                                    <input type="datetime-local" id="diaperCustomTime" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="saveDiaperBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>

            <!-- 情緒記錄表單 -->
            <div id="emotionForm" class="record-form" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotionType">情緒類別</label>
                            <select id="emotionType" class="form-control">
                                <option value="開心">開心</option>
                                <option value="難過">難過</option>
                                <option value="生氣">生氣</option>
                                <option value="害怕">害怕</option>
                                <option value="驚訝">驚訝</option>
                                <option value="平靜">平靜</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotionIntensity">強度 (1-5分)</label>
                            <div class="rating" id="emotionIntensityRating">
                                <span class="rating-star" data-value="1"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="2"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="3"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="4"><i class="fas fa-star"></i></span>
                                <span class="rating-star" data-value="5"><i class="fas fa-star"></i></span>
                            </div>
                            <input type="hidden" id="emotionIntensity" value="3">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotionTime">時間</label>
                            <input type="datetime-local" id="emotionTime" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotionNote">備註</label>
                            <textarea id="emotionNote" class="form-control" rows="3" placeholder="描述情緒發生的情境和可能的原因"></textarea>
                        </div>
                    </div>
                </div>
                <button id="saveEmotionBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>

            <!-- 活動記錄表單 -->
            <div id="activityForm" class="record-form" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="activityType">活動類型</label>
                            <select id="activityType" class="form-control">
                                <option value="遊戲">遊戲</option>
                                <option value="洗澡">洗澡</option>
                                <option value="戶外">戶外</option>
                                <option value="學習">學習</option>
                                <option value="社交">社交</option>
                                <option value="運動">運動</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="activityDuration">持續時間 (分鐘)</label>
                            <input type="number" id="activityDuration" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="activityTime">開始時間</label>
                            <input type="datetime-local" id="activityTime" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="activityNote">備註</label>
                            <textarea id="activityNote" class="form-control" rows="3" placeholder="描述活動內容和兒童反應"></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="activitySetReminder" style="margin-right: 5px;"> 設定下次活動提醒
                    </label>
                    <div id="activityReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="activityReminderInterval">提醒時間</label>
                                    <select id="activityReminderInterval" class="form-control">
                                        <option value="24">明天同一時間</option>
                                        <option value="168">一週後同一時間</option>
                                        <option value="custom">自訂時間</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col" id="activityCustomTimeCol" style="display: none;">
                                <div class="form-group">
                                    <label for="activityCustomTime">自訂時間</label>
                                    <input type="datetime-local" id="activityCustomTime" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="saveActivityBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>

            <!-- 其他記錄表單 -->
            <div id="otherForm" class="record-form" style="display: none;">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="otherTitle">標題</label>
                            <input type="text" id="otherTitle" class="form-control">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="otherTime">時間</label>
                            <input type="datetime-local" id="otherTime" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="otherContent">內容</label>
                    <textarea id="otherContent" class="form-control" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="otherSetReminder" style="margin-right: 5px;"> 設定提醒
                    </label>
                    <div id="otherReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="otherReminderTime">提醒時間</label>
                                    <input type="datetime-local" id="otherReminderTime" class="form-control">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="otherReminderMessage">提醒訊息</label>
                                    <input type="text" id="otherReminderMessage" class="form-control" placeholder="留空則使用標題">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="saveOtherBtn" class="btn btn-primary">
                    <i class="fas fa-save"></i> 儲存記錄
                </button>
            </div>
        </div>

        <div id="historyTab" class="tab-content">
            <h2>歷史記錄</h2>
            <p id="historyChildInfo">請先選擇或新增一位兒童</p>

            <div class="history-controls">
                <div class="history-date-selector">
                    <input type="date" id="historyDate" class="form-control">
                </div>
                <div class="history-filter">
                    <select id="historyFilter" class="form-control">
                        <option value="all">所有類型</option>
                        <option value="feeding">餵食</option>
                        <option value="sleep">睡眠</option>
                        <option value="diaper">尿布</option>
                        <option value="emotion">情緒</option>
                        <option value="activity">活動</option>
                        <option value="other">其他</option>
                    </select>
                </div>
            </div>

            <div id="historyContent">
                <!-- 歷史記錄將在這裡動態生成 -->
            </div>
        </div>

        <!-- 新增提醒標籤頁 -->
        <div id="reminderTab" class="tab-content">
            <h2>提醒管理</h2>
            <p id="reminderChildInfo">請先選擇或新增一位兒童</p>

            <div style="margin-bottom: 20px;">
                <button id="addReminderBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> 新增提醒
                </button>
            </div>

            <h3>快速新增提醒</h3>
            <div class="reminder-quick-add">
                <div class="reminder-quick-add-item" data-type="feeding">
                    <i class="fas fa-utensils" style="color: #8ecae6;"></i>
                    <span>餵食提醒</span>
                </div>
                <div class="reminder-quick-add-item" data-type="sleep">
                    <i class="fas fa-bed" style="color: #9381ff;"></i>
                    <span>睡眠提醒</span>
                </div>
                <div class="reminder-quick-add-item" data-type="medicine">
                    <i class="fas fa-pills" style="color: #e76f51;"></i>
                    <span>用藥提醒</span>
                </div>
                <div class="reminder-quick-add-item" data-type="vaccine">
                    <i class="fas fa-syringe" style="color: #52b788;"></i>
                    <span>疫苗提醒</span>
                </div>
            </div>

            <div class="reminder-filters" style="display: flex; gap: 10px; margin-bottom: 15px;">
                <select id="reminderFilter" class="form-control" style="max-width: 150px;">
                    <option value="all">所有提醒</option>
                    <option value="active">活躍提醒</option>
                    <option value="completed">已完成提醒</option>
                </select>
                <button id="clearCompletedRemindersBtn" class="btn btn-danger">
                    <i class="fas fa-trash"></i> 清除已完成提醒
                </button>
            </div>

            <div id="reminderList">
                <!-- 提醒列表將在這裡動態生成 -->
                <p>目前沒有提醒項目。</p>
            </div>
        </div>

        <div id="milestoneTab" class="tab-content">
            <h2>發展里程碑</h2>
            <p id="milestoneChildInfo">請先選擇或新增一位兒童</p>

            <div class="milestone-controls">
                <select id="milestoneFilter" class="form-control">
                    <option value="all">所有年齡段</option>
                    <option value="0-3">0-3個月</option>
                    <option value="4-6">4-6個月</option>
                    <option value="7-9">7-9個月</option>
                    <option value="10-12">10-12個月</option>
                    <option value="13-18">13-18個月</option>
                    <option value="19-24">19-24個月</option>
                </select>
            </div>

            <div id="milestoneContent">
                <!-- 里程碑內容將在這裡動態生成 -->
            </div>
        </div>

        <div id="statsTab" class="tab-content">
            <h2>統計分析</h2>
            <p id="statsChildInfo">請先選擇或新增一位兒童</p>

            <div class="stats-controls">
                <div class="stats-period-selector">
                    <button class="stats-period-btn active" data-period="week">週</button>
                    <button class="stats-period-btn" data-period="month">月</button>
                    <button class="stats-period-btn" data-period="3months">三個月</button>
                    <button class="stats-period-btn" data-period="custom">自訂</button>
                </div>
                <div class="stats-custom-period" style="display: none;">
                    <input type="date" id="statsStartDate" class="form-control" style="margin-right: 10px;">
                    <span>至</span>
                    <input type="date" id="statsEndDate" class="form-control" style="margin-left: 10px;">
                    <button id="statsApplyCustom" class="btn btn-primary">套用</button>
                </div>
            </div>

            <div class="stats-charts">
                <div class="chart-container">
                    <h3>睡眠時間與品質</h3>
                    <canvas id="sleepChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>餵食量變化</h3>
                    <canvas id="feedingChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>排泄頻率</h3>
                    <canvas id="diaperChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>情緒變化</h3>
                    <canvas id="emotionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 照顧提示標籤頁 - 新增 -->
        <div id="caretipsTab" class="tab-content">
            <h2>照顧提示</h2>
            <p id="caretipsChildInfo">請先選擇或新增一位兒童</p>

            <div class="caretips-controls">
                <select id="caretipsCategory" class="form-control">
                    <option value="all">所有類別</option>
                    <option value="feeding">餵食</option>
                    <option value="sleep">睡眠</option>
                    <option value="activity">活動與遊戲</option>
                    <option value="safety">安全</option>
                    <option value="health">健康與衛生</option>
                    <option value="development">發展與學習</option>
                </select>
            </div>

            <div id="caretipsContent">
                <!-- 照顧提示內容將在這裡動態生成 -->
            </div>
        </div>

        <div id="exportTab" class="tab-content">
            <h2>匯出資料</h2>
            <p id="exportChildInfo">請先選擇或新增一位兒童</p>

            <div class="export-options">
                <div class="export-option">
                    <h3>選擇記錄類型</h3>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; margin-bottom: 5px;">
                            <input type="checkbox" id="exportAllTypes" checked style="margin-right: 5px;"> 所有類型
                        </label>
                        <div id="exportTypeOptions">
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="feeding" style="margin-right: 5px;"> 餵食
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="sleep" style="margin-right: 5px;"> 睡眠
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="diaper" style="margin-right: 5px;"> 尿布
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="emotion" style="margin-right: 5px;"> 情緒
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="activity" style="margin-right: 5px;"> 活動
                            </label>
                            <label style="display: flex; align-items: center; margin-bottom: 5px;">
                                <input type="checkbox" name="exportType" value="other" style="margin-right: 5px;"> 其他
                            </label>
                        </div>
                    </div>
                </div>
                <div class="export-option">
                    <h3>選擇日期範圍</h3>
                    <div style="margin-top: 10px;">
                        <label style="display: flex; align-items: center; margin-bottom: 5px;">
                            <input type="checkbox" id="exportAllDates" checked style="margin-right: 5px;"> 所有日期
                        </label>
                        <div id="exportDateRange" style="display: none;">
                            <div class="export-date-range">
                                <span>從:</span>
                                <input type="date" id="exportStartDate" class="form-control">
                            </div>
                            <div class="export-date-range">
                                <span>至:</span>
                                <input type="date" id="exportEndDate" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button id="exportCSVBtn" class="btn btn-primary">
                <i class="fas fa-file-csv"></i> 匯出為CSV
            </button>
            
            <!-- 新增部分：全部數據匯出與匯入功能 -->
            <hr>
            <h3>全部數據匯出與備份</h3>
            <p>匯出所有兒童及其所有記錄，可用於備份或跨設備轉移數據。</p>
            <button id="exportAllDataBtn" class="btn btn-accent" style="margin-right: 10px;">
                <i class="fas fa-download"></i> 匯出所有數據
            </button>
            
            <div style="margin-top: 20px;">
                <h3>匯入數據</h3>
                <p>從先前匯出的檔案中匯入數據。</p>
                <div style="display: flex; align-items: center;">
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                    <button id="importFileBtn" class="btn btn-primary" style="margin-right: 10px;">
                        <i class="fas fa-upload"></i> 選擇檔案
                    </button>
                    <span id="importFileName">未選擇檔案</span>
                </div>
                <div style="margin-top: 10px;">
                    <div class="form-group">
                        <label>匯入選項：</label>
                        <label style="display: flex; align-items: center; margin: 5px 0;">
                            <input type="radio" name="importOption" value="merge" checked style="margin-right: 5px;"> 合併數據（保留現有數據）
                        </label>
                        <label style="display: flex; align-items: center; margin: 5px 0;">
                            <input type="radio" name="importOption" value="replace" style="margin-right: 5px;"> 完全替換（刪除所有現有數據）
                        </label>
                    </div>
                    <button id="importDataBtn" class="btn btn-success" disabled>
                        <i class="fas fa-check"></i> 開始匯入
                    </button>
                </div>
            </div>
        </div>

        <!-- 底部導航欄 - 改進版 -->
        <div class="bottom-nav">
            <div class="bottom-nav-item active" data-tab="record">
                <i class="fas fa-pen"></i>
                <span>記錄</span>
            </div>
            <div class="bottom-nav-item" data-tab="history">
                <i class="fas fa-history"></i>
                <span>歷史</span>
            </div>
            
            <!-- 新增：快捷按鈕 -->
            <div class="bottom-nav-center">
                <button id="quickActionBtn" class="quick-action-btn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="bottom-nav-item" data-tab="reminder">
                <i class="fas fa-bell reminder-count-badge"></i>
                <span>提醒</span>
            </div>
            <div class="bottom-nav-item" data-tab="caretips">
                <i class="fas fa-lightbulb"></i>
                <span>提示</span>
            </div>
        </div>

        <!-- 新增：快捷動作選單 -->
        <div id="quickActionMenu" class="quick-action-menu">
            <div class="quick-action-menu-header">
                <h3>快速記錄</h3>
                <button id="quickActionMenuClose" class="quick-action-menu-close">&times;</button>
            </div>
            <div class="quick-action-menu-items">
                <div class="quick-action-item quick-action-feeding" id="quickActionFeeding">
                    <i class="fas fa-utensils"></i>
                    <span>餵食</span>
                </div>
                <div class="quick-action-item quick-action-sleep" id="quickActionSleep">
                    <i class="fas fa-bed"></i>
                    <span>睡眠</span>
                </div>
                <div class="quick-action-item quick-action-diaper" id="quickActionDiaper">
                    <i class="fas fa-baby"></i>
                    <span>尿布</span>
                </div>
                <div class="quick-action-item quick-action-other" id="quickActionOther">
                    <i class="fas fa-plus-circle"></i>
                    <span>其他</span>
                </div>
            </div>
        </div>

        <!-- 睡眠計時器指示器 -->
        <div class="sleep-timer-badge" id="sleepTimerBadge">
            <i class="fas fa-bed"></i>
            <span class="sleep-timer-text">正在睡眠中: 00:00:00</span>
        </div>

        <!-- 成功提示框 -->
        <div class="toast-notification" id="toastNotification">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">記錄已成功儲存！</span>
        </div>

        <!-- 遮罩層 -->
        <div id="overlay" class="overlay"></div>
    </div>

    <!-- 新增兒童模態框 -->
    <div id="addChildModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增兒童</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="childName">姓名</label>
                    <input type="text" id="childName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="childBirthday">出生日期</label>
                    <input type="date" id="childBirthday" class="form-control">
                </div>
                <div class="form-group">
                    <label for="childGender">性別</label>
                    <select id="childGender" class="form-control">
                        <option value="男">男</option>
                        <option value="女">女</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="childNote">備註</label>
                    <textarea id="childNote" class="form-control" rows="3" placeholder="其他重要資訊，如過敏史、特殊需求等"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveChildBtn">儲存</button>
                <button class="btn" id="cancelAddChildBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 編輯記錄模態框 -->
    <div id="editRecordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="editRecordTitle">編輯記錄</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body" id="editRecordBody">
                <!-- 編輯表單將根據記錄類型動態生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="deleteRecordBtn">刪除</button>
                <button class="btn btn-primary" id="updateRecordBtn">更新</button>
                <button class="btn" id="cancelEditRecordBtn">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 新增：刪除兒童確認模態框 -->
    <div id="deleteChildModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>刪除兒童</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <p>確定要刪除「<span id="deleteChildName"></span>」嗎？</p>
                <p class="text-danger"><strong>警告：</strong>此操作將刪除與該兒童相關的所有記錄和里程碑資料，且無法復原！</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="confirmDeleteChildBtn">確認刪除</button>
                <button class="btn" id="cancelDeleteChildBtn">取消</button>
            </div>
        </div>
    </div>
    
    <!-- 新增：匯入確認模態框 -->
    <div id="importConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>確認匯入</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <p>您即將匯入以下數據：</p>
                <div id="importSummary" style="margin: 10px 0; padding: 10px; background-color: #f0f5f9; border-radius: 5px;"></div>
                <p id="importWarning" style="color: #e76f51;"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="confirmImportBtn">確認匯入</button>
                <button class="btn" id="cancelImportBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 快速餵食記錄模態框 -->
    <div id="quickFeedingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>快速餵食記錄</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="quickFeedingType">餵食類型</label>
                    <select id="quickFeedingType" class="form-control">
                        <option value="母乳">母乳</option>
                        <option value="配方奶">配方奶</option>
                        <option value="副食品">副食品</option>
                        <option value="水果">水果</option>
                        <option value="水/飲料">水/飲料</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickFeedingAmount">數量/時間</label>
                    <div style="display: flex; align-items: center;">
                        <input type="number" id="quickFeedingAmount" class="form-control" style="flex: 1; margin-right: 10px;">
                        <select id="quickFeedingUnit" class="form-control" style="width: 80px;">
                            <option value="ml">毫升</option>
                            <option value="min">分鐘</option>
                            <option value="份">份</option>
                            <option value="湯匙">湯匙</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="quickFeedingNote">備註</label>
                    <textarea id="quickFeedingNote" class="form-control" rows="2" placeholder="備註（選填）"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="quickFeedingSetReminder" style="margin-right: 5px;"> 設定下次餵食提醒
                    </label>
                    <div id="quickFeedingReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-group">
                            <label for="quickFeedingReminderInterval">提醒時間</label>
                            <select id="quickFeedingReminderInterval" class="form-control">
                                <option value="2">2小時後</option>
                                <option value="3" selected>3小時後</option>
                                <option value="4">4小時後</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveQuickFeedingBtn">儲存</button>
                <button class="btn" id="cancelQuickFeedingBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 快速尿布記錄模態框 -->
    <div id="quickDiaperModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>快速尿布記錄</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="diaper-quick-options">
                    <div class="diaper-option active" data-type="urine">
                        <i class="fas fa-tint"></i>
                        <span>小便</span>
                    </div>
                    <div class="diaper-option" data-type="stool">
                        <i class="fas fa-poo"></i>
                        <span>大便</span>
                    </div>
                    <div class="diaper-option" data-type="both">
                        <i class="fas fa-poo-storm"></i>
                        <span>兩者</span>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label for="quickDiaperCondition">狀況</label>
                    <select id="quickDiaperCondition" class="form-control">
                        <option value="正常">正常</option>
                        <option value="異常">異常</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickDiaperNote">備註</label>
                    <textarea id="quickDiaperNote" class="form-control" rows="2" placeholder="備註（選填）"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="quickDiaperSetReminder" style="margin-right: 5px;"> 設定下次更換提醒
                    </label>
                    <div id="quickDiaperReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-group">
                            <label for="quickDiaperReminderInterval">提醒時間</label>
                            <select id="quickDiaperReminderInterval" class="form-control">
                                <option value="1">1小時後</option>
                                <option value="2" selected>2小時後</option>
                                <option value="3">3小時後</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveQuickDiaperBtn">儲存</button>
                <button class="btn" id="cancelQuickDiaperBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 快速其他記錄模態框 -->
    <div id="quickOtherModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>快速其他記錄</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="quickOtherType">記錄類型</label>
                    <select id="quickOtherType" class="form-control">
                        <option value="emotion_happy">情緒 - 開心</option>
                        <option value="emotion_sad">情緒 - 難過</option>
                        <option value="activity_bath">活動 - 洗澡</option>
                        <option value="activity_outdoor">活動 - 戶外</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickOtherNote">備註</label>
                    <textarea id="quickOtherNote" class="form-control" rows="2" placeholder="備註（選填）"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveQuickOtherBtn">儲存</button>
                <button class="btn" id="cancelQuickOtherBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 新增提醒模態框 -->
    <div id="addReminderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>新增提醒</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="reminderType">提醒類型</label>
                    <select id="reminderType" class="form-control">
                        <option value="feeding">餵食</option>
                        <option value="sleep">睡眠</option>
                        <option value="diaper">尿布更換</option>
                        <option value="medicine">用藥</option>
                        <option value="vaccine">疫苗</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reminderTitle">提醒標題</label>
                    <input type="text" id="reminderTitle" class="form-control" placeholder="例：餵食時間、用藥提醒">
                </div>
                <div class="form-group">
                    <label for="reminderTime">提醒時間</label>
                    <input type="datetime-local" id="reminderTime" class="form-control">
                </div>
                <div class="form-group">
                    <label for="reminderMessage">提醒訊息</label>
                    <textarea id="reminderMessage" class="form-control" rows="2" placeholder="提醒內容（選填）"></textarea>
                </div>
                
                <div class="reminder-repeat-options">
                    <div class="reminder-repeat-toggle">
                        <input type="checkbox" id="reminderRepeat"> 
                        <label for="reminderRepeat">重複提醒</label>
                    </div>
                    
                    <div id="reminderRepeatDetails" class="reminder-repeat-details">
                        <div class="form-group">
                            <label for="reminderRepeatType">重複類型</label>
                            <select id="reminderRepeatType" class="form-control">
                                
                 <option value="daily">每天</option>
                                <option value="weekly">每週</option>
                                <option value="monthly">每月</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="reminderRepeatDaysGroup" style="display: none;">
                            <label>重複日期</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="1" style="margin-right: 5px;"> 週一
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="2" style="margin-right: 5px;"> 週二
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="3" style="margin-right: 5px;"> 週三
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="4" style="margin-right: 5px;"> 週四
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="5" style="margin-right: 5px;"> 週五
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="6" style="margin-right: 5px;"> 週六
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" name="reminderRepeatDay" value="0" style="margin-right: 5px;"> 週日
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group" id="reminderRepeatDateGroup" style="display: none;">
                            <label for="reminderRepeatDate">每月重複日期</label>
                            <select id="reminderRepeatDate" class="form-control">
                                <!-- 1-31日選項將由JavaScript動態生成 -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveReminderBtn">儲存提醒</button>
                <button class="btn" id="cancelAddReminderBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 快速添加用藥提醒模態框 -->
    <div id="quickMedicineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用藥提醒</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="medicineName">藥物名稱</label>
                    <input type="text" id="medicineName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="medicineDosage">劑量</label>
                    <input type="text" id="medicineDosage" class="form-control" placeholder="例：5ml、1顆">
                </div>
                <div class="form-group">
                    <label for="medicineSchedule">服用時間</label>
                    <select id="medicineSchedule" class="form-control">
                        <option value="1">每日1次</option>
                        <option value="2">每日2次</option>
                        <option value="3">每日3次</option>
                        <option value="4">每日4次</option>
                        <option value="custom">自訂時間</option>
                    </select>
                </div>
                <div id="medicineCustomTimeGroup" style="display: none;">
                    <div class="form-group">
                        <label for="medicineFirstTime">首次服用時間</label>
                        <input type="datetime-local" id="medicineFirstTime" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="medicineDuration">服用天數</label>
                    <select id="medicineDuration" class="form-control">
                        <option value="3">3天</option>
                        <option value="5">5天</option>
                        <option value="7">7天</option>
                        <option value="14">14天</option>
                        <option value="0">持續服用</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="medicineNote">備註</label>
                    <textarea id="medicineNote" class="form-control" rows="2" placeholder="備註（選填）"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveMedicineReminderBtn">設定提醒</button>
                <button class="btn" id="cancelMedicineReminderBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 快速添加疫苗提醒模態框 -->
    <div id="quickVaccineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>疫苗接種提醒</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="vaccineName">疫苗名稱</label>
                    <select id="vaccineName" class="form-control">
                        <option value="BCG">卡介苗 (BCG)</option>
                        <option value="B肝">B型肝炎疫苗</option>
                        <option value="五合一">五合一疫苗</option>
                        <option value="肺炎鏈球菌">肺炎鏈球菌疫苗</option>
                        <option value="輪狀病毒">輪狀病毒疫苗</option>
                        <option value="麻疹腮腺炎德國麻疹">麻疹腮腺炎德國麻疹混合疫苗</option>
                        <option value="水痘">水痘疫苗</option>
                        <option value="日本腦炎">日本腦炎疫苗</option>
                        <option value="流感">流感疫苗</option>
                        <option value="other">其他</option>
                    </select>
                </div>
                <div id="vaccineOtherNameGroup" style="display: none;">
                    <div class="form-group">
                        <label for="vaccineOtherName">其他疫苗名稱</label>
                        <input type="text" id="vaccineOtherName" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="vaccineDate">接種日期</label>
                    <input type="date" id="vaccineDate" class="form-control">
                </div>
                <div class="form-group">
                    <label for="vaccineLocation">接種地點</label>
                    <input type="text" id="vaccineLocation" class="form-control" placeholder="例：衛生所、兒科診所">
                </div>
                <div class="form-group">
                    <label for="vaccineNote">備註</label>
                    <textarea id="vaccineNote" class="form-control" rows="2" placeholder="備註（選填）"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="vaccineSetNextReminder" style="margin-right: 5px;"> 設定下一劑提醒
                    </label>
                    <div id="vaccineNextReminderOptions" style="margin-top: 10px; display: none;">
                        <div class="form-group">
                            <label for="vaccineNextDate">預計下一劑日期</label>
                            <input type="date" id="vaccineNextDate" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveVaccineReminderBtn">設定提醒</button>
                <button class="btn" id="cancelVaccineReminderBtn">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 核心資料模型
        const appData = {
            children: [],
            selectedChild: null,
            records: {},
            milestones: {},
            quickOptions: {
                feeding: [],
                lastFeeding: null,
                sleepStartTime: null
            },
            // 新增提醒數據結構
            reminders: {}
        };

        // 新增：匯入數據臨時存儲
        let importedData = null;

        // 里程碑定義
        const milestonesDefinition = {
            "0-3": {
                "運動技能": [
                    { name: "抬頭", typicalAge: "1-2個月" },
                    { name: "翻身 (從腹部到背部)", typicalAge: "3-4個月" },
                    { name: "抓握物品", typicalAge: "3個月" },
                    { name: "雙手合十", typicalAge: "3個月" }
                ],
                "語言能力": [
                    { name: "發出咕咕聲", typicalAge: "1-2個月" },
                    { name: "笑聲回應", typicalAge: "2個月" },
                    { name: "模仿聲音", typicalAge: "2-3個月" }
                ],
                "社交/情緒發展": [
                    { name: "社交性微笑", typicalAge: "1-2個月" },
                    { name: "認人", typicalAge: "2-3個月" },
                    { name: "對聲音表現出興趣", typicalAge: "0-3個月" }
                ],
                "認知發展": [
                    { name: "追視移動物體", typicalAge: "1-2個月" },
                    { name: "注視臉部", typicalAge: "0-1個月" },
                    { name: "開始認識物體恆存", typicalAge: "3個月" }
                ]
            },
            "4-6": {
                "運動技能": [
                    { name: "翻身 (從背部到腹部)", typicalAge: "4-5個月" },
                    { name: "支撐坐立", typicalAge: "5-6個月" },
                    { name: "傳遞物品", typicalAge: "5-6個月" },
                    { name: "用拇指和食指抓取小物品", typicalAge: "6個月" }
                ],
                "語言能力": [
                    { name: "發出連續音節", typicalAge: "4-6個月" },
                    { name: "對自己名字有反應", typicalAge: "4-5個月" },
                    { name: "開始模仿語音", typicalAge: "6個月" }
                ],
                "社交/情緒發展": [
                    { name: "不熟悉陌生人", typicalAge: "4-5個月" },
                    { name: "對鏡中影像產生興趣", typicalAge: "5-6個月" },
                    { name: "表現出喜悅、憤怒等情緒", typicalAge: "4-6個月" }
                ],
                "認知發展": [
                    { name: "開始理解因果關係", typicalAge: "4-6個月" },
                    { name: "對藏起來的物體表現出興趣", typicalAge: "5-6個月" },
                    { name: "開始區分不同的顏色", typicalAge: "5-6個月" }
                ]
            },
            "7-9": {
                "運動技能": [
                    { name: "獨自坐立", typicalAge: "7-8個月" },
                    { name: "爬行", typicalAge: "8-9個月" },
                    { name: "扶著東西站立", typicalAge: "9個月" },
                    { name: "精細抓握", typicalAge: "7-8個月" }
                ],
                "語言能力": [
                    { name: "牙牙學語", typicalAge: "7-9個月" },
                    { name: "理解簡單的指令", typicalAge: "7-9個月" },
                    { name: "模仿聲音和手勢", typicalAge: "7-9個月" }
                ],
                "社交/情緒發展": [
                    { name: "陌生人焦慮", typicalAge: "7-9個月" },
                    { name: "分離焦慮", typicalAge: "8-9個月" },
                    { name: "玩躲貓貓遊戲", typicalAge: "7-8個月" }
                ],
                "認知發展": [
                    { name: "尋找藏起來的物體", typicalAge: "7-8個月" },
                    { name: "記住簡單的動作序列", typicalAge: "8-9個月" },
                    { name: "開始分類物體", typicalAge: "9個月" }
                ]
            },
            "10-12": {
                "運動技能": [
                    { name: "獨自站立", typicalAge: "10-11個月" },
                    { name: "扶著東西走路", typicalAge: "10-12個月" },
                    { name: "嘗試獨自走路", typicalAge: "11-12個月" },
                    { name: "可以坐下", typicalAge: "10-11個月" }
                ],
                "語言能力": [
                    { name: "說出第一個單詞", typicalAge: "10-12個月" },
                    { name: "理解更多的單詞", typicalAge: "10-12個月" },
                    { name: "指向物體表達需求", typicalAge: "10-12個月" }
                ],
                "社交/情緒發展": [
                    { name: "模仿成人行為", typicalAge: "10-12個月" },
                    { name: "表現喜好", typicalAge: "10-12個月" },
                    { name: "與照顧者建立更強的情感連結", typicalAge: "10-12個月" }
                ],
                "認知發展": [
                    { name: "依照指示完成簡單任務", typicalAge: "10-12個月" },
                    { name: "開始理解物體功能", typicalAge: "10-12個月" },
                    { name: "展示記憶力", typicalAge: "10-12個月" }
                ]
            },
            "13-18": {
                "運動技能": [
                    { name: "獨立行走", typicalAge: "13-15個月" },
                    { name: "爬樓梯", typicalAge: "16-18個月" },
                    { name: "拉、推玩具走路", typicalAge: "13-15個月" },
                    { name: "開始跑步", typicalAge: "16-18個月" }
                ],
                "語言能力": [
                    { name: "詞彙量增加 (5-20個單詞)", typicalAge: "13-18個月" },
                    { name: "開始組合單詞", typicalAge: "16-18個月" },
                    { name: "遵循簡單的二步驟指令", typicalAge: "16-18個月" }
                ],
                "社交/情緒發展": [
                    { name: "表現出同理心", typicalAge: "13-18個月" },
                    { name: "參與平行遊戲", typicalAge: "13-18個月" },
                    { name: "主動表達情感", typicalAge: "13-18個月" }
                ],
                "認知發展": [
                    { name: "解決簡單問題", typicalAge: "13-18個月" },
                    { name: "象徵性遊戲", typicalAge: "13-18個月" },
                    { name: "開始理解數量概念", typicalAge: "16-18個月" }
                ]
            },
            "19-24": {
                "運動技能": [
                    { name: "上下樓梯", typicalAge: "19-24個月" },
                    { name: "踢球", typicalAge: "20-24個月" },
                    { name: "站立跳躍", typicalAge: "21-24個月" },
                    { name: "精細運動技能提升", typicalAge: "19-24個月" }
                ],
                "語言能力": [
                    { name: "詞彙量急速增加 (50+單詞)", typicalAge: "19-24個月" },
                    { name: "開始形成簡單句子", typicalAge: "20-24個月" },
                    { name: "使用代詞", typicalAge: "21-24個月" }
                ],
                "社交/情緒發展": [
                    { name: "增強的自我意識", typicalAge: "19-24個月" },
                    { name: "開始出現情緒自我調節", typicalAge: "19-24個月" },
                    { name: "與其他兒童互動增多", typicalAge: "19-24個月" }
                ],
                "認知發展": [
                    { name: "分類能力增強", typicalAge: "19-24個月" },
                    { name: "記憶力提升", typicalAge: "19-24個月" },
                    { name: "開始理解更複雜的概念", typicalAge: "22-24個月" },
                    { name: "開始展現創造力", typicalAge: "19-24個月" }
                ]
            }
        };

        // 照顧提示數據定義
        const careTipsData = {
            "0-3": {
                "feeding": [
                    {
                        title: "餵食頻率",
                        description: "新生兒需要每2-3小時餵食一次，包括夜間。當寶寶開始顯示餓的信號（吸吮動作、把手放入嘴中、躁動不安）時應及時餵食。",
                        important: false
                    },
                    {
                        title: "餵哺母乳",
                        description: "母乳是嬰兒最理想的食物，建議純母乳餵養6個月。確保寶寶正確含接乳頭，以減少乳頭疼痛和提高餵養效率。",
                        important: false
                    },
                    {
                        title: "配方奶餵養",
                        description: "若使用配方奶，請確保正確的稀釋比例和溫度。不要強迫寶寶喝完每一瓶奶，而是根據他們的飢餓和飽足信號來判斷。",
                        important: false
                    },
                    {
                        title: "溢奶與嗝氣",
                        description: "餵食後讓寶寶直立抱持或靠在您的肩膀上輕拍背部幫助排氣。少量溢奶是正常的，但若溢奶過多或呈噴射狀，請諮詢醫生。",
                        important: false
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠時間",
                        description: "新生兒每天睡眠時間約14-17小時，但分散在一天中。睡眠和清醒的週期很短，通常每次睡2-3小時。",
                        important: false
                    },
                    {
                        title: "安全睡眠環境",
                        description: "寶寶應仰睡在堅固平坦的睡眠表面上，避免在嬰兒床中放置枕頭、毯子、玩具或其他軟物品，以降低嬰兒猝死症風險。",
                        important: true
                    },
                    {
                        title: "夜間照顧",
                        description: "夜間餵食和換尿布時，保持光線昏暗和活動最小化，幫助寶寶區分日夜。不要期望嬰兒在這個年齡段能夠整夜睡眠。",
                        important: false
                    },
                    {
                        title: "哄睡技巧",
                        description: "包裹襁褓、輕柔搖晃、白噪音、輕聲唱歌或溫柔的撫摸都可以幫助安撫寶寶入睡。嘗試不同方法找出對您寶寶最有效的方式。",
                        important: false
                    }
                ],
                "activity": [
                    {
                        title: "趴著時間",
                        description: "每天安排數次有監督的「趴著時間」，幫助寶寶鍛煉頸部和肩部肌肉。開始時可能只有幾分鐘，隨著寶寶適應逐漸延長。",
                        important: false
                    },
                    {
                        title: "視覺刺激",
                        description: "新生兒視力有限，喜歡高對比度的圖案和臉部。在寶寶清醒時間，提供黑白卡片或圖案，或與寶寶面對面互動。",
                        important: false
                    },
                    {
                        title: "溝通互動",
                        description: "經常與寶寶說話、唱歌和閱讀，即使他們還不理解。模仿寶寶的聲音和表情，建立早期溝通模式。",
                        important: false
                    },
                    {
                        title: "身體接觸",
                        description: "擁抱、撫摸和皮膚接觸對嬰兒的情感發展非常重要。可以嘗試嬰兒按摩，有助於放鬆和建立親密關係。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title:  "預防嬰兒猝死症",
                        description: "讓寶寶仰睡，避免過度包裹過熱，禁止在嬰兒床中放置鬆軟物品，避免二手煙暴露，考慮使用安撫奶嘴。",
                        important: true
                    },
                    {
                        title: "正確抱持",
                        description: "始終支撐寶寶的頭部和頸部，因為他們在3-4個月前無法自行支撐頭部。抱起或放下寶寶時要特別小心。",
                        important: true
                    },
                    {
                        title: "洗澡安全",
                        description: "永遠不要讓寶寶在水中無人看管，即使只有幾厘米深的水。準備好所有洗澡用品，保持一隻手始終在寶寶身上。",
                        important: true
                    },
                    {
                        title: "車輛安全",
                        description: "使用符合安全標準的後向式嬰兒汽車座椅，正確安裝並每次出行都使用，無論距離多短。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "臍帶護理",
                        description: "保持臍帶殘端乾燥，每次換尿布後用酒精棉簽輕輕清潔臍部周圍，直到臍帶脫落（通常在出生後1-2週）。",
                        important: false
                    },
                    {
                        title: "皮膚護理",
                        description: "新生兒皮膚非常敏感，建議使用溫水清潔，少用或不用肥皂。若出現皮疹、乾燥或其他問題，請諮詢醫生。",
                        important: false
                    },
                    {
                        title: "預防感染",
                        description: "限制訪客數量，確保所有接觸寶寶的人先洗手，避免讓有感冒或其他疾病的人接觸寶寶。",
                        important: true
                    },
                    {
                        title: "疫苗接種",
                        description: "按照醫生建議的時間表進行疫苗接種，保護寶寶免受嚴重疾病侵害。",
                        important: true
                    }
                ],
                "development": [
                    {
                        title: "哭泣與安撫",
                        description: "哭泣是寶寶溝通的主要方式。學習識別不同哭聲背後的需求（餓了、累了、尿布濕了）。抱起、輕搖、輕拍都有助於安撫。",
                        important: false
                    },
                    {
                        title: "視覺發展",
                        description: "新生兒視力約為20/200，最清楚看到距離20-30厘米的物體。他們喜歡看人臉和高對比度的幾何圖形。",
                        important: false
                    },
                    {
                        title: "聽覺刺激",
                        description: "嬰兒能夠識別父母的聲音。柔和地對他們說話、唱歌或播放柔和的音樂有助於聽覺發展和情感連結。",
                        important: false
                    },
                    {
                        title: "反射動作",
                        description: "新生兒有多種自然反射，如吸吮、抓握、驚嚇反射等。這些反射是正常的，隨著神經系統發展會逐漸消失。",
                        important: false
                    }
                ]
            },
            "4-6": {
                "feeding": [
                    {
                        title: "餵食節奏變化",
                        description: "4-6個月寶寶的餵食間隔會延長，可能每3-4小時吃一次。許多寶寶會開始整夜睡眠，不需要夜間餵食。",
                        important: false
                    },
                    {
                        title: "添加副食品時機",
                        description: "世界衛生組織建議6個月開始添加副食品。觀察寶寶是否出現準備好的信號：能坐直、對食物表現興趣、舌頭不再自動推出食物。",
                        important: false
                    },
                    {
                        title: "第一種副食品選擇",
                        description: "鐵強化的嬰兒米粉是良好的第一種副食品選擇，之後可嘗試單一蔬果泥。每次只引入一種新食物，間隔3-5天，以便觀察可能的過敏反應。",
                        important: false
                    },
                    {
                        title: "避免蜂蜜和牛奶",
                        description: "1歲前不要給寶寶蜂蜜（可能含有肉毒桿菌）或牛奶（難以消化且營養不適合嬰兒需求）。",
                        important: true
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠模式變化",
                        description: "4-6個月的寶寶每天總睡眠時間約12-15小時，夜間睡眠時間變長，日間可能有2-3次較長的午睡。",
                        important: false
                    },
                    {
                        title: "睡眠訓練",
                        description: "這個階段可以開始建立一致的睡前routine（如洗澡、換睡衣、讀書、輕聲歌唱），幫助寶寶適應規律的睡眠時間。",
                        important: false
                    },
                    {
                        title: "自我安撫",
                        description: "考慮讓寶寶在略微清醒狀態下入睡，幫助他們學習自我安撫的技能。當寶寶夜間短暫醒來時，他們可能更容易自行回到睡眠狀態。",
                        important: false
                    },
                    {
                        title: "睡眠回退",
                        description: "在這個階段，一些寶寶可能經歷「4個月睡眠回退」，這與睡眠週期成熟有關。保持一致的睡眠環境和常規能幫助度過這個階段。",
                        important: false
                    }
                ],
                "activity": [
                    {
                        title: "翻身練習",
                        description: "鼓勵寶寶練習翻身（從腹部到背部，從背部到腹部）。可以使用玩具引導寶寶向側邊移動。",
                        important: false
                    },
                    {
                        title: "抓握練習",
                        description: "提供安全的玩具讓寶寶抓握和探索。他們將開始用整個手掌抓握物品，並把東西放入口中進行探索。",
                        important: false
                    },
                    {
                        title: "玩具選擇",
                        description: "選擇有不同質地、聲音和顏色的安全玩具。搖鈴、軟積木、布書都是很好的選擇。玩具應足夠大，避免窒息危險。",
                        important: false
                    },
                    {
                        title: "社交遊戲",
                        description: "這個年齡段的寶寶喜歡互動遊戲，如躲貓貓、拍手遊戲等。他們開始理解因果關係，並享受重複的活動。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title: "開始預防跌落",
                        description: "隨著寶寶開始翻身和移動，不要將他們單獨留在沒有保護的高處（如床、沙發或換尿布台）。使用安全帶固定寶寶在嬰兒座椅中。",
                        important: true
                    },
                    {
                        title: "嬰兒床安全",
                        description: "確保嬰兒床符合安全標準，欄杆間距應小於6公分。床墊應牢固貼合床架，避免縫隙。不要在嬰兒床內放置枕頭、鬆軟的玩具或厚被子。",
                        important: true
                    },
                    {
                        title: "小物件危險",
                        description: "保持地板和寶寶可及範圍內沒有小物件，因為寶寶開始將物品放入口中。特別注意玩具部件、硬幣、紐扣、電池等。",
                        important: true
                    },
                    {
                        title: "家居安全檢查",
                        description: "開始為寶寶未來的爬行和移動做準備。檢查家中低處的電源插座，準備安裝櫥櫃鎖和門擋。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "定期體檢",
                        description: "按照兒科醫生建議的時間表進行體檢，通常在4個月和6個月各有一次。這些檢查會監測寶寶的生長、發展和健康狀況。",
                        important: false
                    },
                    {
                        title: "疫苗接種",
                        description: "繼續按照醫生建議的時間表接種疫苗。這個年齡段通常需要接種多種疫苗的下一劑量。",
                        important: true
                    },
                    {
                        title: "口腔護理",
                        description: "即使還沒有牙齒，也應開始清潔寶寶的牙齦。可以用乾淨的濕紗布輕輕擦拭牙齦，為將來的刷牙習慣做準備。",
                        important: false
                    },
                    {
                        title: "出牙症狀與處理",
                        description: "有些寶寶可能在4-6個月開始出牙。常見症狀包括流口水增多、牙齦腫脹、煩躁不安。冷凍的磨牙玩具、按摩牙齦可以緩解不適。",
                        important: false
                    }
                ],
                "development": [
                    {
                        title: "社交發展",
                        description: "這個年齡段的寶寶開始明顯地對人表現出興趣，並能分辨熟悉的面孔。他們可能開始對陌生人感到警惕。與寶寶多互動，有助於建立安全感。",
                        important: false
                    },
                    {
                        title: "語言發展",
                        description: "寶寶開始嘗試發出更多元音和輔音組合（「ba-ba」、「ma-ma」等）。與寶寶說話、唱歌、閱讀有助於語言發展。",
                        important: false
                    },
                    {
                        title: "認知發展",
                        description: "寶寶開始對因果關係產生興趣（「我做這個動作會有什麼結果？」）。提供安全的探索機會，讓寶寶測試不同行為的結果。",
                        important: false
                    },
                    {
                        title: "獨立性萌芽",
                        description: "寶寶開始表現獨立的欲望，他們可能會拒絕某些食物或抗拒特定的活動。在安全範圍內給予適當的選擇有助於培養決策能力。",
                        important: false
                    }
                ]
            },
            "7-9": {
                "feeding": [
                    {
                        title: "副食品進展",
                        description: "隨著寶寶適應副食品，可逐漸增加食物種類、質地和份量。從泥狀食物過渡到較粗的碎塊，幫助寶寶發展咀嚼技能。",
                        important: false
                    },
                    {
                        title: "自主進食嘗試",
                        description: "鼓勵寶寶開始用手抓取食物，嘗試自己進食。提供適合手抓的食物（如煮爛的蔬果條、穀物圈等），促進精細運動發展和進食獨立性。",
                        important: false
                    },
                    {
                        title: "注意過敏原",
                        description: "這個階段可以開始引入常見過敏原（如魚、雞蛋、麩質、堅果醬等），每次只引入一種，間隔3-5天，觀察過敏反應。研究顯示早期接觸可能降低過敏風險。",
                        important: true
                    },
                    {
                        title: "進食節奏變化",
                        description: "嬰兒可能開始顯示對食物的偏好或拒絕，胃口也可能有所波動。保持耐心，不強迫進食，培養健康的飲食關係。母乳或配方奶仍是主要營養來源。",
                        important: false
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠時間調整",
                        description: "7-9個月的寶寶每天總睡眠時間約12-14小時，通常包括夜間10-12小時和2次日間午睡。留意過度疲勞的信號，及時安排休息。",
                        important: false
                    },
                    {
                        title: "分離焦慮與睡眠",
                        description: "這個階段寶寶可能出現分離焦慮，影響睡眠。建立一致的睡前儀式和安撫物（如特定的小毯子或玩具）可以提供安全感。",
                        important: false
                    },
                    {
                        title: "睡眠環境更新",
                        description: "隨著寶寶變得更活躍，確保睡眠環境的安全：降低嬰兒床的床墊高度，移除床欄上的保護墊（如有），避免在床上放置可能成為攀爬工具的大型玩具。",
                        important: true
                    },
                    {
                        title: "夜醒處理",
                        description: "可能出現的夜醒增多與發展里程碑（如爬行、站立）、出牙或分離焦慮有關。保持一致的應對策略，給予簡短的安撫後鼓勵自主入睡。",
                        important: false
                    }
                ],
                "activity": [
                    {
                        title: "爬行與移動",
                        description: "鼓勵和創造安全的爬行空間。可以設置簡單的障礙物（如枕頭或軟墊）供寶寶爬過，強化肌肉發展。",
                        important: false
                    },
                    {
                        title: "精細運動發展",
                        description: "提供能促進拇指和食指使用的活動，如拿取小物件（在監督下）、翻書頁、敲打玩具。確保所有小物件足夠大，避免噎食危險。",
                        important: false
                    },
                    {
                        title: "互動遊戲",
                        description: "這個階段寶寶喜歡互動性更強的遊戲，如拋接球、放入取出玩具、躲貓貓等。這些遊戲有助於認知發展和因果關係理解。",
                        important: false
                    },
                    {
                        title: "戶外活動",
                        description: "定期帶寶寶到戶外，接觸陽光和新鮮空氣。讓寶寶感受不同的環境、聲音和視覺刺激，有助於感官發展。注意防曬和適當著裝。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title: "移動安全",
                        description: "隨著寶寶開始爬行，需重新評估家居安全：安裝樓梯門、固定家具（如書架）到牆壁、遮蓋電源插座、移除或固定桌巾和電線等。",
                        important: true
                    },
                    {
                        title: "廚房和浴室安全",
                        description: "廚房和浴室充滿危險：使用爐灶安全罩、鎖住含化學品的櫥櫃、確保熱水溫度不超過49度C、永遠不在無人看管時將寶寶留在浴缸中。",
                        important: true
                    },
                    {
                        title: "噎食預防",
                        description: "寶寶會將一切放入口中。避免可能造成噎食的小物品（硬幣、鈕扣、電池、玩具小零件等）。學習嬰兒heimlich急救法和CPR。",
                        important: true
                    },
                    {
                        title: "睡眠姿勢",
                        description: "即使寶寶能自己翻身，也應該將他們放在仰臥位開始睡眠。如果他們自己翻身，可以讓他們保持那個姿勢，但床上不應有鬆軟物品。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "出牙護理",
                        description: "大多數寶寶在這個階段會長出第一顆牙。使用嬰兒指套牙刷或濕紗布輕輕清潔牙齒。避免含糖飲料和長時間含奶瓶睡覺，以防蛀牙。",
                        important: false
                    },
                    {
                        title: "感冒和生病",
                        description: "隨著寶寶接觸更多環境，可能更頻繁地生病。學習識別需要就醫的信號：高燒（38°C以上）、呼吸困難、嚴重脫水跡象等。",
                        important: true
                    },
                    {
                        title: "飲水習慣",
                        description: "隨著副食品增加，可以開始提供少量水。使用杯子而非奶瓶，培養飲水習慣。避免果汁和含糖飲料。",
                        important: false
                    },
                    {
                        title: "預防中耳炎",
                        description: "避免讓寶寶含著奶瓶睡覺，這可能增加中耳炎風險。如果寶寶出現耳朵疼痛、發燒或拉扯耳朵的行為，應諮詢醫生。",
                        important: false
                    }
                ],
                "development": [
                    {
                        title: "陌生人焦慮",
                        description: "很多寶寶在這個階段開始出現對陌生人的焦慮。這是正常的認知發展標誌，表明寶寶能分辨熟悉和陌生的人。給予安撫和時間適應。",
                        important: false
                    },
                    {
                        title: "語言發展",
                        description: "寶寶可能開始理解簡單的詞語和指令。常與寶寶交談，命名物品和動作，閱讀書籍，這些都有助於語言發展。",
                        important: false
                    },
                    {
                        title: "情感發展",
                        description: "寶寶開始表達更多情緒，可能有明顯的喜好和不喜歡。接納並命名這些情緒（「你看起來很開心/生氣」），有助於情緒認知發展。",
                        important: false
                    },
                    {
                        title: "社交遊戲",
                        description: "寶寶開始享受社交互動遊戲，如拍手遊戲、丟接球等。這些遊戲有助於社交技能發展，並強化親子連結。",
                        important: false
                    }
                ]
            },
            "10-12": {
                "feeding": [
                    {
                        title: "進食技能發展",
                        description: "鼓勵寶寶嘗試用杯子喝水和使用勺子。雖然可能會弄得一團糟，但這是發展獨立進食技能的重要階段。使用無蓋練習杯，讓寶寶學習控制液體流量。",
                        important: false
                    },
                    {
                        title: "食物多樣化",
                        description: "提供多樣化的食物，包括不同質地、味道和營養成分。嘗試將食物切成小塊而非總是泥狀，促進咀嚼技能發展。",
                        important: false
                    },
                    {
                        title: "家庭用餐參與",
                        description: "盡可能讓寶寶加入家庭用餐時間。這不僅提供社交學習機會，還能鼓勵他們通過觀察學習飲食習慣和餐桌禮儀。",
                        important: false
                    },
                    {
                        title: "營養均衡",
                        description: "嘗試每天提供五大類食物：穀類、蛋白質、奶製品、水果和蔬菜。母乳或配方奶仍然是重要的營養來源，直到1歲。",
                        important: false
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠調整",
                        description: "寶寶可能從兩次午睡過渡到一次較長的午睡。注意疲勞信號，調整作息時間表。一些寶寶可能開始通宵睡覺(10-12小時)。",
                        important: false
                    },
                    {
                        title: "睡眠回退",
                        description: "行走和語言等重要發展里程碑可能暫時影響睡眠。保持一致的睡前常規，提供安全感，幫助度過這個階段。",
                        important: false
                    },
                    {
                        title: "睡眠環境安全",
                        description: "如果寶寶能站立，確保降低嬰兒床床墊高度，移除床欄上的保護墊和大型玩具，防止攀爬跌落。",
                        important: true
                    },
                    {
                        title: "安撫物依賴",
                        description: "寶寶可能對特定的安撫物(如毯子或玩具)產生依賴。允許這種依賴是正常的，有助於提供安全感和自我安撫能力。考慮準備備用品。",
                        important: false
                    }
                ],
                "activity": [
                    {
                        title: "粗大運動發展",
                        description: "鼓勵寶寶練習站立和走路。可以提供推行玩具或在安全環境中讓他們扶著家具「巡航」。這有助於平衡感和協調性發展。",
                        important: false
                    },
                    {
                        title: "精細運動遊戲",
                        description: "提供能促進精細運動技能的活動，如堆疊積木、放入取出遊戲、簡單拼圖等。這些活動有助於手眼協調和手部控制能力。",
                        important: false
                    },
                    {
                        title: "語言互動",
                        description: "大量閱讀、唱歌和對話。鼓勵寶寶通過手勢、聲音和簡單詞彙表達需求。回應寶寶的溝通嘗試，強化語言發展。",
                        important: false
                    },
                    {
                        title: "社交遊戲",
                        description: "安排與其他兒童的遊戲時間。雖然這個年齡段的寶寶主要進行「平行遊戲」(並排玩耍但不一定互動)，但這為未來的社交技能奠定基礎。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title: "行走安全",
                        description: "隨著寶寶學習走路，重新檢查家居安全：確保地板清潔無滑倒危險、固定可能被拉倒的物品、保護尖銳角落、封鎖樓梯。",
                        important: true
                    },
                    {
                        title: "更廣泛的探索範圍",
                        description: "寶寶現在能夠到達更高的地方，並對打開抽屜和櫥櫃感興趣。使用安全鎖，將清潔產品、藥物和危險物品移至高處上鎖的櫥櫃。",
                        important: true
                    },
                    {
                        title: "戶外安全",
                        description: "使用適合寶寶新獲得運動能力的戶外裝備：正確調整的安全座椅、穩固的嬰兒車、適合的遊樂設備。在水邊時刻保持警惕，即使是淺水。",
                        important: true
                    },
                    {
                        title: "窒息風險意識",
                        description: "寶寶仍會將一切放入口中。避免直徑小於4.5厘米的小物品，特別注意玩具的小零件、食物(如整顆葡萄、堅果)、硬幣等。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "定期體檢",
                        description: "保持定期體檢和免疫接種計劃。這個年齡通常有12個月的體檢，可能包括血液篩查(如鐵水平檢測)和新的疫苗。",
                        important: false
                    },
                    {
                        title: "牙齒護理",
                        description: "隨著更多牙齒長出，每天早晚使用軟毛嬰兒牙刷和一粒豌豆大小的氟化物牙膏清潔。考慮安排第一次牙科檢查。",
                        important: false
                    },
                    {
                        title: "手部衛生",
                        description: "隨著寶寶接觸的環境擴大，定期洗手變得更加重要。在進食前、戶外活動後教導簡單的洗手習慣，預防疾病傳播。",
                        important: false
                    },
                    {
                        title: "常見疾病跡象",
                        description: "了解需要就醫的跡象：持續高燒、嘔吐或腹瀉超過24小時、明顯的活力減退、呼吸困難、皮疹伴隨發燒等。",
                        important: true
                    }
                ],
                "development": [
                    {
                        title: "語言里程碑",
                        description: "大多數寶寶在這個階段會說出第一個有意義的詞語，理解簡單的指令，並開始使用手勢溝通。持續閱讀、說話和歌唱有助於語言發展。",
                        important: false
                    },
                    {
                        title: "模仿行為",
                        description: "寶寶開始積極模仿成人行為，如用梳子梳頭、假裝打電話。提供安全的家庭物品讓寶寶在監督下玩耍，支持這種學習。",
                        important: false
                    },
                    {
                        title: "情緒發展",
                        description: "寶寶可能經歷更廣泛的情緒，包括沮喪和固執。保持冷靜，提供情感支持和引導，同時為未來的情緒調節奠定基礎。",
                        important: false
                    },
                    {
                        title: "認知發展",
                        description: "寶寶開始理解物體永久性(當物體看不見時仍然存在)，並能解決簡單的問題，如找到藏起來的玩具。玩藏物遊戲和提供簡單的玩具挑戰有助於認知發展。",
                        important: false
                    }
                ]
            },
            "13-18": {
                "feeding": [
                    {
                        title: "餵食轉變",
                        description: "一歲後，寶寶可以開始喝全脂牛奶，取代部分母乳或配方奶。食物應成為主要營養來源，奶為輔助。避免低脂或脫脂奶，幼兒需要脂肪支持大腦發展。",
                        important: false
                    },
                    {
                        title: "獨立進食",
                        description: "大部分幼兒喜歡自己進食，即使這意味著弄得一團糟。提供適合的工具（短柄勺、肥皂防滑碗、有握把的杯子），培養自主進食能力。適當時進行協助，但讓孩子練習。",
                        important: false
                    },
                    {
                        title: "應對挑食",
                        description: "幼兒可能開始變得挑食，這是正常的發展階段。保持耐心，持續提供各種健康食物，包括之前拒絕的食物。不要將食物作為獎勵或懲罰，避免強迫進食。",
                        important: false
                    },
                    {
                        title: "膳食結構",
                        description: "建立規律的飲食節奏，包括三餐和2-3次健康點心。提供各種食物，包括水果、蔬菜、全穀類、瘦肉蛋白和乳製品。控制甜食和加工食品攝入量。",
                        important: false
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠需求變化",
                        description: "幼兒每天需要11-14小時睡眠，包括夜間和1-2次午睡。大約18個月時，一些孩子可能從兩次午睡過渡到一次午睡。注意疲勞信號，調整作息。",
                        important: false
                    },
                    {
                        title: "睡眠抗拒",
                        description: "幼兒可能出現上床睡覺的抗拒行為，這與獨立性發展和分離焦慮有關。建立一致、可預測的睡前常規（如洗澡、讀書、輕聲歌唱）有助於順利過渡到睡眠。",
                        important: false
                    },
                    {
                        title: "夜間恐懼",
                        description: "夢魘和夜間恐懼可能在這個階段出現。保持冷靜，提供安慰，但避免過度刺激。小夜燈可能有所幫助。如果夜間恐懼頻繁或嚴重，諮詢醫生。",
                        important: false
                    },
                    {
                        title: "床位轉換考慮",
                        description: "如果幼兒嘗試爬出嬰兒床，可能需要考慮轉換到幼兒床。確保幼兒床有護欄，移除周圍可能被用於攀爬的家具，使睡眠環境安全。",
                        important: true
                    }
                ],
                "activity": [
                    {
                        title: "運動發展",
                        description: "幼兒正在精進行走、跑步、爬樓梯和踢球等技能。提供安全的空間和機會練習這些技能，包括戶外活動時間。根據能力調整期望，允許嘗試和錯誤。",
                        important: false
                    },
                    {
                        title: "創意表達",
                        description: "提供安全的藝術材料（大蠟筆、指畫顏料、Play-Doh）鼓勵創意表達。關注過程而非結果，讚美努力和探索。注意避免可能被吞食的小物品。",
                        important: false
                    },
                    {
                        title: "玩具選擇",
                        description: "選擇促進想像力和解決問題能力的玩具：積木、簡單拼圖、玩偶、球和推拉玩具等。不需要昂貴或電子玩具，簡單的家居物品（鍋碗瓢盆）同樣具有教育價值。",
                        important: false
                    },
                    {
                        title: "互動遊戲",
                        description: "幼兒通過遊戲學習。提供結構性（由成人引導）和非結構性（自由探索）遊戲的平衡。參與角色扮演、追逐遊戲和簡單的躲藏遊戲有助於認知和社交發展。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title: "升級家居安全",
                        description: "隨著幼兒能力增強，重新評估家居安全：確保繩索、盆栽、小物件放置在夠不著的地方，所有傢俱固定到牆上，窗戶有安全防護，浴室門上鎖。",
                        important: true
                    },
                    {
                        title: "戶外安全",
                        description: "監督所有戶外活動。教導基本安全規則，如過馬路時拉著大人的手、不跟陌生人走。確保遊樂設備適合年齡，表面下方有軟墊。",
                        important: true
                    },
                    {
                        title: "交通安全",
                        description: "使用適合幼兒年齡、體重和身高的汽車安全座椅，正確安裝並每次乘車都使用。根據當地法規，幼兒應儘可能長時間地乘坐後向式座椅。",
                        important: true
                    },
                    {
                        title: "水上安全",
                        description: "永遠不要讓幼兒在水邊無人看管，即使是淺水。在家中確保浴缸、水桶、游泳池在不使用時排空或加蓋。考慮讓幼兒參加游泳安全課程。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "牙齒護理",
                        description: "每天刷牙兩次，使用豌豆大小的含氟牙膏。避免讓幼兒含著裝有牛奶或果汁的杯子走動或睡覺，以防蛀牙。安排首次牙科檢查（如尚未進行）。",
                        important: false
                    },
                    {
                        title: "疾病預防",
                        description: "教導基本衛生習慣，如咳嗽時遮住口鼻、定期洗手。保持免疫接種最新。幼兒進入托兒所後可能更頻繁生病，這有助於建立免疫系統。",
                        important: false
                    },
                    {
                        title: "餐具安全",
                        description: "確保餐具、杯子和餐盤無BPA、鉛和其他有害物質。選擇耐用、不易碎的兒童餐具。避免過熱的食物和飲料，防止燙傷。",
                        important: false
                    },
                    {
                        title: "如廁訓練準備",
                        description: "注意如廁訓練準備信號：尿布保持乾爽更長時間、對廁所表現興趣、能理解簡單指令、能表達需求。沒必要著急，每個孩子發展步調不同。",
                        important: false
                    }
                ],
                "development": [
                    {
                        title: "語言爆發",
                        description: "詞彙量迅速增加，開始組合詞語成短句。豐富語言環境：讀書、說話、歌唱、命名物品和動作。避免嬰兒語，使用正確詞彙，但保持語言簡單清晰。",
                        important: false
                    },
                    {
                        title: "情緒管理",
                        description: "可能出現脾氣爆發，這與挫折感和表達能力有限有關。保持冷靜，建立界限，同時承認情緒（「我知道你生氣，但我們不能打人」）。轉移注意力和提供選擇有助於避免權力之爭。",
                        important: false
                    },
                    {
                        title: "自主性發展",
                        description: "「不」可能成為最常用詞。這表明健康的自主性發展。提供安全的選擇讓幼兒做決定，在可能的情況下尊重偏好，同時保持必要的界限。",
                        important: false
                    },
                    {
                        title: "社交互動",
                        description: "開始對其他孩子產生興趣，但主要進行平行遊戲。安排與同齡人的遊戲機會，但不要期望大量分享和合作行為。教導簡單的社交技能，如輪流和溫和碰觸。",
                        important: false
                    }
                ]
            },
            "19-24": {
                "feeding": [
                    {
                        title: "營養平衡",
                        description: "提供多樣化、均衡的飲食，包括所有食物組：穀物、蛋白質、奶製品、水果和蔬菜。幼兒食量可能因成長速度變化而波動，信任他們的飢餓和飽足信號。",
                        important: false
                    },
                    {
                        title: "進食技能發展",
                        description: "大多數幼兒能夠使用勺子，開始練習用叉子。提供適合大小的餐具和機會練習，同時理解這是一個過程，會有混亂。進食時間是發展精細運動技能和獨立性的機會。",
                        important: false
                    },
                    {
                        title: "建立健康關係",
                        description: "避免使用食物作為獎勵或懲罰。努力創造輕鬆、愉快的用餐環境，讓孩子參與準備和選擇健康食物。成為良好飲食習慣的榜樣，一起用餐。",
                        important: false
                    },
                    {
                        title: "處理挑食期",
                        description: "挑食和食物偏好很常見。不要強迫進食，保持耐心，繼續提供各種食物。研究表明，孩子可能需要嘗試新食物10-15次才能接受。讓他們參與食物選擇和準備可能增加嘗試意願。",
                        important: false
                    }
                ],
                "sleep": [
                    {
                        title: "睡眠模式變化",
                        description: "2歲左右的幼兒每天需要11-14小時睡眠，包括10-12小時夜間睡眠和1-2小時午睡。有些孩子可能開始抗拒午睡，但大多數仍需要午間休息至少到3-4歲。",
                        important: false
                    },
                    {
                        title: "床位轉換",
                        description: "如果尚未進行，可能是時候考慮從嬰兒床轉到幼兒床。選擇合適的時機（避免與其他重大變化同時進行），保持興奮和積極的態度，維持一致的睡前常規。",
                        important: false
                    },
                    {
                        title: "睡前抗拒與拖延",
                        description: "睡前抗拒常見於這個年齡段。建立清晰、可預測的常規，包括固定的睡前活動、溫馨但堅定的界限，以及為明天做準備的安撫對話。",
                        important: false
                    },
                    {
                        title: "夜間恐懼",
                        description: "想像力發展可能導致對黑暗或怪物的恐懼增加。小夜燈、檢查房間的「儀式」和安撫物品可能有幫助。認真對待恐懼但保持冷靜，避免強化不必要的擔憂。",
                        important: false
                    }
                ],
                "activity": [
                    {
                        title: "身體活動需求",
                        description: "每天至少提供1-2小時的活躍玩耍時間。包括結構性活動（如帶領的遊戲）和非結構性自由玩耍，兩者都很重要。戶外時間特別有益，促進運動技能、創意和感官發展。",
                        important: false
                    },
                    {
                        title: "想像力遊戲",
                        description: "想像力遊戲在這個階段蓬勃發展。提供簡單的玩具和道具（娃娃、廚房物品、毛絨動物、模擬工具）支持角色扮演和創意表達。參與孩子的遊戲，但也允許獨立探索。",
                        important: false
                    },
                    {
                        title: "讀書與語言",
                        description: "每天閱讀多本書，選擇有趣的故事和信息類書籍。鼓勵互動（「你能找到狗嗎？」「你認為接下來會發生什麼？」）和講故事。這對語言發展、專注力和想像力有巨大益處。",
                        important: false
                    },
                    {
                        title: "適合發展的玩具",
                        description: "選擇促進問題解決和精細運動技能的玩具：大塊拼圖、簡單的形狀分類器、大型積木、蠟筆和紙、堆疊和配對遊戲。不需要昂貴或過於複雜的玩具，簡單物品常常更有價值。",
                        important: false
                    }
                ],
                "safety": [
                    {
                        title: "持續的安全監督",
                        description: "即使獨立性增強，幼兒仍需持續監督。他們缺乏危險判斷能力，加上新獲得的攀爬、開門和操作物品的技能，可能導致新的安全風險。",
                        important: true
                    },
                    {
                        title: "水上安全",
                        description: "溺水是這個年齡段的主要致命風險之一。永遠不要在無監督情況下讓幼兒接近水源，包括浴缸、水桶、游泳池。考慮讓幼兒參加游泳課程，教導基本水上安全。",
                        important: true
                    },
                    {
                        title: "毒物防護",
                        description: "更新家庭毒物保護：將清潔用品、藥物、維生素、植物置於幼兒無法觸及的地方，最好上鎖。教導孩子未經允許不得食用任何東西。將毒物控制中心電話號碼放在顯眼位置。",
                        important: true
                    },
                    {
                        title: "交通安全",
                        description: "繼續使用適合幼兒體重和身高的汽車安全座椅。開始教導基本交通安全規則：過馬路時牽手、認識停止標誌、理解交通信號燈的含義。",
                        important: true
                    }
                ],
                "health": [
                    {
                        title: "定期健康檢查",
                        description: "維持定期兒科檢查計劃，通常在24個月時有一次重要體檢。包括視力、聽力和發展篩查，以及所需的免疫接種。",
                        important: false
                    },
                    {
                        title: "如廁訓練",
                        description: "許多孩子在2歲左右開始對如廁訓練感興趣，但準備度因人而異。尋找準備跡象：能保持尿布乾爽更長時間、表達廁所需求、能夠理解和遵循指示、對獨立性有興趣。",
                        important: false
                    },
                    {
                        title: "牙齒護理",
                        description: "加強口腔衛生習慣：每天刷牙兩次，使用豌豆大小的含氟牙膏。限制含糖食物和飲料，尤其是粘性零食。至少每六個月進行一次牙科檢查。",
                        important: false
                    },
                    {
                        title: "健康界限",
                        description: "開始教導身體界限和隱私概念。使用正確的身體部位名稱，解釋「私密」區域和適當/不適當的碰觸。培養孩子在感到不舒服時說「不」的自信。",
                        important: true
                    }
                ],
                "development": [
                    {
                        title: "語言發展高峰",
                        description: "詞彙量急劇增加，開始形成簡單句子。擴展孩子的表達（孩子說「車」，你可以說「是的，那是一輛紅色的大卡車」）。閱讀、交談和限制螢幕時間有助於語言發展。",
                        important: false
                    },
                    {
                        title: "社交技能發展",
                        description: "開始過渡到更多合作性遊戲，但仍主要是平行遊戲。安排與其他孩子的遊戲時間，溫和地引導分享和輪流。期望仍會有衝突，這是正常的學習過程。",
                        important: false
                    },
                    {
                        title: "情緒管理",
                        description: "脾氣爆發在這個年齡段很常見，反映了獨立欲望與能力的不平衡。保持冷靜，提供情感詞彙表達感受，教導簡單的自我調節技能，如深呼吸或尋求幫助。",
                        important: false
                    },
                    {
                        title: "認知發展里程碑",
                        description: "理解簡單的時間概念（「之後」、「明天」）、分類物體、記憶歌曲和故事、參與更複雜的假裝遊戲。鼓勵問題解決和探索，給予思考的時間和空間。",
                        important: false
                    }
                ]
            }
        };

        // 初始化應用程式
        function initApp() {
            loadData();
            initEventListeners();
            setCurrentDateTime();
            updateChildSelector();
            checkSelectedChild();
            initQuickActionButtons();
            checkPermission();
            checkAndUpdateReminders();
        }

        // 載入資料
        function loadData() {
            const savedChildren = localStorage.getItem('children');
            if (savedChildren) {
                appData.children = JSON.parse(savedChildren);
            }
            
            const selectedChildId = localStorage.getItem('selectedChild');
            if (selectedChildId) {
                appData.selectedChild = selectedChildId;
                loadChildData(selectedChildId);
            }

            // 載入快速記錄選項
            const quickOptions = localStorage.getItem('quickOptions');
            if (quickOptions) {
                appData.quickOptions = JSON.parse(quickOptions);
            } else {
                // 初始化默認快速選項
                appData.quickOptions = {
                    feeding: [
                        { type: '母乳', amount: '15', unit: 'min' },
                        { type: '配方奶', amount: '120', unit: 'ml' },
                        { type: '副食品', amount: '1', unit: '份' }
                    ],
                    lastFeeding: null,
                    sleepStartTime: null
                };
                saveQuickOptions();
            }

            // 載入提醒資料
            const reminders = localStorage.getItem('reminders');
            if (reminders) {
                appData.reminders = JSON.parse(reminders);
            } else {
                appData.reminders = {};
                saveReminders();
            }

            // 檢查是否有進行中的睡眠記錄
            checkOngoingSleep();
        }

        // 載入特定兒童的資料
        function loadChildData(childId) {
            if (!childId) return;
            
            const records = localStorage.getItem(`records_${childId}`);
            if (records) {
                appData.records[childId] = JSON.parse(records);
            } else {
                appData.records[childId] = [];
            }
            
            const milestones = localStorage.getItem(`milestones_${childId}`);
            if (milestones) {
                appData.milestones[childId] = JSON.parse(milestones);
            } else {
                // 初始化里程碑資料
                initMilestones(childId);
            }
        }

        // 儲存快速記錄選項
        function saveQuickOptions() {
            localStorage.setItem('quickOptions', JSON.stringify(appData.quickOptions));
        }

        // 儲存提醒資料
        function saveReminders() {
            localStorage.setItem('reminders', JSON.stringify(appData.reminders));
        }

        // 檢查是否有進行中的睡眠記錄
        function checkOngoingSleep() {
            const sleepStartTime = appData.quickOptions.sleepStartTime;
            if (sleepStartTime) {
                const startTime = new Date(sleepStartTime);
                // 更新睡眠計時器顯示
                updateSleepTimerDisplay(startTime);
                document.getElementById('sleepTimerBadge').classList.add('active');
            }
        }

        // 初始化里程碑資料
        function initMilestones(childId) {
            appData.milestones[childId] = {};
            
            for (const ageGroup in milestonesDefinition) {
                for (const category in milestonesDefinition[ageGroup]) {
                    milestonesDefinition[ageGroup][category].forEach(milestone => {
                        const milestoneId = `${ageGroup}_${category}_${milestone.name}`;
                        if (!appData.milestones[childId]) {
                            appData.milestones[childId] = {};
                        }
                        appData.milestones[childId][milestoneId] = {
                            achieved: false,
                            date: ''
                        };
                    });
                }
            }
            
            saveMilestones(childId);
        }

        // 儲存里程碑資料
        function saveMilestones(childId) {
            localStorage.setItem(`milestones_${childId}`, JSON.stringify(appData.milestones[childId]));
        }

        // 儲存兒童資料
        function saveChildren() {
            localStorage.setItem('children', JSON.stringify(appData.children));
        }

        // 儲存記錄資料
        function saveRecords(childId) {
            localStorage.setItem(`records_${childId}`, JSON.stringify(appData.records[childId]));
        }

        // 檢查通知權限
        function checkPermission() {
            if (!("Notification" in window)) {
                console.log("此瀏覽器不支援桌面通知");
                return;
            }

            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                document.getElementById("reminderTab").addEventListener("click", function() {
                    Notification.requestPermission();
                });
            }
        }

        // 初始化事件監聽器
        function initEventListeners() {
            // 導航切換
            document.querySelectorAll('.nav-tab, .bottom-nav-item').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // 新增兒童按鈕
            document.getElementById('addChildBtn').addEventListener('click', showAddChildModal);
            
            // 兒童選擇器變更
            document.getElementById('childSelect').addEventListener('change', function() {
                const childId = this.value;
                selectChild(childId);
            });
            
            // 模態框關閉按鈕
            document.querySelectorAll('.modal-close, #cancelAddChildBtn').forEach(btn => {
                btn.addEventListener('click', closeModals);
            });
            
            // 儲存兒童按鈕
            document.getElementById('saveChildBtn').addEventListener('click', saveChild);
            
            // 記錄類型選擇器
            document.querySelectorAll('.record-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const recordType = this.getAttribute('data-record-type');
                    switchRecordForm(recordType);
                });
            });
            
            // 評分系統
            document.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const ratingGroup = this.closest('.rating');
                    const ratingId = ratingGroup.id;
                    const hiddenInput = document.getElementById(ratingId.replace('Rating', ''));
                    hiddenInput.value = value;
                    
                    // 更新星星顯示
                    ratingGroup.querySelectorAll('.rating-star').forEach(s => {
                        if (parseInt(s.getAttribute('data-value')) <= parseInt(value)) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });
            
            // 各類型記錄表單儲存按鈕
            document.getElementById('saveFeedingBtn').addEventListener('click', () => saveRecord('feeding'));
            document.getElementById('saveSleepBtn').addEventListener('click', () => saveRecord('sleep'));
            document.getElementById('saveDiaperBtn').addEventListener('click', () => saveRecord('diaper'));
            document.getElementById('saveEmotionBtn').addEventListener('click', () => saveRecord('emotion'));
            document.getElementById('saveActivityBtn').addEventListener('click', () => saveRecord('activity'));
            document.getElementById('saveOtherBtn').addEventListener('click', () => saveRecord('other'));
            
            // 歷史記錄日期選擇和篩選
            document.getElementById('historyDate').addEventListener('change', updateHistoryView);
            document.getElementById('historyFilter').addEventListener('change', updateHistoryView);
            
            // 里程碑篩選
            document.getElementById('milestoneFilter').addEventListener('change', updateMilestoneView);
            
            // 照顧提示類別篩選
            document.getElementById('caretipsCategory').addEventListener('change', updateCareTipsView);
            
            // 統計時間範圍選擇
            document.querySelectorAll('.stats-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.stats-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const period = this.getAttribute('data-period');
                    if (period === 'custom') {
                        document.querySelector('.stats-custom-period').style.display = 'flex';
                    } else {
                        document.querySelector('.stats-custom-period').style.display = 'none';
                        updateStatsView(period);
                    }
                });
            });
            
            // 套用自訂統計時間範圍
            document.getElementById('statsApplyCustom').addEventListener('click', function() {
                const startDate = document.getElementById('statsStartDate').value;
                const endDate = document.getElementById('statsEndDate').value;
                if (startDate && endDate) {
                    updateStatsView('custom', { startDate, endDate });
                }
            });
            
            // 匯出選項
            document.getElementById('exportAllTypes').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('input[name="exportType"]');
                checkboxes.forEach(cb => {
                    cb.checked = this.checked;
                    cb.disabled = this.checked;
                });
            });
            
            document.getElementById('exportAllDates').addEventListener('change', function() {
                const dateRange = document.getElementById('exportDateRange');
                dateRange.style.display = this.checked ? 'none' : 'block';
            });
            
            // 匯出按鈕
            document.getElementById('exportCSVBtn').addEventListener('click', exportToCSV);
            
            // 編輯記錄模態框按鈕
            document.getElementById('updateRecordBtn').addEventListener('click', updateRecord);
            document.getElementById('deleteRecordBtn').addEventListener('click', deleteRecord);
            document.getElementById('cancelEditRecordBtn').addEventListener('click', closeModals);
            
            // 刪除兒童按鈕和模態框
            document.getElementById('deleteChildBtn').addEventListener('click', showDeleteChildModal);
            document.getElementById('confirmDeleteChildBtn').addEventListener('click', deleteSelectedChild);
            document.getElementById('cancelDeleteChildBtn').addEventListener('click', closeModals);
            
            // 全部數據匯出按鈕
            document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);
            
            // 匯入功能按鈕
            document.getElementById('importFileBtn').addEventListener('click', function() {
                document.getElementById('importFileInput').click();
            });
            document.getElementById('importFileInput').addEventListener('change', handleImportFileSelect);
            document.getElementById('importDataBtn').addEventListener('click', showImportConfirmModal);
            document.getElementById('confirmImportBtn').addEventListener('click', importData);
            document.getElementById('cancelImportBtn').addEventListener('click', closeModals);

            // 快速尿布選項
            document.querySelectorAll('.diaper-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.diaper-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // 快速記錄模態框按鈕
            document.getElementById('saveQuickFeedingBtn').addEventListener('click', saveQuickFeeding);
            document.getElementById('cancelQuickFeedingBtn').addEventListener('click', closeModals);
            document.getElementById('saveQuickDiaperBtn').addEventListener('click', saveQuickDiaper);
            document.getElementById('cancelQuickDiaperBtn').addEventListener('click', closeModals);
            document.getElementById('saveQuickOtherBtn').addEventListener('click', saveQuickOther);
            document.getElementById('cancelQuickOtherBtn').addEventListener('click', closeModals);

            // 遮罩層點擊關閉所有模態框
            document.getElementById('overlay').addEventListener('click', function() {
                closeModals();
                closeQuickActionMenu();
            });

            // 新增：提醒相關事件監聽器
            // 新增提醒按鈕
            document.getElementById('addReminderBtn').addEventListener('click', showAddReminderModal);
            document.getElementById('saveReminderBtn').addEventListener('click', saveReminder);
            document.getElementById('cancelAddReminderBtn').addEventListener('click', closeModals);
            
            // 提醒篩選器
            document.getElementById('reminderFilter').addEventListener('change', updateReminderView);
            
            // 清除已完成提醒按鈕
            document.getElementById('clearCompletedRemindersBtn').addEventListener('click', clearCompletedReminders);
            
            // 提醒重複選項
            document.getElementById('reminderRepeat').addEventListener('change', function() {
                const repeatDetails = document.getElementById('reminderRepeatDetails');
                if (this.checked) {
                    repeatDetails.classList.add('active');
                } else {
                    repeatDetails.classList.remove('active');
                }
            });
            
            // 提醒重複類型
            document.getElementById('reminderRepeatType').addEventListener('change', function() {
                const daysGroup = document.getElementById('reminderRepeatDaysGroup');
                const dateGroup = document.getElementById('reminderRepeatDateGroup');
                
                if (this.value === 'weekly') {
                    daysGroup.style.display = 'block';
                    dateGroup.style.display = 'none';
                } else if (this.value === 'monthly') {
                    daysGroup.style.display = 'none';
                    dateGroup.style.display = 'block';
                } else {
                    daysGroup.style.display = 'none';
                    dateGroup.style.display = 'none';
                }
            });
            
            // 快速添加提醒項目
            document.querySelectorAll('.reminder-quick-add-item').forEach(item => {
                item.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    switch (type) {
                        case 'feeding':
                            showQuickReminderModal('feeding');
                            break;
                        case 'sleep':
                            showQuickReminderModal('sleep');
                            break;
                        case 'medicine':
                            showQuickMedicineModal();
                            break;
                        case 'vaccine':
                            showQuickVaccineModal();
                            break;
                    }
                });
            });
            
            // 配置藥物提醒選項
            document.getElementById('medicineSchedule').addEventListener('change', function() {
                const customTimeGroup = document.getElementById('medicineCustomTimeGroup');
                if (this.value === 'custom') {
                    customTimeGroup.style.display = 'block';
                } else {
                    customTimeGroup.style.display = 'none';
                }
            });
            
            // 配置疫苗提醒選項
            document.getElementById('vaccineName').addEventListener('change', function() {
                const otherNameGroup = document.getElementById('vaccineOtherNameGroup');
                if (this.value === 'other') {
                    otherNameGroup.style.display = 'block';
                } else {
                    otherNameGroup.style.display = 'none';
                }
            });
            
            document.getElementById('vaccineSetNextReminder').addEventListener('change', function() {
                const nextReminderOptions = document.getElementById('vaccineNextReminderOptions');
                if (this.checked) {
                    nextReminderOptions.style.display = 'block';
                } else {
                    nextReminderOptions.style.display = 'none';
                }
            });
            
            document.getElementById('saveVaccineReminderBtn').addEventListener('click', saveVaccineReminder);
            document.getElementById('cancelVaccineReminderBtn').addEventListener('click', closeModals);
            
            document.getElementById('saveMedicineReminderBtn').addEventListener('click', saveMedicineReminder);
            document.getElementById('cancelMedicineReminderBtn').addEventListener('click', closeModals);
            
            // 設定提醒複選框事件
            const reminderCheckboxes = [
                { checkbox: 'feedingSetReminder', options: 'feedingReminderOptions' },
                { checkbox: 'sleepSetReminder', options: 'sleepReminderOptions' },
                { checkbox: 'diaperSetReminder', options: 'diaperReminderOptions' },
                { checkbox: 'activitySetReminder', options: 'activityReminderOptions' },
                { checkbox: 'otherSetReminder', options: 'otherReminderOptions' },
                { checkbox: 'quickFeedingSetReminder', options: 'quickFeedingReminderOptions' },
                { checkbox: 'quickDiaperSetReminder', options: 'quickDiaperReminderOptions' }
            ];
            
            reminderCheckboxes.forEach(({ checkbox, options }) => {
                const checkboxEl = document.getElementById(checkbox);
                if (checkboxEl) {
                    checkboxEl.addEventListener('change', function() {
                        const optionsEl = document.getElementById(options);
                        if (optionsEl) {
                            optionsEl.style.display = this.checked ? 'block' : 'none';
                        }
                    });
                }
            });
            
            // 自訂時間間隔選擇
            const reminderIntervals = [
                { select: 'feedingReminderInterval', custom: 'feedingCustomTimeCol', customTime: 'feedingCustomTime' },
                { select: 'sleepReminderInterval', custom: 'sleepCustomTimeCol', customTime: 'sleepCustomTime' },
                { select: 'diaperReminderInterval', custom: 'diaperCustomTimeCol', customTime: 'diaperCustomTime' },
                { select: 'activityReminderInterval', custom: 'activityCustomTimeCol', customTime: 'activityCustomTime' }
            ];
            
            reminderIntervals.forEach(({ select, custom, customTime }) => {
                const selectEl = document.getElementById(select);
                if (selectEl) {
                    selectEl.addEventListener('change', function() {
                        const customCol = document.getElementById(custom);
                        if (customCol) {
                            customCol.style.display = this.value === 'custom' ? 'block' : 'none';
                            
                            // 如果選擇自訂，設定預設時間為當前時間+幾小時
                            if (this.value === 'custom') {
                                const customTimeEl = document.getElementById(customTime);
                                if (customTimeEl) {
                                    const now = new Date();
                                    now.setHours(now.getHours() + 3); // 預設加3小時
                                    const isoString = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                                        .toISOString()
                                        .slice(0, 16);
                                    customTimeEl.value = isoString;
                                }
                            }
                        }
                    });
                }
            });
        }

        // 初始化快捷動作按鈕
        function initQuickActionButtons() {
            // 快捷動作主按鈕
            const quickActionBtn = document.getElementById('quickActionBtn');
            const quickActionMenu = document.getElementById('quickActionMenu');
            const overlay = document.getElementById('overlay');
            
            // 點擊快捷動作按鈕顯示選單
            quickActionBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                quickActionMenu.classList.add('active');
                overlay.classList.add('active');
            });
            
            // 關閉快捷選單
            document.getElementById('quickActionMenuClose').addEventListener('click', function() {
                closeQuickActionMenu();
            });
            
            // 點擊快捷選項
            document.getElementById('quickActionFeeding').addEventListener('click', function() {
                showQuickFeedingModal();
            });
            
            document.getElementById('quickActionSleep').addEventListener('click', function() {
                toggleQuickSleep();
            });
            
            document.getElementById('quickActionDiaper').addEventListener('click', function() {
                showQuickDiaperModal();
            });
            
            document.getElementById('quickActionOther').addEventListener('click', function() {
                showQuickOtherModal();
            });
            
            // 設定月份日期選項
            const daySelector = document.getElementById('reminderRepeatDate');
            if (daySelector) {
                for (let i = 1; i <= 31; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i + '日';
                    daySelector.appendChild(option);
                }
            }
        }

        // 關閉快捷動作選單
        function closeQuickActionMenu() {
            document.getElementById('quickActionMenu').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        // 顯示快速餵食模態框
        function showQuickFeedingModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeQuickActionMenu();
                return;
            }
            
            // 設定預設值
            if (appData.quickOptions.lastFeeding) {
                document.getElementById('quickFeedingType').value = appData.quickOptions.lastFeeding.type;
                document.getElementById('quickFeedingAmount').value = appData.quickOptions.lastFeeding.amount;
                document.getElementById('quickFeedingUnit').value = appData.quickOptions.lastFeeding.unit;
            }
            
            document.getElementById('quickFeedingModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            closeQuickActionMenu();
        }

        // 顯示快速尿布模態框
        function showQuickDiaperModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeQuickActionMenu();
                return;
            }
            
            // 重置選項
            document.querySelectorAll('.diaper-option').forEach((option, index) => {
                if (index === 0) option.classList.add('active');
                else option.classList.remove('active');
            });
            document.getElementById('quickDiaperCondition').value = '正常';
            document.getElementById('quickDiaperNote').value = '';
            
            document.getElementById('quickDiaperModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            closeQuickActionMenu();
        }

        // 顯示快速其他模態框
        function showQuickOtherModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeQuickActionMenu();
                return;
            }
            
            document.getElementById('quickOtherModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            closeQuickActionMenu();
        }

        // 切換快速睡眠計時
        function toggleQuickSleep() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeQuickActionMenu();
                return;
            }

            // 檢查是否有進行中的睡眠
            if (appData.quickOptions.sleepStartTime) {
                // 結束睡眠
                const startTime = new Date(appData.quickOptions.sleepStartTime);
                const endTime = new Date();
                const durationMs = endTime - startTime;

                // 過短的睡眠時間視為誤操作，不記錄
                if (durationMs < 60000) { // 少於1分鐘
                    showToast('睡眠時間過短，未記錄');
                    appData.quickOptions.sleepStartTime = null;
                    saveQuickOptions();
                    document.getElementById('sleepTimerBadge').classList.remove('active');
                    closeQuickActionMenu();
                    return;
                }

                // 儲存睡眠記錄
                const sleepRecord = {
                    id: 'record_' + Date.now(),
                    type: 'sleep',
                    date: new Date().toISOString(),
                    startTime: startTime.toISOString(),
                    endTime: endTime.toISOString(),
                    quality: '3', // 預設為中等品質
                    note: '通過快速記錄功能記錄'
                };

                // 添加記錄
                if (!appData.records[appData.selectedChild]) {
                    appData.records[appData.selectedChild] = [];
                }
                
                appData.records[appData.selectedChild].push(sleepRecord);
                saveRecords(appData.selectedChild);

                // 重置睡眠計時
                appData.quickOptions.sleepStartTime = null;
                saveQuickOptions();
                document.getElementById('sleepTimerBadge').classList.remove('active');
                
                showToast('睡眠記錄已儲存');
                
                // 詢問是否設定下次睡眠提醒
                if (confirm('要設定下次睡眠提醒嗎？')) {
                    // 預設12小時後提醒
                    const reminderTime = new Date(endTime.getTime() + 12 * 60 * 60 * 1000);
                    addReminder(appData.selectedChild, {
                        type: 'sleep',
                        title: '睡眠時間提醒',
                        time: reminderTime.toISOString(),
                        message: '該安排寶寶睡覺了',
                        completed: false,
                        repeat: null
                    });
                    
                    showToast('已設定12小時後的睡眠提醒');
                }
            } else {
                // 開始睡眠
                appData.quickOptions.sleepStartTime = new Date().toISOString();
                saveQuickOptions();
                
                // 更新UI顯示
                updateSleepTimerDisplay(new Date(appData.quickOptions.sleepStartTime));
                document.getElementById('sleepTimerBadge').classList.add('active');
                
                showToast('開始睡眠計時');
            }
            
            closeQuickActionMenu();
        }

        // 更新睡眠計時器顯示
        function updateSleepTimerDisplay(startTime) {
            const timerElement = document.querySelector('.sleep-timer-text');
            
            // 停止先前的計時器（如果有）
            const oldTimerId = timerElement.getAttribute('data-timer-id');
            if (oldTimerId) {
                clearInterval(parseInt(oldTimerId));
            }
            
            // 更新初始顯示
            updateTimerText();
            
            // 設置定時更新
            function updateTimerText() {
                if (!appData.quickOptions.sleepStartTime) return;
                
                const now = new Date();
                const elapsed = now - startTime;
                
                const hours = Math.floor(elapsed / (1000 * 60 * 60));
                const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
                
                const timeText = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timerElement.textContent = `正在睡眠中: ${timeText}`;
            }
            
            // 每秒更新一次
            const timerId = setInterval(updateTimerText, 1000);
            // 存儲計時器ID
            timerElement.setAttribute('data-timer-id', timerId);
        }

        // 儲存快速餵食記錄
        function saveQuickFeeding() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }

            const type = document.getElementById('quickFeedingType').value;
            const amount = document.getElementById('quickFeedingAmount').value;
            const unit = document.getElementById('quickFeedingUnit').value;
            const note = document.getElementById('quickFeedingNote').value;
            
            if (!amount) {
                showToast('請輸入數量/時間');
                return;
            }

            // 創建記錄
            const record = {
                id: 'record_' + Date.now(),
                type: 'feeding',
                date: new Date().toISOString(),
                feedingType: type,
                amount: amount,
                unit: unit,
                time: new Date().toISOString(),
                note: note || '通過快速記錄功能記錄'
            };

            // 存儲為最後一次餵食記錄
            appData.quickOptions.lastFeeding = {
                type: type,
                amount: amount,
                unit: unit
            };
            saveQuickOptions();

            // 添加記錄
            if (!appData.records[appData.selectedChild]) {
                appData.records[appData.selectedChild] = [];
            }
            
            appData.records[appData.selectedChild].push(record);
            saveRecords(appData.selectedChild);
            
            // 檢查是否設定提醒
            const setReminder = document.getElementById('quickFeedingSetReminder').checked;
            if (setReminder) {
                const interval = document.getElementById('quickFeedingReminderInterval').value;
                const hours = parseInt(interval);
                
                // 計算提醒時間
                const now = new Date();
                const reminderTime = new Date(now.getTime() + hours * 60 * 60 * 1000);
                
                // 建立提醒
                addReminder(appData.selectedChild, {
                    type: 'feeding',
                    title: '餵食提醒',
                    time: reminderTime.toISOString(),
                    message: `該給寶寶餵食了 (${type})`,
                    completed: false,
                    repeat: null
                });
                
                showToast(`餵食記錄已儲存，並設定${hours}小時後提醒`);
            } else {
                showToast('餵食記錄已儲存');
            }
            
            closeModals();
            
            // 更新提醒計數徽章
            updateReminderBadge();
        }

        // 儲存快速尿布記錄
        function saveQuickDiaper() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }

            const activeOption = document.querySelector('.diaper-option.active');
            const diaperType = activeOption.getAttribute('data-type');
            const condition = document.getElementById('quickDiaperCondition').value;
            const note = document.getElementById('quickDiaperNote').value;

            // 創建記錄
            const record = {
                id: 'record_' + Date.now(),
                type: 'diaper',
                date: new Date().toISOString(),
                urine: diaperType === 'urine' || diaperType === 'both',
                stool: diaperType === 'stool' || diaperType === 'both',
                condition: condition,
                time: new Date().toISOString(),
                note: note || '通過快速記錄功能記錄'
            };

            // 添加記錄
            if (!appData.records[appData.selectedChild]) {
                appData.records[appData.selectedChild] = [];
            }
            
            appData.records[appData.selectedChild].push(record);
            saveRecords(appData.selectedChild);
            
            // 檢查是否設定提醒
            const setReminder = document.getElementById('quickDiaperSetReminder').checked;
            if (setReminder) {
                const interval = document.getElementById('quickDiaperReminderInterval').value;
                const hours = parseInt(interval);
                
                // 計算提醒時間
                const now = new Date();
                const reminderTime = new Date(now.getTime() + hours * 60 * 60 * 1000);
                
                // 建立提醒
                addReminder(appData.selectedChild, {
                    type: 'diaper',
                    title: '尿布更換提醒',
                    time: reminderTime.toISOString(),
                    message: `該檢查寶寶的尿布了`,
                    completed: false,
                    repeat: null
                });
                
                showToast(`尿布記錄已儲存，並設定${hours}小時後提醒`);
            } else {
                showToast('尿布記錄已儲存');
            }
            
            closeModals();
            
            // 更新提醒計數徽章
            updateReminderBadge();
        }

        // 儲存快速其他記錄
        function saveQuickOther() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }

            const typeValue = document.getElementById('quickOtherType').value;
            const note = document.getElementById('quickOtherNote').value;

            let record;
            const now = new Date().toISOString();

            // 解析類型值
            const [type, value] = typeValue.split('_');

            if (type === 'emotion') {
                record = {
                    id: 'record_' + Date.now(),
                    type: 'emotion',
                    date: now,
                    emotionType: value,
                    intensity: '3', // 預設中等強度
                    time: now,
                    note: note || '通過快速記錄功能記錄'
                };
            } else if (type === 'activity') {
                record = {
                    id: 'record_' + Date.now(),
                    type: 'activity',
                    date: now,
                    activityType: value,
                    duration: '15', // 預設15分鐘
                    time: now,
                    note: note || '通過快速記錄功能記錄'
                };
            }

            // 添加記錄
            if (!appData.records[appData.selectedChild]) {
                appData.records[appData.selectedChild] = [];
            }
            
            appData.records[appData.selectedChild].push(record);
            saveRecords(appData.selectedChild);
            
            closeModals();
            showToast(`${value}記錄已儲存`);
        }

        // 顯示新增提醒模態框
        function showAddReminderModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                return;
            }
            
            // 重置表單
            document.getElementById('reminderType').value = 'feeding';
            document.getElementById('reminderTitle').value = '';
            
            // 設定預設時間為當前時間+2小時
            const now = new Date();
            now.setHours(now.getHours() + 2);
            const isoString = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString()
                .slice(0, 16);
            document.getElementById('reminderTime').value = isoString;
            
            document.getElementById('reminderMessage').value = '';
            document.getElementById('reminderRepeat').checked = false;
            document.getElementById('reminderRepeatDetails').classList.remove('active');
            document.getElementById('reminderRepeatType').value = 'daily';
            
            // 重置重複日期選項
            document.querySelectorAll('input[name="reminderRepeatDay"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            document.getElementById('reminderRepeatDaysGroup').style.display = 'none';
            document.getElementById('reminderRepeatDateGroup').style.display = 'none';
            
            document.getElementById('addReminderModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 儲存提醒
        function saveReminder() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }
            
            const type = document.getElementById('reminderType').value;
            const title = document.getElementById('reminderTitle').value;
            const time = document.getElementById('reminderTime').value;
            const message = document.getElementById('reminderMessage').value;
            
            if (!title) {
                showToast('請輸入提醒標題');
                return;
            }
            
            if (!time) {
                showToast('請選擇提醒時間');
                return;
            }
            
            // 處理重複設定
            let repeat = null;
            const isRepeat = document.getElementById('reminderRepeat').checked;
            
            if (isRepeat) {
                const repeatType = document.getElementById('reminderRepeatType').value;
                
                if (repeatType === 'daily') {
                    repeat = { type: 'daily' };
                } else if (repeatType === 'weekly') {
                    const days = [];
                    document.querySelectorAll('input[name="reminderRepeatDay"]:checked').forEach(checkbox => {
                        days.push(parseInt(checkbox.value));
                    });
                    
                    if (days.length === 0) {
                        showToast('請選擇每週重複的日期');
                        return;
                    }
                    
                    repeat = { type: 'weekly', days: days };
                } else if (repeatType === 'monthly') {
                    const date = document.getElementById('reminderRepeatDate').value;
                    repeat = { type: 'monthly', date: parseInt(date) };
                }
            }
            
            // 建立提醒
            addReminder(appData.selectedChild, {
                type: type,
                title: title,
                time: new Date(time).toISOString(),
                message: message || title,
                completed: false,
                repeat: repeat
            });
            
            closeModals();
            showToast('提醒已設定');
            
            // 更新提醒視圖
            updateReminderView();
            
            // 更新提醒計數徽章
            updateReminderBadge();
        }

        // 添加提醒
        function addReminder(childId, reminderData) {
            if (!childId) return;
            
            // 生成唯一ID
            const reminderId = 'reminder_' + Date.now();
            reminderData.id = reminderId;
            
            // 確保子對象存在
            if (!appData.reminders[childId]) {
                appData.reminders[childId] = [];
            }
            
            // 添加提醒
            appData.reminders[childId].push(reminderData);
            
            // 儲存提醒
            saveReminders();
            
            // 更新提醒視圖
            updateReminderView();
            
            // 立即檢查提醒
            checkAndUpdateReminders();
            
            return reminderId;
        }

        // 更新提醒
        function updateReminder(childId, reminderId, updates) {
            if (!childId || !reminderId || !appData.reminders[childId]) return false;
            
            const reminderIndex = appData.reminders[childId].findIndex(r => r.id === reminderId);
            if (reminderIndex === -1) return false;
            
            // 更新提醒
            appData.reminders[childId][reminderIndex] = {
                ...appData.reminders[childId][reminderIndex],
                ...updates
            };
            
            // 儲存提醒
            saveReminders();
            
            // 更新提醒視圖
            updateReminderView();
            
            return true;
        }

        // 刪除提醒
        function deleteReminder(childId, reminderId) {
            if (!childId || !reminderId || !appData.reminders[childId]) return false;
            
            const reminderIndex = appData.reminders[childId].findIndex(r => r.id === reminderId);
            if (reminderIndex === -1) return false;
            
            // 刪除提醒
            appData.reminders[childId].splice(reminderIndex, 1);
            
            // 儲存提醒
            saveReminders();
            
            // 更新提醒視圖
            updateReminderView();
            
            // 更新提醒計數徽章
            updateReminderBadge();
            
            return true;
        }

        // 標記提醒為已完成
        function completeReminder(childId, reminderId) {
            return updateReminder(childId, reminderId, { completed: true });
        }

        // 清除已完成的提醒
        function clearCompletedReminders() {
            if (!appData.selectedChild || !appData.reminders[appData.selectedChild]) return;
            
            // 過濾出未完成的提醒
            appData.reminders[appData.selectedChild] = appData.reminders[appData.selectedChild].filter(r => !r.completed);
            
            // 儲存提醒
            saveReminders();
            
            // 更新提醒視圖
            updateReminderView();
            
            showToast('已清除所有已完成的提醒');
        }

        // 更新提醒視圖
        function updateReminderView() {
            const reminderList = document.getElementById('reminderList');
            reminderList.innerHTML = '';
            
            if (!appData.selectedChild || !appData.reminders[appData.selectedChild] || appData.reminders[appData.selectedChild].length === 0) {
                reminderList.innerHTML = '<p>目前沒有提醒項目。</p>';
                return;
            }
            
            // 獲取過濾條件
            const filter = document.getElementById('reminderFilter').value;
            
            // 過濾提醒
            let filteredReminders = appData.reminders[appData.selectedChild];
            
            if (filter === 'active') {
                filteredReminders = filteredReminders.filter(r => !r.completed);
            } else if (filter === 'completed') {
                filteredReminders = filteredReminders.filter(r => r.completed);
            }
            
            // 依時間排序提醒
            filteredReminders.sort((a, b) => {
                // 先依照完成狀態排序
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                
                // 再依時間排序（未完成的按時間升序，已完成的按時間降序）
                const aTime = new Date(a.time);
                const bTime = new Date(b.time);
                
                return a.completed ? bTime - aTime : aTime - bTime;
            });
            
            // 沒有符合條件的提醒
            if (filteredReminders.length === 0) {
                reminderList.innerHTML = `<p>沒有${filter === 'active' ? '活躍' : filter === 'completed' ? '已完成' : ''}提醒項目。</p>`;
                return;
            }
            
            // 生成提醒列表
            const ul = document.createElement('ul');
            ul.className = 'reminder-list';
            
            const now = new Date();
            
            filteredReminders.forEach(reminder => {
                const li = document.createElement('li');
                li.className = 'reminder-item';
                
                // 設定狀態樣式
                const reminderTime = new Date(reminder.time);
                if (reminder.completed) {
                    li.classList.add('completed');
                } else if (reminderTime < now) {
                    li.classList.add('expired');
                } else {
                    li.classList.add('active');
                }
                
                // 設定提醒類型圖標
                let typeIcon = '';
                switch (reminder.type) {
                    case 'feeding':
                        typeIcon = '<span class="reminder-type-icon reminder-type-feeding"><i class="fas fa-utensils"></i></span>';
                        break;
                    case 'sleep':
                        typeIcon = '<span class="reminder-type-icon reminder-type-sleep"><i class="fas fa-bed"></i></span>';
                        break;
                    case 'diaper':
                        typeIcon = '<span class="reminder-type-icon reminder-type-other"><i class="fas fa-baby"></i></span>';
                        break;
                    case 'medicine':
                        typeIcon = '<span class="reminder-type-icon reminder-type-medicine"><i class="fas fa-pills"></i></span>';
                        break;
                    case 'vaccine':
                        typeIcon = '<span class="reminder-type-icon reminder-type-vaccine"><i class="fas fa-syringe"></i></span>';
                        break;
                    default:
                        typeIcon = '<span class="reminder-type-icon reminder-type-other"><i class="fas fa-bell"></i></span>';
                }
                
                // 生成重複文字
                let repeatText = '';
                if (reminder.repeat) {
                    switch (reminder.repeat.type) {
                        case 'daily':
                            repeatText = '<span class="badge badge-primary">每天</span> ';
                            break;
                        case 'weekly':
                            const days = ['日', '一', '二', '三', '四', '五', '六'];
                            const dayList = reminder.repeat.days.map(d => '週' + days[d]).join('、');
                            repeatText = `<span class="badge badge-primary">${dayList}</span> `;
                            break;
                        case 'monthly':
                            repeatText = `<span class="badge badge-primary">每月${reminder.repeat.date}日</span> `;
                            break;
                    }
                }
                
                // 生成提醒內容
                li.innerHTML = `
                    <div class="reminder-info">
                        <div class="reminder-title">${typeIcon}${reminder.title} ${repeatText}</div>
                        <div class="reminder-time">${formatDateTime(reminder.time)}</div>
                        ${reminder.message ? `<div class="reminder-message">${reminder.message}</div>` : ''}
                    </div>
                    <div class="reminder-actions">
                        ${!reminder.completed ? `<button class="btn btn-success btn-complete-reminder" data-id="${reminder.id}"><i class="fas fa-check"></i></button>` : ''}
                        <button class="btn btn-danger btn-delete-reminder" data-id="${reminder.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                ul.appendChild(li);
            });
            
            reminderList.appendChild(ul);
            
            // 添加按鈕事件
            document.querySelectorAll('.btn-complete-reminder').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reminderId = this.getAttribute('data-id');
                    completeReminder(appData.selectedChild, reminderId);
                    showToast('提醒已標記為完成');
                });
            });
            
            document.querySelectorAll('.btn-delete-reminder').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reminderId = this.getAttribute('data-id');
                    if (confirm('確定要刪除此提醒嗎？')) {
                        deleteReminder(appData.selectedChild, reminderId);
                        showToast('提醒已刪除');
                    }
                });
            });
        }

        // 更新提醒計數徽章
        function updateReminderBadge() {
            const badges = document.querySelectorAll('.reminder-count-badge');
            
            // 計算活躍提醒數量
            let activeCount = 0;
            if (appData.selectedChild && appData.reminders[appData.selectedChild]) {
                const now = new Date();
                activeCount = appData.reminders[appData.selectedChild].filter(r => 
                    !r.completed && new Date(r.time) <= now
                ).length;
            }
            
            // 更新徽章顯示
            badges.forEach(badge => {
                // 移除現有徽章
                const existingBadge = badge.querySelector('.reminder-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                
                // 如果有活躍提醒，添加徽章
                if (activeCount > 0) {
                    const badgeElement = document.createElement('span');
                    badgeElement.className = 'reminder-badge';
                    badgeElement.textContent = activeCount > 9 ? '9+' : activeCount;
                    badge.appendChild(badgeElement);
                }
            });
        }

        // 檢查和更新提醒
        function checkAndUpdateReminders() {
            const now = new Date();
            let hasActiveReminders = false;
            
            // 遍歷所有兒童的提醒
            for (const childId in appData.reminders) {
                appData.reminders[childId].forEach(reminder => {
                    if (reminder.completed) return;
                    
                    const reminderTime = new Date(reminder.time);
                    
                    // 檢查提醒時間是否已到
                    if (reminderTime <= now) {
                        hasActiveReminders = true;
                        
                        // 發送通知 (如果尚未通知過)
                        if (!reminder.notified) {
                            sendNotification(reminder);
                            
                            // 標記已通知
                            reminder.notified = true;
                            
                            // 如果是重複提醒，生成下一次提醒
                            if (reminder.repeat) {
                                generateNextReminder(childId, reminder);
                            }
                        }
                    }
                });
            }
            
            // 儲存更新後的提醒
            saveReminders();
            
            // 更新提醒計數徽章
            updateReminderBadge();
            
            // 定時檢查提醒 (每分鐘)
            setTimeout(checkAndUpdateReminders, 60000);
            
            return hasActiveReminders;
        }

        // 發送通知
        function sendNotification(reminder) {
            // 檢查瀏覽器通知支援和權限
            if ("Notification" in window) {
                if (Notification.permission === "granted") {
                    // 發送瀏覽器通知
                    const notification = new Notification("寶寶照顧提醒", {
                        body: reminder.message || reminder.title,
                        icon: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDM3IDI2OC4yYzI3LjMtMTIuOSA0NC41LTQwLjYgNDQuNS03MSAwLTQ0LjEtMzUuOC04MC04MC04MHMtODAgMzUuOS04MCA4MGMwIDMwLjQgMTcuMiA1OC4xIDQ0LjUgNzEgLTE1LjkgNy44LTI5LjggMTkuMy00MC4yIDMzLjQgLTEzLjQtMTYuMy0yOS4yLTI5LjktNDcuNC00MGw0LjUtMTYuOWMzLjctMTMuNy03LjQtMjYuNi0yMS41LTI0LjlMMjQ0LjEgMTY1LjlsMTAuNS0yOC40YzEwLjctMjguOCAxLjgtNjEuNS0yMi4zLTgxLjQgLTI4LjMtMjMuNCAtNzAuMy0xOC4yIC05My4xIDExLjMgLTkuMSAxMS44IC0xNC4zIDI2LjEgLTE0LjkgNDAuOWwtMS40IDM2LjBjLTEuNCAzNS4yIDE2LjI5IDY4LjQgNDYuMSA4Ni4xbC0xNy4xIDY0Yy0zLjQgMTIuOSA3LjQgMjQuOCAxOS44IDIxLjZsMjMuMi02LjJjLTUuOSAyNS45IC00LjIgNTMuMiA1LjcgNzguMyA2LjggMTcuNiAzMC41IDI0IDQ2LjIgMTIuMSAxNS4xIC0xMS40IDE5IC0zMi44IDguOCAtNDguNiAtMTEuMSAtMTcuMSAtMTUuNiAtMzYuNyAtMTMuMSAtNTYuMmwxNy4xIC00NS42YzEzLjE4IDUuMyAyNS4zOCAxMi4xIDM2LjM4IDIwLjVDMjg0LjggMzQyLjEgMzE0LjMgMzc2IDMxOCAzODQuMWMzLjggOC4xIDEyLjIgMTMuMyAyMS4zIDEzLjMgMy44IDAgNy43IC0wLjkgMTEuMiAtMi44IDE2LjEgLTguNiAyNSAtMzEuMyA4LjIgLTQ4LjVDMzQxLjkgMzI0IDMxNy45IDI5MS40IDI4Ny45IDI3MCA5OS43IDI5NS4xIDgyLjMgMzMyLjggODUuOSAzNDMuOWM2LjggMjEuMiAzOSAxNi42IDQ2LjggLTAuNSA2LjIgLTEzLjIgMjcuNiAtNDkuNiA3NC40IC03NS4xIDYuMiAzNS4yIDMyLjYgNjIuNyA2Ni4xIDY5LjcgLTQuMiA5LjMgLTYuOSAxOS43IC03LjcgMzAuNiAtNC44IDYyLjIgNTYuMSAxMDggMTA5LjEgNzAuMyA1NS43IC0zOS42IDcwLjMgLTEyNS42IDM0LjMgLTE4NC45IC0xNS44IC0yNi4xIC0zOC40IC00Ny4zIC02NS4zIC02MS41QzM1Mi43IDIwNS40IDM2OCAxNzUuNCAzNjggMTQxLjFjMC03MC42IC01Ny40IC0xMjggLTEyOCAtMTI4cy0xMjggNTcuNCAtMTI4IDEyOGMwIDI1LjkgNy43IDUwLjEgMjAuOSA3MC4yIDAuNyA2LjUgMi44IDEyLjkgNi4yIDE4LjdDMTEzIDIzOC44IDkwLjIgMjUwIDc3LjkgMjczLjRDNTMuNyAzMTYuNiA4Mi45IDM2OC4zIDEyOS4xIDM2Mi4zYzE3IC0yLjIgMjQuMiAtMjMuMiAxMy4yIC0zNi4xQzEzMS4xIDMxMy4zIDEyNCAyOTkuNyAxMjQgMjg1LjFjMC0wLjUgMC0xLjEgMCAtMS42QzE3My4zIDI2Ni4yIDE5NS45IDMxNy44IDE5Mi4zIDM2Mi4zYy0xIDEyLjcgLTYuOSAyNC4xIC0xNS44IDMyLjUgLTI5LjIgMjcuOCAtMTAuMSA3OS4xIDMwLjUgNzQuNCAxOS4xIC0yLjIgMzYuNSAtMTMuNSA0OC40IC0zMC40IDcuOSAtMTEuMiAtMS4zIC0yNi45IC0xNC43IC0yNS4yIC0zNS4xIDQuMiAtNTIuOCAtMTguNyAtNDAgLTUyLjIgMTEuOCAtMyAyMi43IC0xMC40IDMwLjEgLTIxLjQgMjYuMiA3LjggNTQuMiAtNi45IDYzLjYgLTMzLjIgMTEuMiAyLjcgMjIuOSA0LjQgMzQuOSA0LjRzMjMuOCAtMS44IDM1IC00LjYgYzE0LjIgNDEuNyAtMTguMiA4MS4yIC01OCA4MSAtMTEuMSAwIC0yMS42IC0yLjUgLTMxIC02LjggLTYgLTIuOCAtMTMuNCAxLjkgLTEyLjUgOC42IDQuOSAzNi44IC0yMy4zIDcwLjYgLTYyLjEgNjcuOSAtOS4yIC0wLjYgLTE4LjQgLTMuMSAtMjYuOS02LjggLTcuNyAtMy40IC0xNS44IDMuNSAtMTMuMiAxMS42IDEzLjcgNDIuMSAtMjIuOSA4NS40IC02Ni40IDcyLjFDNTMuNyA1MDcuMiA0MyA0ODUuNCA1MS42IDQ2Ni45YzMuMS02LjYgLTMuNC0xNC4yIC0xMC4zIC0xMS45IC0yLjUgMC44IC00LjkgMS43IC03LjMgMi42IC00LjQgLTcuOCAtOCAtMTYuMiAtMTAuNiAtMjUuMUMxNS4xIDQwNC41IDAgMzcyLjEgMCAzMzcuNWMwLTUuNSAwLjIgLTExIDEuMSAtMTYuNCAzLjUgLTIzLjUgMTIuNyAtNDUuNSAyNi44IC02My44QzQxLjIgMjM3IDYwLjggMjE5LjIgODQgMjA3LjNDOTIuMiAxOTEuMyAxMDUuMiAxNzguMiAxMjEuMiAxNjkuOWMtNi44IC0xMi40IC0xMC4zIC0yNi43IC05LjggLTQxLjZsMi40IC02Mi4zYzEuMiAtMzAuMyAxNS44IC02MC43IDQwLjQgLTgxLjQgNTEgLTQzLjcgMTI3LjMgLTM3LjcgMTY5LjggMTMuNiA0MS4xIDQ5LjggNDAgMTE3LjcgNS41IDE2Ni40IC0yLjcgMy45IC03LjMgNi42IC0xMC41IDEwLjRDMzU5LjUgMTg3LjEgNDAxIDIxOCA0MDEgMjY3LjVjMCA1Ny41IC01NS40IDEwMi42IC0xMTEuOSA4NS44IC0xMi40IC0zLjYgLTQxLjcgLTIyIC00OC40IC0zOC44IC00LjYgLTExLjYgLTIwLjkgLTExLjMgLTI1LjMgMC40IC01LjUgMTQuNyAtMTMuMiAyNy41IC0yMi4yIDM4LjkgLTYuOCA4LjQgLTEuNyAyMS41IDEwLjQgMjEuOSA3NC42IDIuNyAxNjggLTUwLjQgMTY4IC0xMzMuNiAwIC0zLjYgLTAuMiAtNy4yIC0wLjUgLTEwLjdDMzk1LjYgMjYxLjggNDE5IDIzNi4xIDQzNyAyMDQuMVYyNjguMnpNMjAxLjIgMzA5LjdsLTI1LjggNjguOGMtMy4yIDExLjYg-OS41IDIyIDQuNSAyMi45IDguMiAwLjUgMTQuMS03LjggMTYuOSAtMTQuOUMyMTA2IDE3MC43IDE5NS44IDE1Ny40IDE4OC41IDE0Ny4yQzE4My4zIDE0MCAxODEuNyAxMzAuNyAxODMuNCAxMjEuN0wxODcuOSA5Mi45Yy0wLjEgLTAuMSAtMS40IC0xLjQgLTMgLTIuOCAyLjkgNCw1LjEgOC42IDYuMyAxMy42bC0xNi4xIDQzLjIgLTQxLjEgMTQuNGMtOS42IDMuNC0xNS41IDEzLjQgLTEzLjUgMjMuNCAyIDEwIDAuNSAyMC4zIC00LjQgMjkuMkMxMzcuMyAyMzIuOCAxNzcuNyAyNjguOCAyMDEuMiAzMDkuN3onIGZpbGw9JyNmYzljMDAnLz48L3N2Zz4="
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        notification.close();
                        
                        // 如果點擊後想完成提醒
                        // completeReminder(reminder.childId, reminder.id);
                    };
                } else {
                    // 使用內部提示框
                    showToast(reminder.message || reminder.title);
                }
            } else {
                // 瀏覽器不支援通知，使用內部提示框
                showToast(reminder.message || reminder.title);
            }
        }

        // 生成下一次重複提醒
        function generateNextReminder(childId, reminder) {
            if (!reminder.repeat) return;
            
            const currentTime = new Date(reminder.time);
            let nextTime;
            
            switch (reminder.repeat.type) {
                case 'daily':
                    // 設定明天同一時間
                    nextTime = new Date(currentTime);
                    nextTime.setDate(nextTime.getDate() + 1);
                    break;
                    
                case 'weekly':
                    // 尋找下一個符合的星期
                    const dayOfWeek = currentTime.getDay();
                    const days = reminder.repeat.days.sort((a, b) => a - b);
                    
                    // 找出下一個大於當前星期的日期
                    let nextDay = days.find(d => d > dayOfWeek);
                    
                    // 如果沒有找到，表示需要到下週
                    if (nextDay === undefined) {
                        nextDay = days[0]; // 取第一個
                        nextTime = new Date(currentTime);
                        nextTime.setDate(nextTime.getDate() + (7 - dayOfWeek + nextDay));
                    } else {
                        nextTime = new Date(currentTime);
                        nextTime.setDate(nextTime.getDate() + (nextDay - dayOfWeek));
                    }
                    break;
                    
                case 'monthly':
                    // 設定下月同一日
                    nextTime = new Date(currentTime);
                    nextTime.setMonth(nextTime.getMonth() + 1);
                    
                    // 確保日期有效（例如，1月31日的下個月可能沒有31日）
                    const targetDate = reminder.repeat.date;
                    const lastDayOfMonth = new Date(nextTime.getFullYear(), nextTime.getMonth() + 1, 0).getDate();
                    
                    if (targetDate > lastDayOfMonth) {
                        nextTime.setDate(lastDayOfMonth);
                    } else {
                        nextTime.setDate(targetDate);
                    }
                    break;
            }
            
            // 創建新的提醒
            if (nextTime) {
                const newReminder = {
                    ...reminder,
                    id: 'reminder_' + Date.now(),  // 新ID
                    time: nextTime.toISOString(),
                    completed: false,
                    notified: false
                };
                
                // 添加到提醒列表
                if (!appData.reminders[childId]) {
                    appData.reminders[childId] = [];
                }
                
                appData.reminders[childId].push(newReminder);
            }
        }

        // 顯示快速提醒模態框
        function showQuickReminderModal(type) {
            // 設定預設時間
            const now = new Date();
            let hours = 3; // 預設3小時後提醒
            
            if (type === 'sleep') {
                hours = 12; // 睡眠提醒預設12小時後
            }
            
            now.setHours(now.getHours() + hours);
            const isoString = now.toISOString().slice(0, 16);
            
            // 設定默認標題和訊息
            let title = '';
            let message = '';
            
            if (type === 'feeding') {
                title = '餵食提醒';
                message = '該給寶寶餵食了';
            } else if (type === 'sleep') {
                title = '睡眠提醒';
                message = '該安排寶寶睡覺了';
            }
            
            // 設定模態框表單值
            document.getElementById('reminderType').value = type;
            document.getElementById('reminderTitle').value = title;
            document.getElementById('reminderTime').value = isoString;
            document.getElementById('reminderMessage').value = message;
            
            // 重置重複選項
            document.getElementById('reminderRepeat').checked = false;
            document.getElementById('reminderRepeatDetails').classList.remove('active');
            
            // 顯示模態框
            document.getElementById('addReminderModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 顯示快速藥物提醒模態框
        function showQuickMedicineModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                return;
            }
            
            // 重置表單
            document.getElementById('medicineName').value = '';
            document.getElementById('medicineDosage').value = '';
            document.getElementById('medicineSchedule').value = '1';
            document.getElementById('medicineCustomTimeGroup').style.display = 'none';
            
            // 設定預設首次服用時間（當前時間）
            const now = new Date();
            const isoString = now.toISOString().slice(0, 16);
            document.getElementById('medicineFirstTime').value = isoString;
            
            document.getElementById('medicineDuration').value = '3';
            document.getElementById('medicineNote').value = '';
            
            // 顯示模態框
            document.getElementById('quickMedicineModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 顯示快速疫苗提醒模態框
        function showQuickVaccineModal() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                return;
            }
            
            // 重置表單
            document.getElementById('vaccineName').value = 'BCG';
            document.getElementById('vaccineOtherNameGroup').style.display = 'none';
            
            // 設定預設接種日期（當前日期）
            const now = new Date();
            const dateString = now.toISOString().split('T')[0];
            document.getElementById('vaccineDate').value = dateString;
            
            document.getElementById('vaccineLocation').value = '';
            document.getElementById('vaccineNote').value = '';
            document.getElementById('vaccineSetNextReminder').checked = false;
            document.getElementById('vaccineNextReminderOptions').style.display = 'none';
            
            // 設定預設下次提醒時間（一個月後）
            const nextMonth = new Date(now);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            document.getElementById('vaccineNextDate').value = nextMonth.toISOString().split('T')[0];
            
            // 顯示模態框
            document.getElementById('quickVaccineModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 儲存藥物提醒
        function saveMedicineReminder() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }
            
            const name = document.getElementById('medicineName').value;
            const dosage = document.getElementById('medicineDosage').value;
            const schedule = document.getElementById('medicineSchedule').value;
            const duration = document.getElementById('medicineDuration').value;
            const note = document.getElementById('medicineNote').value;
            
            if (!name) {
                showToast('請輸入藥物名稱');
                return;
            }
            
            if (!dosage) {
                showToast('請輸入劑量');
                return;
            }
            
            // 獲取首次服用時間
            let firstTime;
            if (schedule === 'custom') {
                firstTime = new Date(document.getElementById('medicineFirstTime').value);
            } else {
                firstTime = new Date();
            }
            
            // 生成提醒
            const totalDays = parseInt(duration) || 0;
            const timesPerDay = parseInt(schedule) || 1;
            
            // 計算每天的服藥時間間隔（小時）
            const hourInterval = 24 / timesPerDay;
            
            // 生成所有提醒
            let reminderCount = 0;
            
            for (let day = 0; day < (totalDays || 1); day++) {
                for (let time = 0; time < timesPerDay; time++) {
                    // 計算服藥時間
                    const reminderTime = new Date(firstTime);
                    reminderTime.setDate(reminderTime.getDate() + day);
                    reminderTime.setHours(reminderTime.getHours() + time * hourInterval);
                    
                    // 如果時間已過，跳過此提醒
                    if (reminderTime < new Date()) continue;
                    
                    // 創建提醒
                    const ordinal = getOrdinalSuffix(time + 1);
                    const doseText = timesPerDay > 1 ? `第${ordinal}次` : '';
                    const title = totalDays > 0 ? `用藥提醒 - ${name} (${day + 1}/${totalDays}天)` : `用藥提醒 - ${name}`;
                    const message = `該服用${name} ${doseText} - ${dosage}`;
                    
                    addReminder(appData.selectedChild, {
                        type: 'medicine',
                        title: title,
                        time: reminderTime.toISOString(),
                        message: message,
                        completed: false,
                        repeat: null,
                        metadata: {
                            medicineName: name,
                            dosage: dosage,
                            note: note
                        }
                    });
                    
                    reminderCount++;
                }
            }
            
            closeModals();
            
            if (reminderCount > 0) {
                showToast(`已設定${reminderCount}個用藥提醒`);
            } else {
                showToast('未設定提醒（時間已過）');
            }
            
            // 更新提醒視圖
            updateReminderView();
            
            // 更新提醒計數徽章
            updateReminderBadge();
        }

        // 儲存疫苗提醒
        function saveVaccineReminder() {
            if (!appData.selectedChild) {
                showToast('請先選擇一位兒童');
                closeModals();
                return;
            }
            
            let name = document.getElementById('vaccineName').value;
            
            // 如果選擇「其他」選項，獲取自訂名稱
            if (name === 'other') {
                const otherName = document.getElementById('vaccineOtherName').value;
                if (!otherName) {
                    showToast('請輸入疫苗名稱');
                    return;
                }
                name = otherName;
            }
            
            const date = document.getElementById('vaccineDate').value;
            const location = document.getElementById('vaccineLocation').value;
            const note = document.getElementById('vaccineNote').value;
            
            if (!date) {
                showToast('請選擇接種日期');
                return;
            }
            
            // 創建疫苗記錄
            const vaccineRecord = {
                id: 'record_' + Date.now(),
                type: 'other',
                date: new Date().toISOString(),
                title: `疫苗接種 - ${name}`,
                time: new Date(date + 'T00:00:00').toISOString(), // 設定為當日0點
                content: `接種疫苗: ${name}\n接種地點: ${location || '未指定'}\n備註: ${note || '無'}`
            };
            
            // 添加記錄
            if (!appData.records[appData.selectedChild]) {
                appData.records[appData.selectedChild] = [];
            }
            
            appData.records[appData.selectedChild].push(vaccineRecord);
            saveRecords(appData.selectedChild);
            
            // 檢查是否設定下次提醒
            const setNextReminder = document.getElementById('vaccineSetNextReminder').checked;
            if (setNextReminder) {
                const nextDate = document.getElementById('vaccineNextDate').value;
                
                if (!nextDate) {
                    showToast('請選擇下次接種日期');
                    return;
                }
                
                // 創建下次接種提醒
                const reminderTime = new Date(nextDate + 'T09:00:00'); // 設定為早上9點
                
                addReminder(appData.selectedChild, {
                    type: 'vaccine',
                    title: `疫苗接種提醒 - ${name}`,
                    time: reminderTime.toISOString(),
                    message: `今天需要為寶寶接種 ${name} 疫苗`,
                    completed: false,
                    repeat: null,
                    metadata: {
                        vaccineName: name,
                        location: location,
                        note: note
                    }
                });
                
                showToast('疫苗記錄已儲存，並設定下次接種提醒');
            } else {
                showToast('疫苗記錄已儲存');
            }
            
            closeModals();
            
            // 更新提醒視圖
            updateReminderView();
            
            // 更新提醒計數徽章
            updateReminderBadge();
        }

        // 獲取序數後綴
        function getOrdinalSuffix(num) {
            return num.toString();
        }

        // 關閉所有模態框和遮罩
        function closeModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            document.getElementById('overlay').classList.remove('active');
        }

        // 顯示提示訊息
        function showToast(message) {
            const toast = document.getElementById('toastNotification');
            document.getElementById('toastMessage').textContent = message;
            
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 2000);
        }

        // 設定當前日期時間
        function setCurrentDateTime() {
            const now = new Date();
            const isoString = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString()
                .slice(0, 16);
            
            // 設定所有日期時間輸入欄位
            document.getElementById('feedingTime').value = isoString;
            document.getElementById('sleepStart').value = isoString;
            document.getElementById('sleepEnd').value = isoString;
            document.getElementById('diaperTime').value = isoString;
            document.getElementById('emotionTime').value = isoString;
            document.getElementById('activityTime').value = isoString;
            document.getElementById('otherTime').value = isoString;
            
            // 設定歷史記錄日期為今天
            document.getElementById('historyDate').value = isoString.split('T')[0];
            
            // 設定統計和匯出的日期範圍
            const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const oneWeekAgoString = oneWeekAgo.toISOString().split('T')[0];
            const todayString = now.toISOString().split('T')[0];
            
            document.getElementById('statsStartDate').value = oneWeekAgoString;
            document.getElementById('statsEndDate').value = todayString;
            document.getElementById('exportStartDate').value = oneWeekAgoString;
            document.getElementById('exportEndDate').value = todayString;
        }

        // 更新兒童選擇器
        function updateChildSelector() {
            const select = document.getElementById('childSelect');
            select.innerHTML = '<option value="">選擇兒童</option>';
            
            appData.children.forEach(child => {
                const option = document.createElement('option');
                option.value = child.id;
                option.textContent = child.name;
                select.appendChild(option);
            });
            
            if (appData.selectedChild) {
                select.value = appData.selectedChild;
            }
        }

        // 檢查是否已選擇兒童
        function checkSelectedChild() {
            const hasSelectedChild = appData.selectedChild !== null;
            updateChildInfo();
            
            if (hasSelectedChild) {
                updateHistoryView();
                updateMilestoneView();
                updateStatsView('week');
                updateCareTipsView();
                updateReminderView();
                updateReminderBadge();
            }
            
            document.getElementById('deleteChildBtn').style.display = hasSelectedChild ? 'inline-block' : 'none';
        }

        // 更新兒童信息顯示
        function updateChildInfo() {
            const infoElements = [
                document.getElementById('currentChildInfo'),
                document.getElementById('historyChildInfo'),
                document.getElementById('milestoneChildInfo'),
                document.getElementById('statsChildInfo'),
                document.getElementById('exportChildInfo'),
                document.getElementById('caretipsChildInfo'),
                document.getElementById('reminderChildInfo')
            ];
            
            if (appData.selectedChild) {
                const child = appData.children.find(c => c.id === appData.selectedChild);
                if (child) {
                    const birthday = new Date(child.birthday);
                    const now = new Date();
                    const ageInMonths = Math.floor((now - birthday) / (30.44 * 24 * 60 * 60 * 1000));
                    
                    infoElements.forEach(element => {
                        if (element) {
                            element.innerHTML = `
                                <div style="background-color: #f0f8ff; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                                    <strong>${child.name}</strong> | ${child.gender} | 
                                    ${ageInMonths} 個月 (${formatDate(child.birthday)})
                                    ${child.note ? `<div style="margin-top: 5px; font-size: 0.9rem; color: #666;">${child.note}</div>` : ''}
                                </div>
                            `;
                        }
                    });
                }
            } else {
                infoElements.forEach(element => {
                    if (element) {
                        element.textContent = '請先選擇或新增一位兒童';
                    }
                });
            }
        }

        // 切換標籤頁
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab, .bottom-nav-item').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.id === tabName + 'Tab') {
                    content.classList.add('active');
                    
                    // 更新對應標籤頁的資料
                    if (tabName === 'history') {
                        updateHistoryView();
                    } else if (tabName === 'milestone') {
                        updateMilestoneView();
                    } else if (tabName === 'stats') {
                        updateStatsView('week');
                    } else if (tabName === 'caretips') {
                        updateCareTipsView();
                    } else if (tabName === 'reminder') {
                        updateReminderView();
                    }
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // 顯示新增兒童模態框
        function showAddChildModal() {
            const modal = document.getElementById('addChildModal');
            modal.classList.add('active');
            document.getElementById('overlay').classList.add('active');
            
            // 重置表單
            document.getElementById('childName').value = '';
            document.getElementById('childBirthday').value = '';
            document.getElementById('childGender').value = '男';
            document.getElementById('childNote').value = '';
        }

        // 儲存兒童資料
        function saveChild() {
            const name = document.getElementById('childName').value.trim();
            const birthday = document.getElementById('childBirthday').value;
            const gender = document.getElementById('childGender').value;
            const note = document.getElementById('childNote').value.trim();
            
            if (!name || !birthday) {
                alert('請填寫姓名和出生日期');
                return;
            }
            
            const childId = 'child_' + Date.now();
            const newChild = {
                id: childId,
                name,
                birthday,
                gender,
                note
            };
            
            appData.children.push(newChild);
            saveChildren();
            
            // 初始化新兒童的記錄和里程碑資料
            appData.records[childId] = [];
            saveRecords(childId);
            initMilestones(childId);
            
            // 初始化提醒
            appData.reminders[childId] = [];
            saveReminders();
            
            // 更新選擇器並選擇新兒童
            updateChildSelector();
            selectChild(childId);
            
            // 關閉模態框
            closeModals();
        }

        // 選擇兒童
        function selectChild(childId) {
            appData.selectedChild = childId;
            localStorage.setItem('selectedChild', childId);
            
            if (childId) {
                loadChildData(childId);
            }
            
            updateChildInfo();
            updateHistoryView();
            updateMilestoneView();
            updateStatsView('week');
            updateCareTipsView();
            updateReminderView();
            updateReminderBadge();
            
            document.getElementById('deleteChildBtn').style.display = childId ? 'inline-block' : 'none';
        }

        // 切換記錄表單
        function switchRecordForm(recordType) {
            document.querySelectorAll('.record-type-btn').forEach(btn => {
                if (btn.getAttribute('data-record-type') === recordType) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.record-form').forEach(form => {
                form.style.display = 'none';
            });
            
            document.getElementById(recordType + 'Form').style.display = 'block';
        }

        // 儲存記錄
        function saveRecord(recordType) {
            if (!appData.selectedChild) {
                alert('請先選擇一位兒童');
                return;
            }
            
            const recordId = 'record_' + Date.now();
            let record = {
                id: recordId,
                type: recordType,
                date: new Date().toISOString()
            };
            
            // 根據記錄類型收集資料
            switch (recordType) {
                case 'feeding':
                    record.feedingType = document.getElementById('feedingType').value;
                    record.amount = document.getElementById('feedingAmount').value;
                    record.unit = document.getElementById('feedingUnit').value;
                    record.time = document.getElementById('feedingTime').value;
                    record.note = document.getElementById('feedingNote').value;

                    // 更新快速選項中的最近一次餵食記錄
                    appData.quickOptions.lastFeeding = {
                        type: record.feedingType,
                        amount: record.amount,
                        unit: record.unit
                    };
                    saveQuickOptions();
                    break;
                    
                case 'sleep':
                    record.startTime = document.getElementById('sleepStart').value;
                    record.endTime = document.getElementById('sleepEnd').value;
                    record.quality = document.getElementById('sleepQuality').value;
                    record.note = document.getElementById('sleepNote').value;
                    break;
                    
                case 'diaper':
                    record.urine = document.getElementById('diaperUrine').checked;
                    record.stool = document.getElementById('diaperStool').checked;
                    record.condition = document.getElementById('diaperCondition').value;
                    record.time = document.getElementById('diaperTime').value;
                    record.note = document.getElementById('diaperNote').value;
                    break;
                    
                case 'emotion':
                    record.emotionType = document.getElementById('emotionType').value;
                    record.intensity = document.getElementById('emotionIntensity').value;
                    record.time = document.getElementById('emotionTime').value;
                    record.note = document.getElementById('emotionNote').value;
                    break;
                    
                case 'activity':
                    record.activityType = document.getElementById('activityType').value;
                    record.duration = document.getElementById('activityDuration').value;
                    record.time = document.getElementById('activityTime').value;
                    record.note = document.getElementById('activityNote').value;
                    break;
                    
                case 'other':
                    record.title = document.getElementById('otherTitle').value;
                    record.content = document.getElementById('otherContent').value;
                    record.time = document.getElementById('otherTime').value;
                    break;
            }
            
            // 添加記錄
            if (!appData.records[appData.selectedChild]) {
                appData.records[appData.selectedChild] = [];
            }
            
            appData.records[appData.selectedChild].push(record);
            saveRecords(appData.selectedChild);
            
            // 檢查是否需要設定提醒
            const setReminderCheckbox = document.getElementById(`${recordType}SetReminder`);
            
            if (setReminderCheckbox && setReminderCheckbox.checked) {
                let reminderTime = new Date();
                let reminderTitle = '';
                let reminderMessage = '';
                
                switch (recordType) {
                    case 'feeding':
                        const feedingInterval = document.getElementById('feedingReminderInterval').value;
                        
                        if (feedingInterval === 'custom') {
                            reminderTime = new Date(document.getElementById('feedingCustomTime').value);
                        } else {
                            const hours = parseInt(feedingInterval);
                            reminderTime = new Date(new Date(record.time).getTime() + hours * 60 * 60 * 1000);
                        }
                        
                        reminderTitle = '餵食提醒';
                        reminderMessage = `該給寶寶餵食了`;
                        break;
                        
                    case 'sleep':
                        const sleepReminderType = document.getElementById('sleepReminderType').value;
                        const sleepInterval = document.getElementById('sleepReminderInterval').value;
                        
                        if (sleepInterval === 'custom') {
                            reminderTime = new Date(document.getElementById('sleepCustomTime').value);
                        } else {
                            const hours = parseInt(sleepInterval);
                            const baseTime = sleepReminderType === 'wakeup' ? 
                                new Date(record.startTime) :  // 從睡眠開始計算醒來時間
                                new Date(record.endTime);     // 從睡眠結束計算下次睡眠時間
                                
                            reminderTime = new Date(baseTime.getTime() + hours * 60 * 60 * 1000);
                        }
                        
                        reminderTitle = sleepReminderType === 'wakeup' ? '喚醒提醒' : '睡眠提醒';
                        reminderMessage = sleepReminderType === 'wakeup' ? '該叫醒寶寶了' : '該安排寶寶睡覺了';
                        break;
                        
                    case 'diaper':
                        const diaperInterval = document.getElementById('diaperReminderInterval').value;
                        
                        if (diaperInterval === 'custom') {
                            reminderTime = new Date(document.getElementById('diaperCustomTime').value);
                        } else {
                            const hours = parseInt(diaperInterval);
                            reminderTime = new Date(new Date(record.time).getTime() + hours * 60 * 60 * 1000);
                        }
                        
                        reminderTitle = '尿布更換提醒';
                        reminderMessage = `該檢查寶寶的尿布了`;
                        break;
                        
                    case 'activity':
                        const activityInterval = document.getElementById('activityReminderInterval').value;
                        
                        if (activityInterval === 'custom') {
                            reminderTime = new Date(document.getElementById('activityCustomTime').value);
                        } else {
                            const hours = parseInt(activityInterval);
                            reminderTime = new Date(new Date(record.time).getTime() + hours * 60 * 60 * 1000);
                        }
                        
                        reminderTitle = `${record.activityType}提醒`;
                        reminderMessage = `該安排寶寶${record.activityType}了`;
                        break;
                        
                    case 'other':
                        reminderTime = new Date(document.getElementById('otherReminderTime').value);
                        reminderTitle = record.title;
                        reminderMessage = document.getElementById('otherReminderMessage').value || record.title;
                        break;
                }
                
                // 如果時間已過，不創建提醒
                if (reminderTime > new Date()) {
                    // 創建提醒
                    addReminder(appData.selectedChild, {
                        type: recordType,
                        title: reminderTitle,
                        time: reminderTime.toISOString(),
                        message: reminderMessage,
                        completed: false,
                        repeat: null
                    });
                    
                    showToast(`記錄已儲存，並設定提醒`);
                } else {
                    showToast('記錄已儲存（未設定提醒：時間已過）');
                }
            } else {
                // 顯示成功訊息
                showToast('記錄已成功儲存！');
            }
            
            // 清空表單
            resetRecordForm(recordType);
        }

        // 重置記錄表單
        function resetRecordForm(recordType) {
            // 設定當前時間
            const now = new Date();
            const isoString = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
                .toISOString()
                .slice(0, 16);
            
            switch (recordType) {
                case 'feeding':
                    document.getElementById('feedingAmount').value = '';
                    document.getElementById('feedingTime').value = isoString;
                    document.getElementById('feedingNote').value = '';
                    document.getElementById('feedingSetReminder').checked = false;
                    document.getElementById('feedingReminderOptions').style.display = 'none';
                    break;
                    
                case 'sleep':
                    document.getElementById('sleepStart').value = isoString;
                    document.getElementById('sleepEnd').value = isoString;
                    document.getElementById('sleepQuality').value = '3';
                    resetRating('sleepQualityRating', 3);
                    document.getElementById('sleepNote').value = '';
                    document.getElementById('sleepSetReminder').checked = false;
                    document.getElementById('sleepReminderOptions').style.display = 'none';
                    break;
                    
                case 'diaper':
                    document.getElementById('diaperUrine').checked = true;
                    document.getElementById('diaperStool').checked = false;
                    document.getElementById('diaperCondition').value = '正常';
                    document.getElementById('diaperTime').value = isoString;
                    document.getElementById('diaperNote').value = '';
                    document.getElementById('diaperSetReminder').checked = false;
                    document.getElementById('diaperReminderOptions').style.display = 'none';
                    break;
                    
                case 'emotion':
                    document.getElementById('emotionType').value = '開心';
                    document.getElementById('emotionIntensity').value = '3';
                    resetRating('emotionIntensityRating', 3);
                    document.getElementById('emotionTime').value = isoString;
                    document.getElementById('emotionNote').value = '';
                    break;
                    
                case 'activity':
                    document.getElementById('activityType').value = '遊戲';
                    document.getElementById('activityDuration').value = '';
                    document.getElementById('activityTime').value = isoString;
                    document.getElementById('activityNote').value = '';
                    document.getElementById('activitySetReminder').checked = false;
                    document.getElementById('activityReminderOptions').style.display = 'none';
                    break;
                    
                case 'other':
                    document.getElementById('otherTitle').value = '';
                    document.getElementById('otherContent').value = '';
                    document.getElementById('otherTime').value = isoString;
                    document.getElementById('otherSetReminder').checked = false;
                    document.getElementById('otherReminderOptions').style.display = 'none';
                    break;
            }
        }

        // 重置評分系統
        function resetRating(ratingId, value) {
            const ratingGroup = document.getElementById(ratingId);
            ratingGroup.querySelectorAll('.rating-star').forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'));
                if (starValue <= value) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // 顯示編輯記錄模態框
        function showEditRecordModal(record) {
            const modal = document.getElementById('editRecordModal');
            const modalBody = document.getElementById('editRecordBody');
            const modalTitle = document.getElementById('editRecordTitle');
            
            // 設定記錄ID
            modal.setAttribute('data-record-id', record.id);
            
            // 根據記錄類型顯示不同的編輯表單
            switch (record.type) {
                case 'feeding':
                    modalTitle.textContent = '編輯餵食記錄';
                    modalBody.innerHTML = `
                        <div class="form-group">
                        <label for="editFeedingType">餵食類型</label>
                            <select id="editFeedingType" class="form-control">
                                <option value="母乳" ${record.feedingType === '母乳' ? 'selected' : ''}>母乳</option>
                                <option value="配方奶" ${record.feedingType === '配方奶' ? 'selected' : ''}>配方奶</option>
                                <option value="副食品" ${record.feedingType === '副食品' ? 'selected' : ''}>副食品</option>
                                <option value="水果" ${record.feedingType === '水果' ? 'selected' : ''}>水果</option>
                                <option value="水/飲料" ${record.feedingType === '水/飲料' ? 'selected' : ''}>水/飲料</option>
                                <option value="其他" ${record.feedingType === '其他' ? 'selected' : ''}>其他</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="editFeedingAmount">數量/時間</label>
                                    <div style="display: flex; align-items: center;">
                                        <input type="number" id="editFeedingAmount" class="form-control" style="flex: 1; margin-right: 10px;" value="${record.amount || ''}">
                                        <select id="editFeedingUnit" class="form-control" style="width: 80px;">
                                            <option value="ml" ${record.unit === 'ml' ? 'selected' : ''}>毫升</option>
                                            <option value="min" ${record.unit === 'min' ? 'selected' : ''}>分鐘</option>
                                            <option value="份" ${record.unit === '份' ? 'selected' : ''}>份</option>
                                            <option value="湯匙" ${record.unit === '湯匙' ? 'selected' : ''}>湯匙</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editFeedingTime">時間</label>
                            <input type="datetime-local" id="editFeedingTime" class="form-control" value="${record.time || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editFeedingNote">備註</label>
                            <textarea id="editFeedingNote" class="form-control" rows="3">${record.note || ''}</textarea>
                        </div>
                    `;
                    break;
                    
                case 'sleep':
                    modalTitle.textContent = '編輯睡眠記錄';
                    modalBody.innerHTML = `
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="editSleepStart">開始時間</label>
                                    <input type="datetime-local" id="editSleepStart" class="form-control" value="${record.startTime || ''}">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                 <label for="editSleepEnd">結束時間</label>
                                    <input type="datetime-local" id="editSleepEnd" class="form-control" value="${record.endTime || ''}">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editSleepQuality">睡眠品質 (1-5分)</label>
                            <div class="rating" id="editSleepQualityRating">
                                <span class="rating-star ${parseInt(record.quality) >= 1 ? 'active' : ''}" data-value="1"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.quality) >= 2 ? 'active' : ''}" data-value="2"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.quality) >= 3 ? 'active' : ''}" data-value="3"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.quality) >= 4 ? 'active' : ''}" data-value="4"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.quality) >= 5 ? 'active' : ''}" data-value="5"><i class="fas fa-star"></i></span>
                            </div>
                            <input type="hidden" id="editSleepQuality" value="${record.quality || '3'}">
                        </div>
                        <div class="form-group">
                            <label for="editSleepNote">備註</label>
                            <textarea id="editSleepNote" class="form-control" rows="3">${record.note || ''}</textarea>
                        </div>
                    `;
                    // 添加評分系統事件監聽器
                    setTimeout(() => {
                        document.querySelectorAll('#editSleepQualityRating .rating-star').forEach(star => {
                            star.addEventListener('click', function() {
                                const value = this.getAttribute('data-value');
                                document.getElementById('editSleepQuality').value = value;
                                
                                // 更新星星顯示
                                document.querySelectorAll('#editSleepQualityRating .rating-star').forEach(s => {
                                    if (parseInt(s.getAttribute('data-value')) <= parseInt(value)) {
                                        s.classList.add('active');
                                    } else {
                                        s.classList.remove('active');
                                    }
                                });
                            });
                        });
                    }, 100);
                    break;
                    
                case 'diaper':
                    modalTitle.textContent = '編輯尿布記錄';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label>排泄類型</label>
                            <div style="display: flex; gap: 10px;">
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="editDiaperUrine" ${record.urine ? 'checked' : ''} style="margin-right: 5px;"> 小便
                                </label>
                                <label style="display: flex; align-items: center;">
                                    <input type="checkbox" id="editDiaperStool" ${record.stool ? 'checked' : ''} style="margin-right: 5px;"> 大便
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editDiaperCondition">狀況</label>
                            <select id="editDiaperCondition" class="form-control">
                                <option value="正常" ${record.condition === '正常' ? 'selected' : ''}>正常</option>
                                <option value="異常" ${record.condition === '異常' ? 'selected' : ''}>異常</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDiaperTime">時間</label>
                            <input type="datetime-local" id="editDiaperTime" class="form-control" value="${record.time || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editDiaperNote">備註</label>
                            <textarea id="editDiaperNote" class="form-control" rows="3">${record.note || ''}</textarea>
                        </div>
                    `;
                    break;
                    
                case 'emotion':
                    modalTitle.textContent = '編輯情緒記錄';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="editEmotionType">情緒類別</label>
                            <select id="editEmotionType" class="form-control">
                                <option value="開心" ${record.emotionType === '開心' ? 'selected' : ''}>開心</option>
                                <option value="難過" ${record.emotionType === '難過' ? 'selected' : ''}>難過</option>
                                <option value="生氣" ${record.emotionType === '生氣' ? 'selected' : ''}>生氣</option>
                                <option value="害怕" ${record.emotionType === '害怕' ? 'selected' : ''}>害怕</option>
                                <option value="驚訝" ${record.emotionType === '驚訝' ? 'selected' : ''}>驚訝</option>
                                <option value="平靜" ${record.emotionType === '平靜' ? 'selected' : ''}>平靜</option>
                                <option value="其他" ${record.emotionType === '其他' ? 'selected' : ''}>其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editEmotionIntensity">強度 (1-5分)</label>
                            <div class="rating" id="editEmotionIntensityRating">
                                <span class="rating-star ${parseInt(record.intensity) >= 1 ? 'active' : ''}" data-value="1"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.intensity) >= 2 ? 'active' : ''}" data-value="2"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.intensity) >= 3 ? 'active' : ''}" data-value="3"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.intensity) >= 4 ? 'active' : ''}" data-value="4"><i class="fas fa-star"></i></span>
                                <span class="rating-star ${parseInt(record.intensity) >= 5 ? 'active' : ''}" data-value="5"><i class="fas fa-star"></i></span>
                            </div>
                            <input type="hidden" id="editEmotionIntensity" value="${record.intensity || '3'}">
                        </div>
                        <div class="form-group">
                            <label for="editEmotionTime">時間</label>
                            <input type="datetime-local" id="editEmotionTime" class="form-control" value="${record.time || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editEmotionNote">備註</label>
                            <textarea id="editEmotionNote" class="form-control" rows="3">${record.note || ''}</textarea>
                        </div>
                    `;
                    // 添加評分系統事件監聽器
                    setTimeout(() => {
                        document.querySelectorAll('#editEmotionIntensityRating .rating-star').forEach(star => {
                            star.addEventListener('click', function() {
                                const value = this.getAttribute('data-value');
                                document.getElementById('editEmotionIntensity').value = value;
                                
                                // 更新星星顯示
                                document.querySelectorAll('#editEmotionIntensityRating .rating-star').forEach(s => {
                                    if (parseInt(s.getAttribute('data-value')) <= parseInt(value)) {
                                        s.classList.add('active');
                                    } else {
                                        s.classList.remove('active');
                                    }
                                });
                            });
                        });
                    }, 100);
                    break;
                    
                case 'activity':
                    modalTitle.textContent = '編輯活動記錄';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="editActivityType">活動類型</label>
                            <select id="editActivityType" class="form-control">
                                <option value="遊戲" ${record.activityType === '遊戲' ? 'selected' : ''}>遊戲</option>
                                <option value="洗澡" ${record.activityType === '洗澡' ? 'selected' : ''}>洗澡</option>
                                <option value="戶外" ${record.activityType === '戶外' ? 'selected' : ''}>戶外</option>
                                <option value="學習" ${record.activityType === '學習' ? 'selected' : ''}>學習</option>
                                <option value="社交" ${record.activityType === '社交' ? 'selected' : ''}>社交</option>
                                <option value="運動" ${record.activityType === '運動' ? 'selected' : ''}>運動</option>
                                <option value="其他" ${record.activityType === '其他' ? 'selected' : ''}>其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editActivityDuration">持續時間 (分鐘)</label>
                            <input type="number" id="editActivityDuration" class="form-control" value="${record.duration || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editActivityTime">開始時間</label>
                            <input type="datetime-local" id="editActivityTime" class="form-control" value="${record.time || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editActivityNote">備註</label>
                            <textarea id="editActivityNote" class="form-control" rows="3">${record.note || ''}</textarea>
                        </div>
                    `;
                    break;
                    
                case 'other':
                    modalTitle.textContent = '編輯其他記錄';
                    modalBody.innerHTML = `
                        <div class="form-group">
                            <label for="editOtherTitle">標題</label>
                            <input type="text" id="editOtherTitle" class="form-control" value="${record.title || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editOtherTime">時間</label>
                            <input type="datetime-local" id="editOtherTime" class="form-control" value="${record.time || ''}">
                        </div>
                        <div class="form-group">
                            <label for="editOtherContent">內容</label>
                            <textarea id="editOtherContent" class="form-control" rows="5">${record.content || ''}</textarea>
                        </div>
                    `;
                    break;
            }
            
            modal.classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 更新記錄
        function updateRecord() {
            const modal = document.getElementById('editRecordModal');
            const recordId = modal.getAttribute('data-record-id');
            const modalTitle = document.getElementById('editRecordTitle').textContent;
            
            // 找到要更新的記錄
            const childId = appData.selectedChild;
            const recordIndex = appData.records[childId].findIndex(r => r.id === recordId);
            
            if (recordIndex === -1) {
                alert('找不到要更新的記錄');
                return;
            }
            
            const record = appData.records[childId][recordIndex];
            
            // 根據記錄類型更新資料
            switch (record.type) {
                case 'feeding':
                    record.feedingType = document.getElementById('editFeedingType').value;
                    record.amount = document.getElementById('editFeedingAmount').value;
                    record.unit = document.getElementById('editFeedingUnit').value;
                    record.time = document.getElementById('editFeedingTime').value;
                    record.note = document.getElementById('editFeedingNote').value;

                    // 更新快速選項中的最近一次餵食記錄
                    appData.quickOptions.lastFeeding = {
                        type: record.feedingType,
                        amount: record.amount,
                        unit: record.unit
                    };
                    saveQuickOptions();
                    break;
                    
                case 'sleep':
                    record.startTime = document.getElementById('editSleepStart').value;
                    record.endTime = document.getElementById('editSleepEnd').value;
                    record.quality = document.getElementById('editSleepQuality').value;
                    record.note = document.getElementById('editSleepNote').value;
                    break;
                    
                case 'diaper':
                    record.urine = document.getElementById('editDiaperUrine').checked;
                    record.stool = document.getElementById('editDiaperStool').checked;
                    record.condition = document.getElementById('editDiaperCondition').value;
                    record.time = document.getElementById('editDiaperTime').value;
                    record.note = document.getElementById('editDiaperNote').value;
                    break;
                    
                case 'emotion':
                    record.emotionType = document.getElementById('editEmotionType').value;
                    record.intensity = document.getElementById('editEmotionIntensity').value;
                    record.time = document.getElementById('editEmotionTime').value;
                    record.note = document.getElementById('editEmotionNote').value;
                    break;
                    
                case 'activity':
                    record.activityType = document.getElementById('editActivityType').value;
                    record.duration = document.getElementById('editActivityDuration').value;
                    record.time = document.getElementById('editActivityTime').value;
                    record.note = document.getElementById('editActivityNote').value;
                    break;
                    
                case 'other':
                    record.title = document.getElementById('editOtherTitle').value;
                    record.time = document.getElementById('editOtherTime').value;
                    record.content = document.getElementById('editOtherContent').value;
                    break;
            }
            
            // 更新記錄
            appData.records[childId][recordIndex] = record;
            saveRecords(childId);
            
            // 關閉模態框並更新歷史記錄視圖
            closeModals();
            updateHistoryView();
            
            // 顯示成功訊息
            showToast('記錄已成功更新！');
        }

        // 刪除記錄
        function deleteRecord() {
            const modal = document.getElementById('editRecordModal');
            const recordId = modal.getAttribute('data-record-id');
            
            // 確認刪除
            if (!confirm('確定要刪除此記錄嗎？此操作無法復原。')) {
                return;
            }
            
            // 找到要刪除的記錄
            const childId = appData.selectedChild;
            const recordIndex = appData.records[childId].findIndex(r => r.id === recordId);
            
            if (recordIndex === -1) {
                alert('找不到要刪除的記錄');
                return;
            }
            
            // 刪除記錄
            appData.records[childId].splice(recordIndex, 1);
            saveRecords(childId);
            
            // 關閉模態框並更新歷史記錄視圖
            closeModals();
            updateHistoryView();
            
            // 顯示成功訊息
            showToast('記錄已成功刪除！');
        }

        // 更新歷史記錄視圖
        function updateHistoryView() {
            const historyContent = document.getElementById('historyContent');
            historyContent.innerHTML = '';
            
            if (!appData.selectedChild || !appData.records[appData.selectedChild]) {
                return;
            }
            
            // 獲取篩選條件
            const date = document.getElementById('historyDate').value;
            const filterType = document.getElementById('historyFilter').value;
            
            // 篩選記錄
            let filteredRecords = appData.records[appData.selectedChild].filter(record => {
                let recordDate;
                
                // 依照記錄類型獲取日期
                if (record.type === 'feeding' || record.type === 'diaper' || 
                    record.type === 'emotion' || record.type === 'other') {
                    recordDate = record.time ? record.time.split('T')[0] : '';
                } else if (record.type === 'sleep') {
                    recordDate = record.startTime ? record.startTime.split('T')[0] : '';
                } else if (record.type === 'activity') {
                    recordDate = record.time ? record.time.split('T')[0] : '';
                }
                
                // 過濾日期
                const dateMatch = date ? recordDate === date : true;
                
                // 過濾類型
                const typeMatch = filterType === 'all' ? true : record.type === filterType;
                
                return dateMatch && typeMatch;
            });
            
            // 依日期排序
            filteredRecords.sort((a, b) => {
                let aTime, bTime;
                
                if (a.type === 'feeding' || a.type === 'diaper' || 
                    a.type === 'emotion' || a.type === 'other') {
                    aTime = a.time || '';
                } else if (a.type === 'sleep') {
                    aTime = a.startTime || '';
                } else if (a.type === 'activity') {
                    aTime = a.time || '';
                }
                
                if (b.type === 'feeding' || b.type === 'diaper' || 
                    b.type === 'emotion' || b.type === 'other') {
                    bTime = b.time || '';
                } else if (b.type === 'sleep') {
                    bTime = b.startTime || '';
                } else if (b.type === 'activity') {
                    bTime = b.time || '';
                }
                
                return new Date(bTime) - new Date(aTime);
            });
            
            if (filteredRecords.length === 0) {
                historyContent.innerHTML = '<p class="text-center">此日期無記錄</p>';
                return;
            }
            
            // 依日期分組顯示
            const recordsByDate = {};
            
            filteredRecords.forEach(record => {
                let recordDate;
                
                if (record.type === 'feeding' || record.type === 'diaper' || 
                    record.type === 'emotion' || record.type === 'other') {
                    recordDate = record.time ? record.time.split('T')[0] : '';
                } else if (record.type === 'sleep') {
                    recordDate = record.startTime ? record.startTime.split('T')[0] : '';
                } else if (record.type === 'activity') {
                    recordDate = record.time ? record.time.split('T')[0] : '';
                }
                
                if (!recordsByDate[recordDate]) {
                    recordsByDate[recordDate] = [];
                }
                
                recordsByDate[recordDate].push(record);
            });
            
            // 生成歷史記錄HTML
            for (const date in recordsByDate) {
                const dayElement = document.createElement('div');
                dayElement.className = 'history-day';
                
                const header = document.createElement('div');
                header.className = 'history-day-header';
                header.textContent = formatDate(date);
                dayElement.appendChild(header);
                
                const recordsContainer = document.createElement('div');
                recordsContainer.className = 'history-records';
                
                recordsByDate[date].forEach(record => {
                    const recordElement = document.createElement('div');
                    recordElement.className = `history-record record-color-${record.type}`;
                    recordElement.setAttribute('data-record-id', record.id);
                    recordElement.addEventListener('click', () => showEditRecordModal(record));
                    
                    // 獲取時間
                    let recordTime;
                    if (record.type === 'feeding' || record.type === 'diaper' || 
                        record.type === 'emotion' || record.type === 'other') {
                        recordTime = record.time ? record.time.split('T')[1].substr(0, 5) : '';
                    } else if (record.type === 'sleep') {
                        recordTime = record.startTime ? record.startTime.split('T')[1].substr(0, 5) : '';
                    } else if (record.type === 'activity') {
                        recordTime = record.time ? record.time.split('T')[1].substr(0, 5) : '';
                    }
                
                    let recordTypeDisplay = '';
                    let recordInfo = '';
                    
                    // 依照記錄類型顯示內容
                    switch (record.type) {
                        case 'feeding':
                            recordTypeDisplay = `<span class="record-icon record-icon-feeding"><i class="fas fa-utensils"></i></span> 餵食`;
                            recordInfo = `${record.feedingType || ''} ${record.amount || ''} ${record.unit || ''}`;
                            break;
                            
                        case 'sleep':
                            recordTypeDisplay = `<span class="record-icon record-icon-sleep"><i class="fas fa-bed"></i></span> 睡眠`;
                            const startTime = record.startTime ? record.startTime.split('T')[1].substr(0, 5) : '';
                            const endTime = record.endTime ? record.endTime.split('T')[1].substr(0, 5) : '';
                            const duration = calculateDuration(record.startTime, record.endTime);
                            recordInfo = `${startTime} - ${endTime} (${duration}) | 品質: ${record.quality || ''}`;
                            break;
                            
                        case 'diaper':
                            recordTypeDisplay = `<span class="record-icon record-icon-diaper"><i class="fas fa-baby"></i></span> 尿布`;
                            const diaperType = [];
                            if (record.urine) diaperType.push('小便');
                            if (record.stool) diaperType.push('大便');
                            recordInfo = `${diaperType.join('、')} | ${record.condition || ''}`;
                            break;
                            
                        case 'emotion':
                            recordTypeDisplay = `<span class="record-icon record-icon-emotion"><i class="fas fa-smile"></i></span> 情緒`;
                            recordInfo = `${record.emotionType || ''} | 強度: ${record.intensity || ''}`;
                            break;
                            
                        case 'activity':
                            recordTypeDisplay = `<span class="record-icon record-icon-activity"><i class="fas fa-walking"></i></span> 活動`;
                            recordInfo = `${record.activityType || ''} | ${record.duration || ''} 分鐘`;
                            break;
                            
                        case 'other':
                            recordTypeDisplay = `<span class="record-icon record-icon-other"><i class="fas fa-plus-circle"></i></span> 其他`;
                            recordInfo = record.title || '';
                            break;
                    }
                    
                    recordElement.innerHTML = `
                        <div class="history-record-time">${recordTime}</div>
                        <div class="history-record-type">${recordTypeDisplay}</div>
                        <div class="history-record-info">${recordInfo}</div>
                    `;
                    
                    recordsContainer.appendChild(recordElement);
                });
                
                dayElement.appendChild(recordsContainer);
                historyContent.appendChild(dayElement);
            }
        }

        // 更新里程碑視圖
        function updateMilestoneView() {
            const milestoneContent = document.getElementById('milestoneContent');
            milestoneContent.innerHTML = '';
            
            if (!appData.selectedChild) {
                return;
            }
            
            // 獲取篩選條件
            const filter = document.getElementById('milestoneFilter').value;
            
            // 生成里程碑HTML
            if (!appData.milestones[appData.selectedChild]) {
                initMilestones(appData.selectedChild);
            }
            
            for (const ageGroup in milestonesDefinition) {
                // 如果有篩選，則跳過不符合的年齡組
                if (filter !== 'all' && filter !== ageGroup) {
                    continue;
                }
                
                const ageGroupElement = document.createElement('div');
                ageGroupElement.className = 'milestone-category';
                
                const ageGroupHeader = document.createElement('h3');
                ageGroupHeader.textContent = getAgeGroupLabel(ageGroup);
                ageGroupElement.appendChild(ageGroupHeader);
                
                for (const category in milestonesDefinition[ageGroup]) {
                    const categoryElement = document.createElement('div');
                    categoryElement.className = 'milestone-subcategory';
                    
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = category;
                    categoryElement.appendChild(categoryHeader);
                    
                    const milestoneList = document.createElement('ul');
                    milestoneList.className = 'milestone-list';
                    
                    milestonesDefinition[ageGroup][category].forEach(milestone => {
                        const milestoneId = `${ageGroup}_${category}_${milestone.name}`;
                        
                        // 如果里程碑資料中沒有此里程碑，則初始化
                        if (!appData.milestones[appData.selectedChild][milestoneId]) {
                            appData.milestones[appData.selectedChild][milestoneId] = {
                                achieved: false,
                                date: ''
                            };
                        }
                        
                        const milestoneData = appData.milestones[appData.selectedChild][milestoneId];
                        
                        const milestoneItem = document.createElement('li');
                        milestoneItem.className = 'milestone-item';
                        
                        const milestoneInfo = document.createElement('div');
                        milestoneInfo.className = 'milestone-info';
                        
                        const milestoneName = document.createElement('div');
                        milestoneName.className = 'milestone-name';
                        milestoneName.textContent = milestone.name;
                        milestoneInfo.appendChild(milestoneName);
                        const milestoneAge = document.createElement('div');
                        milestoneAge.className = 'milestone-age';
                        milestoneAge.textContent = `典型發展年齡: ${milestone.typicalAge}`;
                        milestoneInfo.appendChild(milestoneAge);
                        
                        milestoneItem.appendChild(milestoneInfo);
                        
                        const milestoneStatus = document.createElement('div');
                        milestoneStatus.className = 'milestone-status';
                        
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.className = 'milestone-checkbox';
                        checkbox.checked = milestoneData.achieved;
                        checkbox.addEventListener('change', function() {
                            updateMilestoneStatus(milestoneId, this.checked);
                        });
                        milestoneStatus.appendChild(checkbox);
                        
                        const dateInput = document.createElement('input');
                        dateInput.type = 'date';
                        dateInput.className = 'milestone-date';
                        dateInput.value = milestoneData.date;
                        dateInput.disabled = !milestoneData.achieved;
                        dateInput.addEventListener('change', function() {
                            updateMilestoneDate(milestoneId, this.value);
                        });
                        milestoneStatus.appendChild(dateInput);
                        
                        milestoneItem.appendChild(milestoneStatus);
                        milestoneList.appendChild(milestoneItem);
                    });
                    
                    categoryElement.appendChild(milestoneList);
                    ageGroupElement.appendChild(categoryElement);
                }
                
                milestoneContent.appendChild(ageGroupElement);
            }
        }

        // 更新照顧提示視圖
        function updateCareTipsView() {
            const caretipsContent = document.getElementById('caretipsContent');
            caretipsContent.innerHTML = '';
            
            if (!appData.selectedChild) {
                return;
            }
            
            // 獲取當前選擇的兒童的年齡
            const child = appData.children.find(c => c.id === appData.selectedChild);
            if (!child) return;
            
            const birthday = new Date(child.birthday);
            const now = new Date();
            const ageInMonths = Math.floor((now - birthday) / (30.44 * 24 * 60 * 60 * 1000));
            
            // 獲取篩選條件
            const filterCategory = document.getElementById('caretipsCategory').value;
            
            // 確定適合的年齡組
            let ageGroup = '';
            if (ageInMonths >= 0 && ageInMonths <= 3) {
                ageGroup = '0-3';
            } else if (ageInMonths >= 4 && ageInMonths <= 6) {
                ageGroup = '4-6';
            } else if (ageInMonths >= 7 && ageInMonths <= 9) {
                ageGroup = '7-9';
            } else if (ageInMonths >= 10 && ageInMonths <= 12) {
                ageGroup = '10-12';
            } else if (ageInMonths >= 13 && ageInMonths <= 18) {
                ageGroup = '13-18';
            } else if (ageInMonths >= 19 && ageInMonths <= 24) {
                ageGroup = '19-24';
            } else {
                // 如果超過24個月，顯示19-24個月的提示
                ageGroup = '19-24';
            }
            
            // 檢查是否有該年齡組的提示
            if (!careTipsData[ageGroup]) {
                caretipsContent.innerHTML = `<p>目前沒有適合 ${ageInMonths} 個月寶寶的照顧提示。</p>`;
                return;
            }
            
            // 創建年齡組容器
            const ageGroupElement = document.createElement('div');
            ageGroupElement.className = 'caretips-age-group';
            
            // 年齡組標題
            const ageHeader = document.createElement('div');
            ageHeader.className = 'caretips-age-header';
            ageHeader.innerHTML = `<i class="fas fa-child"></i> ${getAgeGroupLabel(ageGroup)} 寶寶的照顧提示`;
            ageGroupElement.appendChild(ageHeader);
            
            // 遍歷所有分類
            for (const category in careTipsData[ageGroup]) {
                // 如果有篩選且不匹配，則跳過
                if (filterCategory !== 'all' && filterCategory !== category) {
                    continue;
                }
                
                // 創建分類容器
                const categoryElement = document.createElement('div');
                categoryElement.className = 'caretips-category';
                
                // 分類標題
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'caretips-category-header';
                
                // 根據分類設置圖標
                let categoryIcon = '';
                let categoryTitle = '';
                switch (category) {
                    case 'feeding':
                        categoryIcon = '<i class="fas fa-utensils category-icon-feeding"></i>';
                        categoryTitle = '餵食';
                        break;
                    case 'sleep':
                        categoryIcon = '<i class="fas fa-bed category-icon-sleep"></i>';
                        categoryTitle = '睡眠';
                        break;
                    case 'activity':
                        categoryIcon = '<i class="fas fa-walking category-icon-activity"></i>';
                        categoryTitle = '活動與遊戲';
                        break;
                    case 'safety':
                        categoryIcon = '<i class="fas fa-shield-alt category-icon-safety"></i>';
                        categoryTitle = '安全';
                        break;
                    case 'health':
                        categoryIcon = '<i class="fas fa-heartbeat category-icon-health"></i>';
                        categoryTitle = '健康與衛生';
                        break;
                    case 'development':
                        categoryIcon = '<i class="fas fa-brain category-icon-development"></i>';
                        categoryTitle = '發展與學習';
                        break;
                    default:
                        categoryIcon = '<i class="fas fa-info-circle"></i>';
                        categoryTitle = category;
                }
                
                categoryHeader.innerHTML = `${categoryIcon} <span>${categoryTitle}</span>`;
                categoryElement.appendChild(categoryHeader);
                
                // 創建提示項目容器
                const tipsContainer = document.createElement('div');
                tipsContainer.className = 'caretips-category-items';
                
                // 遍歷該分類下的所有提示
                careTipsData[ageGroup][category].forEach(tip => {
                    // 創建提示項目
                    const tipItem = document.createElement('div');
                    tipItem.className = 'caretip-item';
                    if (tip.important) {
                        tipItem.classList.add('important');
                    }
                    
                    // 提示標題
                    const tipTitle = document.createElement('div');
                    tipTitle.className = 'caretip-title';
                    if (tip.important) {
                        tipTitle.innerHTML = `${tip.title} <i class="fas fa-exclamation-circle" style="color: var(--danger-color);"></i>`;
                    } else {
                        tipTitle.textContent = tip.title;
                    }
                    tipItem.appendChild(tipTitle);
                    
                    // 提示描述
                    const tipDesc = document.createElement('div');
                    tipDesc.className = 'caretip-description';
                    tipDesc.textContent = tip.description;
                    tipItem.appendChild(tipDesc);
                    
                    // 添加標籤
                    const tipTags = document.createElement('div');
                    tipTags.className = 'caretip-tags';
                    tipTags.style.marginTop = '8px';
                    
                    // 添加分類標籤
                    const categoryTag = document.createElement('span');
                    categoryTag.className = `caretip-tag caretip-tag-${category}`;
                    categoryTag.textContent = categoryTitle;
                    tipTags.appendChild(categoryTag);
                    
                    // 如果是重要提示，添加重要標籤
                    if (tip.important) {
                        const importantTag = document.createElement('span');
                        importantTag.className = 'caretip-tag caretip-tag-safety';
                        importantTag.textContent = '重要';
                        tipTags.appendChild(importantTag);
                    }
                    
                    tipItem.appendChild(tipTags);
                    
                    tipsContainer.appendChild(tipItem);
                });
                
                categoryElement.appendChild(tipsContainer);
                ageGroupElement.appendChild(categoryElement);
            }
            
            caretipsContent.appendChild(ageGroupElement);
        }

        // 更新里程碑狀態
        function updateMilestoneStatus(milestoneId, achieved) {
            if (!appData.selectedChild) return;
            
            if (!appData.milestones[appData.selectedChild][milestoneId]) {
                appData.milestones[appData.selectedChild][milestoneId] = {
                    achieved: false,
                    date: ''
                };
            }
            
            appData.milestones[appData.selectedChild][milestoneId].achieved = achieved;
            
            // 如果已達成，則設定日期為今天；否則清空日期
            if (achieved) {
                const today = new Date().toISOString().split('T')[0];
                appData.milestones[appData.selectedChild][milestoneId].date = today;
                
                // 更新日期輸入欄位
                const dateInputs = document.querySelectorAll('.milestone-date');
                dateInputs.forEach(input => {
                    const parentItem = input.closest('.milestone-item');
                    const nameElement = parentItem.querySelector('.milestone-name');
                    if (nameElement && nameElement.textContent === milestoneId.split('_')[2]) {
                        input.value = today;
                        input.disabled = false;
                    }
                });
                
                // 檢查是否是重要里程碑，如疫苗相關，添加疫苗接種提醒
                const milestoneName = milestoneId.split('_')[2];
                if (milestoneName.includes('疫苗') || milestoneName.includes('預防針')) {
                    const [ageGroup, category, name] = milestoneId.split('_');
                    
                    // 添加下一次疫苗接種提醒（假設為3個月後）
                    const reminderDate = new Date();
                    reminderDate.setMonth(reminderDate.getMonth() + 3);
                    
                    addReminder(appData.selectedChild, {
                        type: 'vaccine',
                        title: `疫苗接種提醒 - ${name}`,
                        time: reminderDate.toISOString(),
                        message: `該給寶寶接種${name}疫苗了`,
                        completed: false,
                        repeat: null
                    });
                    
                    showToast(`里程碑已更新，並設定3個月後的疫苗提醒`);
                }
            } else {
                appData.milestones[appData.selectedChild][milestoneId].date = '';
                
                // 更新日期輸入欄位
                const dateInputs = document.querySelectorAll('.milestone-date');
                dateInputs.forEach(input => {
                    const parentItem = input.closest('.milestone-item');
                    const nameElement = parentItem.querySelector('.milestone-name');
                    if (nameElement && nameElement.textContent === milestoneId.split('_')[2]) {
                        input.value = '';
                        input.disabled = true;
                    }
                });
            }
            
            saveMilestones(appData.selectedChild);
        }

        // 更新里程碑日期
        function updateMilestoneDate(milestoneId, date) {
            if (!appData.selectedChild) return;
            
            if (!appData.milestones[appData.selectedChild][milestoneId]) {
                appData.milestones[appData.selectedChild][milestoneId] = {
                    achieved: true,
                    date: date
                };
            } else {
                appData.milestones[appData.selectedChild][milestoneId].date = date;
            }
            
            saveMilestones(appData.selectedChild);
        }

        // 獲取年齡組標籤
        function getAgeGroupLabel(ageGroup) {
            switch (ageGroup) {
                case '0-3': return '0-3個月';
                case '4-6': return '4-6個月';
                case '7-9': return '7-9個月';
                case '10-12': return '10-12個月';
                case '13-18': return '13-18個月';
                case '19-24': return '19-24個月';
                default: return ageGroup;
            }
        }

        // 更新統計視圖
        function updateStatsView(period, customDates) {
            if (!appData.selectedChild || !appData.records[appData.selectedChild]) {
                return;
            }
            
            // 設定日期範圍
            let startDate, endDate;
            const today = new Date();
            
            switch (period) {
                case 'week':
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    endDate = today;
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                    endDate = today;
                    break;
                case '3months':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 3, today.getDate());
                    endDate = today;
                    break;
                case 'custom':
                    if (customDates) {
                        startDate = new Date(customDates.startDate);
                        endDate = new Date(customDates.endDate);
                    } else {
                        startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                        endDate = today;
                    }
                    break;
                default:
                    startDate = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    endDate = today;
            }
            
            // 將時間設為當天的 23:59:59 以包含整天
            endDate.setHours(23, 59, 59, 999);
            
            // 篩選在日期範圍內的記錄
            const filteredRecords = appData.records[appData.selectedChild].filter(record => {
                let recordDate;
                
                if (record.type === 'feeding' || record.type === 'diaper' || 
                    record.type === 'emotion' || record.type === 'other') {
                    recordDate = record.time ? new Date(record.time) : null;
                } else if (record.type === 'sleep') {
                    recordDate = record.startTime ? new Date(record.startTime) : null;
                } else if (record.type === 'activity') {
                    recordDate = record.time ? new Date(record.time) : null;
                }
                
                return recordDate && recordDate >= startDate && recordDate <= endDate;
            });
            
            // 更新各統計圖表
            updateSleepChart(filteredRecords, startDate, endDate);
            updateFeedingChart(filteredRecords, startDate, endDate);
            updateDiaperChart(filteredRecords, startDate, endDate);
            updateEmotionChart(filteredRecords, startDate, endDate);
        }

        // 更新睡眠統計圖表
        function updateSleepChart(records, startDate, endDate) {
            const sleepRecords = records.filter(record => record.type === 'sleep');
            
            // 如果沒有記錄，顯示空圖表
            if (sleepRecords.length === 0) {
                const ctx = document.getElementById('sleepChart').getContext('2d');
                if (window.sleepChart) {
                    window.sleepChart.destroy();
                }
                window.sleepChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['無資料'],
                        datasets: [{
                            label: '睡眠時間 (小時)',
                            data: [0],
                            backgroundColor: 'rgba(142, 202, 230, 0.5)',
                            borderColor: 'rgba(142, 202, 230, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                return;
            }
            
            // 按日期分組睡眠記錄
            const sleepByDate = {};
            const dateLabels = [];
            
            // 生成日期範圍內的所有日期
            const dateRange = [];
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateString = currentDate.toISOString().split('T')[0];
                dateRange.push(dateString);
                sleepByDate[dateString] = {
                    totalDuration: 0,
                    qualitySum: 0,
                    count: 0
                };
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // 計算每日睡眠時間和品質
            sleepRecords.forEach(record => {
                if (!record.startTime || !record.endTime) return;
                
                const startTime = new Date(record.startTime);
                const endTime = new Date(record.endTime);
                const dateString = startTime.toISOString().split('T')[0];
                
                // 計算持續時間（小時）
                const durationHours = (endTime - startTime) / (1000 * 60 * 60);
                
                if (sleepByDate[dateString]) {
                    sleepByDate[dateString].totalDuration += durationHours;
                    sleepByDate[dateString].qualitySum += parseInt(record.quality || 3);
                    sleepByDate[dateString].count++;
                }
            });
            
            // 準備圖表資料
            const durations = [];
            const qualities = [];
            
            dateRange.forEach(date => {
                dateLabels.push(formatDate(date, 'short'));
                
                const sleepData = sleepByDate[date];
                durations.push(sleepData.totalDuration.toFixed(1));
                
                // 計算平均品質
                const avgQuality = sleepData.count > 0 ? (sleepData.qualitySum / sleepData.count) : 0;
                qualities.push(avgQuality.toFixed(1));
            });
            
            // 繪製圖表
            const ctx = document.getElementById('sleepChart').getContext('2d');
            if (window.sleepChart) {
                window.sleepChart.destroy();
            }
            window.sleepChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dateLabels,
                    datasets: [
                        {
                            label: '睡眠時間 (小時)',
                            data: durations,
                            backgroundColor: 'rgba(142, 202, 230, 0.5)',
                            borderColor: 'rgba(142, 202, 230, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        },
                        {
                            label: '睡眠品質 (1-5分)',
                            data: qualities,
                            type: 'line',
                            fill: false,
                            borderColor: 'rgba(147, 129, 255, 1)',
                            backgroundColor: 'rgba(147, 129, 255, 0.5)',
                            tension: 0.1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '睡眠時間 (小時)'
                            }
                        },
                        y1: {
                            beginAtZero: true,
                            max: 5,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: '睡眠品質'
                            }
                        }
                    }
                }
            });
        }

        // 更新餵食統計圖表
        function updateFeedingChart(records, startDate, endDate) {
            const feedingRecords = records.filter(record => record.type === 'feeding');
            
            // 如果沒有記錄，顯示空圖表
            if (feedingRecords.length === 0) {
                const ctx = document.getElementById('feedingChart').getContext('2d');
                if (window.feedingChart) {
                    window.feedingChart.destroy();
                }
                window.feedingChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['無資料'],
                        datasets: [{
                            label: '餵食量',
                            data: [0],
                            backgroundColor: 'rgba(82, 183, 136, 0.5)',
                            borderColor: 'rgba(82, 183, 136, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                return;
            }
            
            // 按日期和類型分組餵食記錄
            const feedingByDate = {};
            const dateLabels = [];
            const feedingTypes = new Set();
            
            // 生成日期範圍內的所有日期
            const dateRange = [];
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateString = currentDate.toISOString().split('T')[0];
                dateRange.push(dateString);
                feedingByDate[dateString] = {};
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // 計算每日各類型餵食量
            feedingRecords.forEach(record => {
                if (!record.time) return;
                
                const dateString = new Date(record.time).toISOString().split('T')[0];
                const feedingType = record.feedingType || '其他';
                feedingTypes.add(feedingType);
                
                let amount = parseFloat(record.amount) || 0;
                
                // 根據單位調整數值 (僅計算毫升)
                if (record.unit === 'ml' && feedingByDate[dateString]) {
                    if (!feedingByDate[dateString][feedingType]) {
                        feedingByDate[dateString][feedingType] = 0;
                    }
                    feedingByDate[dateString][feedingType] += amount;
                }
            });
            
            // 準備圖表資料
            const datasets = [];
            const colors = [
                'rgba(142, 202, 230, 0.5)',
                'rgba(82, 183, 136, 0.5)',
                'rgba(255, 183, 3, 0.5)',
                'rgba(231, 111, 81, 0.5)',
                'rgba(147, 129, 255, 0.5)'
            ];
            
            dateRange.forEach(date => {
                dateLabels.push(formatDate(date, 'short'));
            });
            
            let colorIndex = 0;
            feedingTypes.forEach(type => {
                // 僅處理毫升單位的記錄
                if (type) {
                    const data = dateRange.map(date => {
                        return feedingByDate[date][type] || 0;
                    });
                    
                    datasets.push({
                        label: type,
                        data: data,
                        backgroundColor: colors[colorIndex % colors.length],
                        borderColor: colors[colorIndex % colors.length].replace('0.5', '1'),
                        borderWidth: 1
                    });
                    
                    colorIndex++;
                }
            });
            
            // 繪製圖表
            const ctx = document.getElementById('feedingChart').getContext('2d');
            if (window.feedingChart) {
                window.feedingChart.destroy();
            }
            window.feedingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dateLabels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '餵食量 (毫升)'
                            }
                        }
                    }
                }
            });
        }

        // 更新尿布統計圖表
        function updateDiaperChart(records, startDate, endDate) {
            const diaperRecords = records.filter(record => record.type === 'diaper');
            
            // 如果沒有記錄，顯示空圖表
            if (diaperRecords.length === 0) {
                const ctx = document.getElementById('diaperChart').getContext('2d');
                if (window.diaperChart) {
                    window.diaperChart.destroy();
                }
                window.diaperChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['無資料'],
                        datasets: [{
                            label: '尿布更換次數',
                            data: [0],
                            backgroundColor: 'rgba(255, 183, 3, 0.5)',
                            borderColor: 'rgba(255, 183, 3, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                return;
            }
            
            // 按日期和類型分組尿布記錄
            const diaperByDate = {};
            const dateLabels = [];
            
            // 生成日期範圍內的所有日期
            const dateRange = [];
            const currentDate = new Date(startDate);
            while (currentDate <= endDate) {
                const dateString = currentDate.toISOString().split('T')[0];
                dateRange.push(dateString);
                diaperByDate[dateString] = {
                    urine: 0,
                    stool: 0,
                    both: 0
                };
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // 計算每日尿布更換次數
            diaperRecords.forEach(record => {
                if (!record.time) return;
                
                const dateString = new Date(record.time).toISOString().split('T')[0];
                
                if (diaperByDate[dateString]) {
                    if (record.urine && record.stool) {
                        diaperByDate[dateString].both++;
                    } else if (record.urine) {
                        diaperByDate[dateString].urine++;
                    } else if (record.stool) {
                        diaperByDate[dateString].stool++;
                    }
                }
            });
            
            // 準備圖表資料
            const urineData = [];
            const stoolData = [];
            const bothData = [];
            
            dateRange.forEach(date => {
                dateLabels.push(formatDate(date, 'short'));
                urineData.push(diaperByDate[date].urine);
                stoolData.push(diaperByDate[date].stool);
                bothData.push(diaperByDate[date].both);
            });
            
            // 繪製圖表
            const ctx = document.getElementById('diaperChart').getContext('2d');
            if (window.diaperChart) {
                window.diaperChart.destroy();
            }
            window.diaperChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dateLabels,
                    datasets: [
                        {
                            label: '小便',
                            data: urineData,
                            backgroundColor: 'rgba(142, 202, 230, 0.5)',
                            borderColor: 'rgba(142, 202, 230, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '大便',
                            data: stoolData,
                            backgroundColor: 'rgba(231, 111, 81, 0.5)',
                            borderColor: 'rgba(231, 111, 81, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '大小便',
                            data: bothData,
                            backgroundColor: 'rgba(255, 183, 3, 0.5)',
                            borderColor: 'rgba(255, 183, 3, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '尿布更換次數'
                            }
                        }
                    }
                }
            });
        }

        // 更新情緒統計圖表
        function updateEmotionChart(records, startDate, endDate) {
            const emotionRecords = records.filter(record => record.type === 'emotion');
            
            // 如果沒有記錄，顯示空圖表
            if (emotionRecords.length === 0) {
                const ctx = document.getElementById('emotionChart').getContext('2d');
                if (window.emotionChart) {
                    window.emotionChart.destroy();
                }
                window.emotionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['無資料'],
                        datasets: [{
                            label: '情緒強度',
                            data: [0],
                            backgroundColor: 'rgba(231, 111, 81, 0.5)',
                            borderColor: 'rgba(231, 111, 81, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5
                            }
                        }
                    }
                });
                return;
            }
            
            // 按日期和類型分組情緒記錄
            const emotionByType = {};
            const dateLabels = new Set();
            
            // 收集所有日期和情緒類型
            emotionRecords.forEach(record => {
                if (!record.time) return;
                
                const dateTime = new Date(record.time);
                const dateTimeString = dateTime.toISOString();
                const emotionType = record.emotionType || '其他';
                
                dateLabels.add(dateTimeString);
                
                if (!emotionByType[emotionType]) {
                    emotionByType[emotionType] = {};
                }
                
                emotionByType[emotionType][dateTimeString] = parseInt(record.intensity) || 3;
            });
            
            // 將日期轉換為陣列並排序
            const sortedDates = Array.from(dateLabels).sort();
            const formattedDates = sortedDates.map(date => {
                const dateObj = new Date(date);
                return formatDate(dateObj, 'datetime');
            });
            
            // 準備圖表資料
            const datasets = [];
            const colors = [
                'rgba(231, 111, 81, 1)',
                'rgba(142, 202, 230, 1)',
                'rgba(255, 183, 3, 1)',
                'rgba(82, 183, 136, 1)',
                'rgba(147, 129, 255, 1)'
            ];
            
            let colorIndex = 0;
            for (const type in emotionByType) {
                const data = sortedDates.map(date => emotionByType[type][date] || null);
                
                datasets.push({
                    label: type,
                    data: data,
                    fill: false,
                    borderColor: colors[colorIndex % colors.length],
                    tension: 0.1,
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
                
                colorIndex++;
            }
            
            // 繪製圖表
            const ctx = document.getElementById('emotionChart').getContext('2d');
            if (window.emotionChart) {
                window.emotionChart.destroy();
            }
            window.emotionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: formattedDates,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            title: {
                                display: true,
                                text: '情緒強度 (1-5分)'
                            }
                        }
                    }
                }
            });
        }

        // 匯出為CSV
        function exportToCSV() {
            if (!appData.selectedChild) {
                alert('請先選擇一位兒童');
                return;
            }
            
            // 獲取篩選條件
            const exportAllTypes = document.getElementById('exportAllTypes').checked;
            const exportAllDates = document.getElementById('exportAllDates').checked;
            
            // 篩選記錄類型
            let selectedTypes = [];
            if (exportAllTypes) {
                selectedTypes = ['feeding', 'sleep', 'diaper', 'emotion', 'activity', 'other'];
            } else {
                document.querySelectorAll('input[name="exportType"]:checked').forEach(checkbox => {
                    selectedTypes.push(checkbox.value);
                });
            }
            
            // 篩選日期範圍
            let startDate, endDate;
            if (exportAllDates) {
                startDate = new Date(0); // 最早日期
                endDate = new Date(); // 現在
            } else {
                startDate = new Date(document.getElementById('exportStartDate').value);
                endDate = new Date(document.getElementById('exportEndDate').value);
                endDate.setHours(23, 59, 59, 999); // 設定為當天結束
            }
            
            // 篩選記錄
            let filteredRecords = appData.records[appData.selectedChild].filter(record => {
                // 檢查記錄類型
                if (!selectedTypes.includes(record.type)) {
                    return false;
                }
                
                // 檢查日期範圍
                let recordDate;
                
                if (record.type === 'feeding' || record.type === 'diaper' || 
                    record.type === 'emotion' || record.type === 'other') {
                    recordDate = record.time ? new Date(record.time) : null;
                } else if (record.type === 'sleep') {
                    recordDate = record.startTime ? new Date(record.startTime) : null;
                } else if (record.type === 'activity') {
                    recordDate = record.time ? new Date(record.time) : null;
                }
                
                return recordDate && recordDate >= startDate && recordDate <= endDate;
            });
            
            // 如果沒有記錄，顯示提示
            if (filteredRecords.length === 0) {
                alert('沒有符合條件的記錄');
                return;
            }
            
            // 生成CSV內容
            let csvContent = '';
            
            // 添加標題行
            csvContent += '記錄類型,日期時間,詳細資訊,備註\n';
            
            // 添加記錄行
            filteredRecords.forEach(record => {
                let recordType = '';
                let dateTime = '';
                let details = '';
                let note = '';
                
                // 處理記錄類型
                switch (record.type) {
                    case 'feeding':
                        recordType = '餵食';
                        dateTime = record.time || '';
                        details = `${record.feedingType || ''}, ${record.amount || ''} ${record.unit || ''}`;
                        note = record.note || '';
                        break;
                        
                    case 'sleep':
                        recordType = '睡眠';
                        dateTime = record.startTime || '';
                        const duration = calculateDuration(record.startTime, record.endTime);
                        details = `開始: ${formatDateTime(record.startTime)}, 結束: ${formatDateTime(record.endTime)}, 持續: ${duration}, 品質: ${record.quality || ''}`;
                        note = record.note || '';
                        break;
                        
                    case 'diaper':
                        recordType = '尿布';
                        dateTime = record.time || '';
                        const diaperType = [];
                        if (record.urine) diaperType.push('小便');
                        if (record.stool) diaperType.push('大便');
                        details = `類型: ${diaperType.join('、')}, 狀況: ${record.condition || ''}`;
                        note = record.note || '';
                        break;
                        
                    case 'emotion':
                        recordType = '情緒';
                        dateTime = record.time || '';
                        details = `類型: ${record.emotionType || ''}, 強度: ${record.intensity || ''}`;
                        note = record.note || '';
                        break;
                        
                    case 'activity':
                        recordType = '活動';
                        dateTime = record.time || '';
                        details = `類型: ${record.activityType || ''}, 持續: ${record.duration || ''} 分鐘`;
                        note = record.note || '';
                        break;
                        
                    case 'other':
                        recordType = '其他';
                        dateTime = record.time || '';
                        details = record.title || '';
                        note = record.content || '';
                        break;
                }
                
                // 替換逗號，避免CSV格式問題
                details = details.replace(/,/g, '，');
                note = note.replace(/,/g, '，');
                
                // 添加記錄行
                csvContent += `${recordType},${dateTime},${details},${note}\n`;
            });
            
            // 觸發下載
            const child = appData.children.find(c => c.id === appData.selectedChild);
            const filename = `${child.name}_記錄_${formatDate(new Date())}.csv`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 格式化日期
        function formatDate(dateString, format = 'full') {
            const date = new Date(dateString);
            
            if (isNaN(date.getTime())) {
                return '';
            }
            
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            
            if (format === 'short') {
                return `${month}/${day}`;
            } else if (format === 'datetime') {
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${month}/${day} ${hours}:${minutes}`;
            } else {
                return `${year}-${month}-${day}`;
            }
        }

        // 格式化日期時間
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            
            const date = new Date(dateTimeString);
            
            if (isNaN(date.getTime())) {
                return '';
            }
            
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        // 計算持續時間
        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return '';
            
            const start = new Date(startTime);
            const end = new Date(endTime);
            
            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                return '';
            }
            
            let diff = end - start; // 毫秒
            
            if (diff < 0) {
                return '時間錯誤';
            }
            
            // 轉換為小時和分鐘
            const hours = Math.floor(diff / (1000 * 60 * 60));
            diff -= hours * (1000 * 60 * 60);
            const minutes = Math.floor(diff / (1000 * 60));
            
            return `${hours}小時${minutes}分鐘`;
        }

        // 顯示刪除兒童確認模態框
        function showDeleteChildModal() {
            if (!appData.selectedChild) {
                alert('請先選擇一位兒童');
                return;
            }
            
            const selectedChild = appData.children.find(child => child.id === appData.selectedChild);
            if (!selectedChild) {
                alert('找不到選擇的兒童');
                return;
            }
            
            document.getElementById('deleteChildName').textContent = selectedChild.name;
            document.getElementById('deleteChildModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 刪除選定的兒童
        function deleteSelectedChild() {
            if (!appData.selectedChild) {
                alert('請先選擇一位兒童');
                closeModals();
                return;
            }
            
            // 從children數組中刪除
            const childIndex = appData.children.findIndex(child => child.id === appData.selectedChild);
            if (childIndex !== -1) {
                appData.children.splice(childIndex, 1);
                saveChildren();
            }
            
            // 刪除相關的記錄和里程碑資料
            localStorage.removeItem(`records_${appData.selectedChild}`);
            localStorage.removeItem(`milestones_${appData.selectedChild}`);
            
            // 刪除記錄和里程碑的內存中數據
            delete appData.records[appData.selectedChild];
            delete appData.milestones[appData.selectedChild];
            delete appData.reminders[appData.selectedChild];
            
            // 清除selectedChild
            appData.selectedChild = null;
            localStorage.removeItem('selectedChild');
            
            // 更新UI
            updateChildSelector();
            updateChildInfo();
            
            // 清空各標籤頁內容
            document.getElementById('historyContent').innerHTML = '';
            document.getElementById('milestoneContent').innerHTML = '';
            document.getElementById('caretipsContent').innerHTML = '';
            document.getElementById('reminderList').innerHTML = '<p>目前沒有提醒項目。</p>';
            
            // 清空圖表
            if (window.sleepChart) window.sleepChart.destroy();
            if (window.feedingChart) window.feedingChart.destroy();
            if (window.diaperChart) window.diaperChart.destroy();
            if (window.emotionChart) window.emotionChart.destroy();
            
            closeModals();
            showToast('兒童資料已成功刪除');
        }

        // 匯出所有數據
        function exportAllData() {
            // 準備要匯出的數據
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                children: appData.children,
                records: {},
                milestones: {},
                reminders: {...appData.reminders},
                quickOptions: appData.quickOptions
            };

            // 收集所有兒童的記錄和里程碑
            appData.children.forEach(child => {
                const childId = child.id;
                
                // 獲取記錄
                if (appData.records[childId]) {
                    exportData.records[childId] = appData.records[childId];
                } else {
                    // 嘗試從localStorage加載
                    const recordsStr = localStorage.getItem(`records_${childId}`);
                    if (recordsStr) {
                        exportData.records[childId] = JSON.parse(recordsStr);
                    } else {
                        exportData.records[childId] = [];
                    }
                }
                
                // 獲取里程碑
                if (appData.milestones[childId]) {
                    exportData.milestones[childId] = appData.milestones[childId];
                } else {
                    // 嘗試從localStorage加載
                    const milestonesStr = localStorage.getItem(`milestones_${childId}`);
                    if (milestonesStr) {
                        exportData.milestones[childId] = JSON.parse(milestonesStr);
                    } else {
                        exportData.milestones[childId] = {};
                    }
                }
            });

            // 將數據轉為JSON字符串
            const jsonString = JSON.stringify(exportData, null, 2);
            
            // 創建Blob和下載鏈接
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `寶寶記錄完整備份_${formatDate(new Date())}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('所有數據已成功匯出！');
        }

        // 處理文件選擇
        function handleImportFileSelect(event) {
            const file = event.target.files[0];
            if (!file) {
                document.getElementById('importFileName').textContent = '未選擇檔案';
                document.getElementById('importDataBtn').disabled = true;
                importedData = null;
                return;
            }
            
            document.getElementById('importFileName').textContent = file.name;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    // 驗證數據格式
                    if (!data.version || !data.children || !Array.isArray(data.children)) {
                        throw new Error('無效的數據格式');
                    }
                    
                    importedData = data;
                    document.getElementById('importDataBtn').disabled = false;
                } catch (error) {
                    alert('無法解析文件: ' + error.message);
                    document.getElementById('importFileName').textContent = '無效的檔案格式';
                    document.getElementById('importDataBtn').disabled = true;
                    importedData = null;
                }
            };
            reader.readAsText(file);
        }

        // 顯示匯入確認模態框
        function showImportConfirmModal() {
            if (!importedData) {
                alert('請先選擇有效的匯入檔案');
                return;
            }
            
            const modal = document.getElementById('importConfirmModal');
            const summary = document.getElementById('importSummary');
            const warning = document.getElementById('importWarning');
            
            // 準備摘要內容
            const importOption = document.querySelector('input[name="importOption"]:checked').value;
            
            let summaryContent = `
                <p><strong>匯出日期：</strong> ${formatDateTime(importedData.exportDate)}</p>
                <p><strong>兒童人數：</strong> ${importedData.children.length}人</p>
                <p><strong>兒童名單：</strong> ${importedData.children.map(c => c.name).join(', ')}</p>
            `;
            
            let warningText = '';
            if (importOption === 'replace') {
                warningText = '<strong>警告：</strong> 此操作將刪除所有現有數據，並替換為匯入的數據！請確保您已備份重要資料。';
            } else {
                // 檢查是否有重複兒童
                const existingNames = appData.children.map(c => c.name);
                const importNames = importedData.children.map(c => c.name);
                const duplicates = existingNames.filter(name => importNames.includes(name));
                
                if (duplicates.length > 0) {
                    warningText = `<strong>注意：</strong> 發現重複的兒童名稱: ${duplicates.join(', ')}。匯入後將保留兩者的記錄，但可能需要手動整理。`;
                }
            }
            
            summary.innerHTML = summaryContent;
            warning.innerHTML = warningText;
            
            modal.classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // 執行數據匯入
        function importData() {
            if (!importedData) {
                alert('請先選擇有效的匯入檔案');
                closeModals();
                return;
            }
            
            const importOption = document.querySelector('input[name="importOption"]:checked').value;
            
            if (importOption === 'replace') {
                // 全部替換模式：清除所有現有數據
                appData.children = [];
                appData.records = {};
                appData.milestones = {};
                appData.reminders = {};
                appData.selectedChild = null;
                
                localStorage.removeItem('selectedChild');
                localStorage.removeItem('reminders');
                
                // 清除所有兒童的記錄和里程碑
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('records_') || key.startsWith('milestones_')) {
                        localStorage.removeItem(key);
                    }
                });
            }
            
            // 匯入兒童數據
            importedData.children.forEach(importChild => {
                // 檢查是否已存在相同ID的兒童
                const existingChildIndex = appData.children.findIndex(c => c.id === importChild.id);
                
                if (existingChildIndex === -1) {
                    // 如果不存在，直接添加
                    appData.children.push(importChild);
                } else if (importOption === 'merge') {
                    // 如果存在且為合併模式，生成新ID並添加
                    const newChild = {...importChild};
                    newChild.id = 'child_' + Date.now() + '_import';
                    appData.children.push(newChild);
                    
                    // 更新記錄和里程碑中的ID引用
                    if (importedData.records[importChild.id]) {
                        importedData.records[newChild.id] = importedData.records[importChild.id];
                    }
                    if (importedData.milestones[importChild.id]) {
                        importedData.milestones[newChild.id] = importedData.milestones[importChild.id];
                    }
                    if (importedData.reminders && importedData.reminders[importChild.id]) {
                        importedData.reminders[newChild.id] = importedData.reminders[importChild.id];
                    }
                }
                // 如果是replace模式且存在相同ID，會覆蓋原有的
            });
            
            // 儲存兒童數據
            saveChildren();
            
            // 匯入記錄和里程碑
            for (const childId in importedData.records) {
                if (importedData.records[childId] && Array.isArray(importedData.records[childId])) {
                    // 檢查該兒童是否已被匯入（或已存在）
                    const childExists = appData.children.some(c => c.id === childId);
                    
                    if (childExists) {
                        // 如果是合併模式，與現有記錄合併
                        if (importOption === 'merge' && appData.records[childId]) {
                            appData.records[childId] = [...appData.records[childId], ...importedData.records[childId]];
                        } else {
                            // 否則直接替換/設置
                            appData.records[childId] = importedData.records[childId];
                        }
                        
                        // 儲存到localStorage
                        localStorage.setItem(`records_${childId}`, JSON.stringify(appData.records[childId]));
                    }
                }
            }
            
            // 匯入里程碑
            for (const childId in importedData.milestones) {
                if (importedData.milestones[childId]) {
                    // 檢查該兒童是否已被匯入（或已存在）
                    const childExists = appData.children.some(c => c.id === childId);
                    
                    if (childExists) {
                        // 如果是合併模式，與現有里程碑合併
                        if (importOption === 'merge' && appData.milestones[childId]) {
                            appData.milestones[childId] = {...appData.milestones[childId], ...importedData.milestones[childId]};
                        } else {
                            // 否則直接替換/設置
                            appData.milestones[childId] = importedData.milestones[childId];
                        }
                        
                        // 儲存到localStorage
                        localStorage.setItem(`milestones_${childId}`, JSON.stringify(appData.milestones[childId]));
                    }
                }
            }
            
            // 匯入提醒
            if (importedData.reminders) {
                for (const childId in importedData.reminders) {
                    // 檢查該兒童是否已被匯入（或已存在）
                    const childExists = appData.children.some(c => c.id === childId);
                    
                    if (childExists) {
                        // 如果是合併模式，與現有提醒合併
                        if (importOption === 'merge' && appData.reminders[childId]) {
                            appData.reminders[childId] = [...appData.reminders[childId], ...importedData.reminders[childId]];
                        } else {
                            // 否則直接替換/設置
                            appData.reminders[childId] = importedData.reminders[childId];
                        }
                    }
                }
                
                // 儲存提醒
                saveReminders();
            }

            // 匯入快速選項設置
            if (importedData.quickOptions) {
                if (importOption === 'replace') {
                    appData.quickOptions = importedData.quickOptions;
                } else {
                    // 合併模式：保留現有的快速選項，但可添加新的選項
                    if (importedData.quickOptions.feeding && importedData.quickOptions.feeding.length > 0) {
                        // 檢查是否有重複選項，避免重複添加
                        importedData.quickOptions.feeding.forEach(option => {
                            const existingOption = appData.quickOptions.feeding.find(o => 
                                o.type === option.type && o.amount === option.amount && o.unit === option.unit
                            );
                            if (!existingOption) {
                                appData.quickOptions.feeding.push(option);
                            }
                        });
                    }
                    
                    // 最後一次餵食記錄保持不變，除非是替換模式
                }
                saveQuickOptions();
                
                // 如果有進行中的睡眠記錄，則根據選擇決定是否繼續使用
                if (importOption === 'replace' && importedData.quickOptions.sleepStartTime) {
                    // 如果是替換模式且匯入資料有睡眠記錄，則使用匯入的睡眠記錄
                    checkOngoingSleep();
                }
            }
            
            // 更新UI
            updateChildSelector();
            updateChildInfo();
            
            // 如果有兒童被匯入，選擇第一個
            if (appData.children.length > 0 && !appData.selectedChild) {
                selectChild(appData.children[0].id);
            }
            
            closeModals();
            showToast('數據匯入成功！');
            
            // 重置匯入狀態
            document.getElementById('importFileInput').value = '';
            document.getElementById('importFileName').textContent = '未選擇檔案';
            document.getElementById('importDataBtn').disabled = true;
            importedData = null;
        }

        // 初始化應用程式
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
